[{"content":"ä¸€ã€å…¥é—¨çŸ¥è¯† 1.æ·±åº¦å­¦ä¹ æ¦‚è¿° æ·±åº¦å­¦ä¹ æœ¬è´¨ä¸Šæ˜¯ç¥ç»ç½‘ç»œçš„ä¸€ç§ï¼Œé€šè¿‡è®­ç»ƒå¤šå±‚ç½‘ç»œç»“æ„å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œåˆ†ç±»å’Œå›å½’ï¼Œæ—¢æœ‰æ— ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œä¹Ÿæœ‰æœ‰ç›‘ç£å­¦ä¹ ç®—æ³•ã€‚\n2.ç¥ç»ç½‘ç»œåŸºç¡€ 1.å¼•å­ï¼šä»ç”Ÿç‰©ç¥ç»å…ƒåˆ°ç¥ç»å…ƒæ¨¡å‹ ä¸€ä¸ªç¥ç»å…ƒé€šå¸¸å…·æœ‰å¤šä¸ªæ ‘çªï¼Œä¸»è¦ç”¨æ¥æ¥å—ä¼ å…¥ä¿¡æ¯ï¼›è€Œè½´çªåªæœ‰ä¸€æ¡ï¼Œè½´çªå°¾ç«¯æœ‰è®¸å¤šè½´çªæœ«æ¢¢å¯ä»¥ç»™å…¶ä»–å¤šä¸ªç¥ç»å…ƒä¼ é€’ä¿¡æ¯ã€‚è½´çªæœ«æ¢¢è·Ÿå…¶ä»–ç¥ç»å…ƒçš„æ ‘çªäº§ç”Ÿè¿æ¥ï¼Œä»è€Œä¼ é€’ä¿¡å·ã€‚è¿™ä¸ªè¿æ¥çš„ä½ç½®åœ¨ç”Ÿç‰©å­¦ä¸Šå«åšâ€œçªè§¦â€ã€‚\nå›¾1 ç¥ç»å…ƒ\n1943å¹´ï¼Œå¿ƒç†å­¦å®¶McCullochå’Œæ•°å­¦å®¶Pittså‚è€ƒäº†ç”Ÿç‰©ç¥ç»å…ƒçš„ç»“æ„ï¼Œå‘è¡¨äº†æŠ½è±¡çš„M-Pç¥ç»å…ƒæ¨¡å‹ å›¾2 Warren McCullochï¼ˆå·¦ï¼‰å’ŒÂ Walter Pittsï¼ˆå³ï¼‰\nå›¾3 M-Pç¥ç»å…ƒç»“æ„å›¾\nM-Pç¥ç»å…ƒé€šè¿‡åŠ æƒæ±‚å’Œä¸é˜ˆå€¼æ¯”è¾ƒæ¥å†³å®šè¾“å‡ºï¼Œå…¶ä¸­xáµ¢ä¸ºç¥ç»å…ƒè¾“å…¥ï¼Œwáµ¢ä¸ºæƒé‡ï¼ˆæƒé‡æ­£è´Ÿæ¨¡æ‹Ÿå…´å¥‹\\æŠ‘åˆ¶ï¼Œå¤§å°æ¨¡æ‹Ÿå¼ºåº¦ï¼‰ï¼ŒÎ¸ä¸ºé˜ˆå€¼ã€‚\nåœ¨è¿™ä¸€æ¨¡å‹ä¸­ï¼Œç¥ç»å…ƒæ¥æ”¶æ¥è‡ªnä¸ªå…¶ä»–ç¥ç»å…ƒä¼ é€’è¿‡æ¥çš„ä¿¡å·ï¼Œä¸å¯¹åº”çš„æƒé‡ç›¸ä¹˜ï¼Œå†å°†ç¥ç»å…ƒæ±‚å¾—çš„æ€»è¾“å…¥å€¼å’Œé˜ˆå€¼ç›¸æ¯”è¾ƒï¼Œç»è¿‡æ¿€æ´»å‡½æ•°æ¿€æ´»ï¼Œå¾—åˆ°â€œ0â€æˆ–â€œ1â€çš„è¾“å‡ºç»“æœï¼ˆå½“åŠ æƒå’Œå¤§äºé˜ˆå€¼æ—¶è¾“å‡º1ï¼Œå¦åˆ™è¾“å‡º0ï¼‰ã€‚\n2.å•å±‚ç¥ç»ç½‘ç»œï¼ˆæ„ŸçŸ¥å™¨ï¼‰ å•å±‚ç¥ç»ç½‘ç»œæ˜¯ç¥ç»ç½‘ç»œé¢†åŸŸä¸­æœ€ç®€å•ã€æœ€åŸºç¡€çš„æ¨¡å‹ï¼Œå®ƒåªæœ‰è¾“å…¥å±‚ç›´æ¥è¿æ¥åˆ°è¾“å‡ºå±‚ï¼Œä¸­é—´æ²¡æœ‰éšè—å±‚ã€‚\nåœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œå•å±‚ç¥ç»ç½‘ç»œæœ¬è´¨ä¸Šæ˜¯åœ¨ç”»ä¸€æ¡ç›´çº¿ï¼ˆåœ¨æ›´é«˜ç»´ç©ºé—´ä¸­æ˜¯ä¸€ä¸ªè¶…å¹³é¢ï¼‰ï¼Œè¯•å›¾å°†ä¸åŒç±»åˆ«çš„æ•°æ®åˆ†å¼€ï¼Œå…¶è®¡ç®—è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡å‰å‘ä¼ æ’­ï¼Œåªèƒ½å¤Ÿè§£å†³çº¿æ€§å¯åˆ†çš„é—®é¢˜ã€‚\n1969å¹´ï¼ŒMinsky å’Œ Papert æŒ‡å‡ºï¼Œå•å±‚æ„ŸçŸ¥æœºæ— æ³•è§£å†³å¼‚æˆ–ï¼ˆXORï¼‰é—®é¢˜ã€‚\nå³ï¼šå¦‚æœä½ åœ¨çº¸ä¸Šç”»å‡ºè¿™å››ä¸ªç‚¹ï¼Œä½ ä¼šå‘ç°æ— è®ºå¦‚ä½•ç”»ä¸€æ¡ç›´çº¿ï¼Œéƒ½æ— æ³•å°†è¾“å‡ºä¸º1çš„ç‚¹å’Œè¾“å‡ºä¸º0çš„ç‚¹åˆ†å¼€ã€‚\nå›¾4 XOR\n3.å¤šå±‚ç¥ç»ç½‘ç»œ å¤šå±‚ç¥ç»ç½‘ç»œæ˜¯æ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒï¼Œå®ƒé€šè¿‡åœ¨è¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´åŠ å…¥ä¸€å±‚æˆ–å¤šå±‚â€œéšè—å±‚â€ï¼Œä¸ºæ•°æ®æä¾›äº†å¤šæ¬¡å˜åŒ–çš„åœºæ‰€ã€‚\nå¤šå±‚ç¥ç»ç½‘ç»œèƒ½å¤Ÿè§£å†³å•å±‚ç½‘ç»œæ— æ³•è§£å†³çš„XORç­‰éçº¿æ€§é—®é¢˜ï¼Œä½†ç©¶å…¶åŸå› ï¼Œå´å¹¶ä¸æ˜¯å•çº¯çš„â€œå¤šå åŠ å‡ å±‚â€ã€‚\næ ¹æ®çº¿æ€§ä»£æ•°åŸç†ï¼Œçº¿æ€§å˜æ¢çš„çº¿æ€§å˜æ¢ä»ç„¶æ˜¯çº¿æ€§å˜æ¢ï¼Œå¦‚æœåªæ˜¯ç®€å•åœ°æŠŠå¤šä¸ªçº¿æ€§å±‚å †å åœ¨ä¸€èµ·ï¼Œå³ä¾¿æ˜¯å¤šå±‚ç½‘ç»œï¼Œåœ¨æ•°å­¦ä¸Šä¹Ÿä¾æ—§ç­‰ä»·äºå•å±‚ç½‘ç»œã€‚\nå›¾5 æ¿€æ´»å‡½æ•°\né‚£ä¹ˆéçº¿æ€§é—®é¢˜ç©¶ç«Ÿæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ\nè¿™ä¸â€œæ¿€æ´»å‡½æ•°â€å¯†ä¸å¯åˆ†ã€‚\næ¿€æ´»å‡½æ•°ä¸ºç¥ç»ç½‘ç»œå¼•å…¥äº†éçº¿æ€§å› ç´ ï¼Œè®©ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å’Œæ‹Ÿåˆå„ç§éçº¿æ€§æ¨¡å¼ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œå¯ä»¥é€¼è¿‘ä»»æ„å¤æ‚çš„å‡½æ•°ï¼Œä»è€Œèƒ½å¤Ÿè¯†åˆ«è¯­éŸ³ã€å›¾åƒç­‰å¤æ‚æ•°æ®ã€‚\næ¯ä¸€å±‚éšè—å±‚è¿›è¡Œå®Œçº¿æ€§è®¡ç®—åï¼Œå¿…é¡»ç»è¿‡ä¸€ä¸ªéçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œåªè¦é€šè¿‡è¶³å¤Ÿå¤šçš„å±‚å’Œç¥ç»å…ƒï¼Œç½‘ç»œå°±å¯ä»¥é€¼è¿‘ä»»ä½•å¤æ‚çš„å‡½æ•°å½¢çŠ¶ã€‚è¿™å°±å¥½æ¯”æ˜¯æŠŠä¸€å¼ çº¸è¿›è¡Œäº†æŠ˜å ã€å¼¯æ›²ï¼Œåªè¦ç»è¿‡è¶³å¤Ÿå¤šæ¬¡æ“ä½œï¼Œå°±èƒ½å¤Ÿå½¢æˆå„ç§å½¢çŠ¶ã€‚ï¼ˆå³ï¼šä¸‡æœ‰é€¼è¿‘å®šç†ï¼‰\n4.åå‘ä¼ æ’­ åå‘ä¼ æ’­æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„é‡è¦ç®—æ³•ï¼Œå…¶æœ¬è´¨æ˜¯å¾®ç§¯åˆ†ä¸­é“¾å¼æ³•åˆ™çš„åº”ç”¨ï¼Œé€šè¿‡ä»æœ€åä¸€æ­¥è¿”å›å€’æ¨å›ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥ç®—å‡ºæ¯ä¸ªç¥ç»å…ƒæˆ–æƒé‡å¯¹è¯¯å·®çš„â€œè´¡çŒ®â€ï¼Œä»¥ä¾¿å®ç°å¯¹å‚æ•°çš„è°ƒæ•´ã€‚\näºŒã€pytorchåŸºç¡€ç»ƒä¹  1.å®šä¹‰æ•°æ®ï¼š å¼ é‡æ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„ï¼Œå¯ä»¥æ˜¯æ ‡é‡ã€å‘é‡ã€çŸ©é˜µæˆ–æ›´é«˜ç»´åº¦çš„æ•°æ®ç»“æ„ã€‚\nä¸€èˆ¬å®šä¹‰æ•°æ®ä½¿ç”¨torch.tensorï¼Œå…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ï¼ˆå¼ é‡çš„åŸå§‹æ•°æ®ï¼‰ï¼Œåç»­å‚æ•°æ˜¯ï¼ˆå…³é”®å­—å‚æ•°ï¼‰ï¼Œè¯¥å‚æ•°è§„åˆ™èƒ½å¤Ÿæ¨å¹¿åˆ°å¼ é‡åˆ›å»ºç±»æ–¹æ³•ï¼ˆå¦‚ï¼štorch.zeros() / torch.ones()ï¼‰ï¼Œè€Œå¯¹äºæ“ä½œå¼ é‡æˆ–å®ç°ç‰¹å®šåŠŸèƒ½çš„æ–¹æ³•å¹¶ä¸é€‚ç”¨ã€‚\nä½¿ç”¨Â torch.tensor()Â å‡½æ•°ï¼Œå¯ä»¥å°†ä¸€ä¸ªåˆ—è¡¨æˆ–æ•°ç»„è½¬æ¢ä¸ºå¼ é‡ã€‚\nä»¥ä¸‹ç»™å‡ºå®šä¹‰æ•°æ®ç¤ºä¾‹ï¼š\n1.è¾“å‡ºä¸€ä¸ªæ•°\\æ•°ç»„ï¼š 2.è¾“å‡ºäºŒç»´æ•°ç»„ï¼š ï¼ˆæ³¨ï¼šæ­¤å¤„torch.zeros(2,3)ç­‰ä»·äºtorch.zeros((2,3))ï¼Œonesæ–¹æ³•åŒç†ï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿™æ ·å†™æ˜¯å› ä¸ºå®ƒä»¬çš„å‚æ•°ä¸ºsizeï¼Œåœ¨è¿™é‡Œæ˜¯ç”¨å…ƒç»„è¡¨ç¤ºå½¢çŠ¶ï¼Œè€Œå¯¹äºtensoræ–¹æ³•ï¼Œå…¶å‚æ•°ä¸ºdataï¼Œå¦‚æœä½¿ç”¨é€—å·éš”å¼€ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬2ä¸ªå‚æ•°ä¼šè¢«è§†ä½œå…³é”®å­—å‚æ•°ï¼Œå› è€ŒæŠ¥é”™ï¼‰\n3.åˆ›å»ºä¸€ä¸ªå…¨0çš„å¼ é‡ï¼Œæ•°æ®ç±»å‹ä¸º longï¼š ï¼ˆå…³äºæ•°æ®ç±»å‹ï¼ŒPytorchå¯¹äºé»˜è®¤dtypeçœç•¥æ˜¾ç¤ºï¼Œéé»˜è®¤dtypeå¼ºåˆ¶æ ‡æ³¨ï¼Œä¾‹å¦‚ï¼š\nfloat32æ˜¯é»˜è®¤dtypeï¼Œè€Œfloat64ä¸æ˜¯ï¼Œæ‰€ä»¥ä¼šæ ‡æ³¨float64ï¼‰\n2.å®šä¹‰æ“ä½œï¼š Pytorchèƒ½å¤Ÿç”¨tensorè¿›è¡Œå„ç§è¿ç®—ï¼Œä¸ä»…æ˜¯åŸºæœ¬çš„åŠ å‡ä¹˜é™¤è¿ç®—ï¼Œè¿˜åŒ…æ‹¬å¸ƒå°”è¿ç®—åŠçŸ©é˜µä¹˜æ³•ç­‰çº¿æ€§è¿ç®—ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå¯¹å¼ é‡çš„å½¢çŠ¶è¿›è¡Œæ§åˆ¶ï¼Œå®ç°çŸ©é˜µè½¬ç½®æˆ–ç»´åº¦æ“ä½œã€‚\nä»¥ä¸‹æ˜¯ç¤ºä¾‹ä»£ç ï¼š\n1.åˆ›å»ºä¸€ä¸ª2*4çš„tensorï¼š ï¼ˆ.size()å‡½æ•°è·å–å¼ é‡å½¢çŠ¶ï¼Œsep=\u0026rsquo; \u0026ndash; \u0026lsquo;æŒ‡å®šè¾“å‡ºå…ƒç´ çš„åˆ†éš”ç¬¦ï¼‰\n2.çŸ©é˜µä¹˜æ³•ï¼š ä¸‰ã€èºæ—‹æ•°æ®åˆ†ç±»ä»£ç ç»ƒä¹  1.å¼•å…¥åŸºæœ¬åº“ï¼š randomï¼šç”¨äºç”Ÿæˆéšæœºæ•°ï¼ˆå¦‚æ•°æ®é‡‡æ ·ï¼‰ï¼›\ntorchï¼šå¯¼å…¥ PyTorch æ ¸å¿ƒåº“ï¼Œæä¾›å¼ é‡è¿ç®—å’Œç¥ç»ç½‘ç»œåŠŸèƒ½ï¼›\nnnï¼Œoptimï¼šå¯¼å…¥nnï¼ˆç¥ç»ç½‘ç»œå±‚æ¨¡å—ï¼Œå¦‚çº¿æ€§å±‚ã€æ¿€æ´»å‡½æ•°ï¼‰å’Œoptimï¼ˆä¼˜åŒ–å™¨ï¼Œå¦‚ SGDã€Adamï¼‰ï¼›\nmathï¼šæä¾›æ•°å­¦è¿ç®—æ”¯æŒï¼ˆå¦‚ç”Ÿæˆæ•°æ®æ—¶çš„ä¸‰è§’å‡½æ•°ã€è·ç¦»è®¡ç®—ç­‰ï¼‰ï¼›\nfrom IPython import displayï¼šç”¨äº IPython ç¯å¢ƒä¸­çš„åŠ¨æ€æ˜¾ç¤ºï¼›\nplot_libï¼šå¯¼å…¥è‡ªå®šä¹‰ç»˜å›¾å·¥å…·ã€‚\nä¼˜å…ˆä½¿ç”¨ GPUï¼ˆâ€œcuda:0\u0026quot;ï¼Œç¬¬ 1 å— GPUï¼‰è¿›è¡Œè®¡ç®—ï¼Œè‹¥æ²¡æœ‰ GPU åˆ™è‡ªåŠ¨åˆ‡æ¢åˆ° CPUï¼›(æ·±åº¦å­¦ä¹ ä¸­ï¼ŒGPUçš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›èƒ½å¤Ÿå¤§å¹…åŠ é€Ÿæ¨¡å‹è®­ç»ƒï¼Œä¼˜å…ˆä½¿ç”¨GPUèƒ½å¤Ÿæé«˜è®­ç»ƒæ•ˆç‡)\nXç”¨äºå­˜å‚¨æ‰€æœ‰æ ·æœ¬çš„ç‰¹å¾ï¼ˆæ¯ä¸ªæ ·æœ¬ 2 ä¸ªç‰¹å¾ï¼Œå³äºŒç»´åæ ‡Â (x,y)ï¼‰ï¼›\nYç”¨äºå­˜å‚¨æ¯ä¸ªæ ·æœ¬çš„ç±»åˆ«æ ‡ç­¾ï¼ˆ0ã€1ã€2 ä¸‰ç±»ï¼‰ï¼›\n.to(device)Â å°†å¼ é‡ç§»åˆ°ä¹‹å‰æŒ‡å®šçš„è®¾å¤‡ï¼ˆGPU æˆ– CPUï¼‰ï¼Œç¡®ä¿åç»­è®¡ç®—åœ¨åŒä¸€è®¾å¤‡ä¸Šè¿›è¡Œã€‚\nt = torch.linspace(0, 1, N)\ntç”¨äºæ§åˆ¶èºæ—‹çš„ â€œåŠå¾„â€ï¼štÂ ä» 0 å¢åŠ åˆ° 1ï¼Œæ„å‘³ç€æ ·æœ¬ç‚¹ä¼šä»åŸç‚¹é€æ¸å‘å¤–æ‰©å±•ï¼Œå½¢æˆèºæ—‹çš„ â€œæ—‹å‡ºâ€ æ•ˆæœã€‚\ninner_var = torch.linspace((2math.pi/C)c, (2math.pi/C)(2+c), N) + torch.randn(N)*0.2\ntorch.linspace()ï¼šç”Ÿæˆæ¯ä¸ªç±»åˆ«çš„è§’åº¦èŒƒå›´\ntorch.randn(N)*0.2ï¼šåŠ å…¥å‡å€¼ä¸º 0ã€æ ‡å‡†å·® 0.2 çš„é«˜æ–¯å™ªå£°ï¼Œè®©æ•°æ®ç‚¹åœ¨èºæ—‹çº¿ä¸Šæœ‰è½»å¾®æ³¢åŠ¨ï¼ˆæ›´è´´è¿‘çœŸå®ä¸–ç•Œçš„æ•°æ®åˆ†å¸ƒï¼Œé¿å…å®Œå…¨ç†æƒ³åŒ–çš„èºæ—‹ï¼‰\nplot_data(X, Y)æ˜¯ç”¨äºå¯è§†åŒ–æ•°æ®é›†åˆ†å¸ƒçš„å‡½æ•°\n2.æ„å»ºçº¿æ€§æ¨¡å‹åˆ†ç±»ï¼š 1.è¶…å‚æ•°è®¾ç½®\nlearning_rate = 1e-3ï¼šå­¦ä¹ ç‡ï¼ˆæ§åˆ¶å‚æ•°æ›´æ–°çš„æ­¥é•¿ï¼‰ï¼Œè¿‡å°ä¼šå¯¼è‡´è®­ç»ƒæ…¢ï¼Œè¿‡å¤§ä¼šå¯¼è‡´éœ‡è¡ä¸æ”¶æ•›ï¼›\nlambda_l2 = 1e-5ï¼šL2 æ­£åˆ™åŒ–ç³»æ•°ï¼ˆé€šè¿‡æƒ©ç½šå¤§æƒé‡é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼‰ï¼Œæ•°å€¼è¶Šå°æ­£åˆ™åŒ–è¶Šå¼±ã€‚\n2.æ¨¡å‹å®šä¹‰\nåˆ›å»ºäº†ä¸¤å±‚çº¿æ€§ç½‘ç»œï¼Œæ¨¡å‹åªèƒ½æ‹Ÿåˆçº¿æ€§å†³ç­–è¾¹ç•Œï¼Œæ— æ³•æ‹Ÿåˆèºæ—‹å½¢è¿™ç§éçº¿æ€§å¯åˆ†çš„æ•°æ®ã€‚\nè¾“å‡ºéƒ¨åˆ†æ•°æ®çš„é¢„æµ‹ç»“æœï¼Œå¹¶è§‚å¯Ÿï¼Œå¿«é€Ÿæ£€éªŒæ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ã€‚\nçº¿æ€§å†³ç­–è¾¹ç•Œæ— æ³•è´´åˆèºæ—‹å½¢çŠ¶ï¼Œä½“ç°çº¿æ€§æ¨¡å‹åœ¨éçº¿æ€§ä»»åŠ¡ä¸­çš„å±€é™æ€§ã€‚\n3.æ„å»ºä¸¤å±‚ç¥ç»ç½‘ç»œåˆ†ç±» 1.å¼•å…¥ReLUæ¿€æ´»å‡½æ•°ï¼Œè®©æ¨¡å‹å­¦ä¹ éçº¿æ€§ç‰¹å¾\n2.ä¼˜åŒ–å™¨æ”¹ä¸ºAdamï¼Œç›¸è¾ƒäºSGDï¼ŒAdam ä¼˜åŒ–å™¨è‡ªå¸¦åŠ¨é‡æœºåˆ¶å’Œè‡ªé€‚åº”å­¦ä¹ ç‡è°ƒæ•´ï¼Œèƒ½æ›´å¿«æ”¶æ•›åˆ°è¾ƒä¼˜è§£ï¼Œå°¤å…¶æ˜¯åœ¨éçº¿æ€§æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ä¸­ã€‚\nå››ã€é—®é¢˜æ€»ç»“ Q1: AlexNetæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿä¸ºä»€ä¹ˆå¯ä»¥æ¯”LeNetå–å¾—æ›´å¥½çš„æ€§èƒ½ï¼Ÿ Aï¼šAlexnetä½¿ç”¨äº†ReLUæ¿€æ´»å‡½æ•°ï¼ŒDropoutæŠ€æœ¯ï¼Œæœ€å¤§æ± åŒ–æ“ä½œã€‚ ReLUæ¿€æ´»å‡½æ•°è§£å†³äº†ç¥ç»ç½‘ç»œåœ¨å±‚æ•°è¿‡æ·±æˆ–æ¢¯åº¦è¿‡å°æ—¶ï¼Œsigmondå­˜åœ¨çš„å‰ƒåº¦æ¶ˆå¤±é—®é¢˜ã€‚Â ä½¿ç”¨Dropouté˜²æ­¢å‘ç”Ÿè¿‡æ‹Ÿåˆï¼ŒDropout æ˜¯ä¸€ç§æ­£åˆ™åŒ–æ–¹æ³•ï¼Œå®ƒåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­éšæœºä¸¢å¼ƒä¸€éƒ¨åˆ†ç¥ç»å…ƒçš„è¾“å‡ºï¼Œä»è€Œå‡å°‘æ¨¡å‹å¯¹ç‰¹å®šè®­ç»ƒæ ·æœ¬çš„ä¾èµ–ï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚Â æœ€å¤§æ± åŒ–ä¼šé€‰å–æ¯ä¸ªæ± åŒ–çª—å£ä¸­çš„æœ€å¤§å€¼ä½œä¸ºè¾“å‡ºã€‚è¿™ç§æ“ä½œä¸ä»…èƒ½å¤Ÿé™ä½ç‰¹å¾å›¾çš„ç©ºé—´ç»´åº¦ï¼Œè¿˜èƒ½å¤Ÿä¿ç•™å›¾åƒçš„ä¸»è¦ç‰¹å¾ã€‚\nQ2:æ¿€æ´»å‡½æ•°æœ‰å“ªäº›ä½œâ½¤ï¼Ÿ Aï¼šæ¿€æ´»å‡½æ•°æ‰“ç ´ç¥ç»ç½‘ç»œçš„çº¿æ€§æŸç¼šï¼Œå°†è¾“å…¥ä¿¡å·æ˜ å°„åˆ°éçº¿æ€§è¾“å‡ºç©ºé—´ä¸­ï¼Œè®©ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å’Œæ‹Ÿåˆå„ç§å¤æ‚çš„éçº¿æ€§æ¨¡å¼ã€‚\nQ3:æ¢¯åº¦æ¶ˆå¤±ç°è±¡æ˜¯ä»€ä¹ˆï¼Ÿ Aï¼šâ€œæ¢¯åº¦æ¶ˆå¤±â€æŒ‡çš„æ˜¯åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦åœ¨å±‚ä¸å±‚ä¹‹é—´ä¸æ–­ç›¸ä¹˜ï¼Œåˆ°è¾¾å‰é¢å±‚æ—¶å·²ç»æ¥è¿‘ 0ï¼Œå¯¼è‡´è¿™äº›å±‚å‡ ä¹å­¦ä¸åˆ°ä¸œè¥¿ã€‚\nQ4:ç¥ç»ç½‘ç»œæ˜¯æ›´å®½å¥½è¿˜æ˜¯æ›´æ·±å¥½ï¼Ÿ Aï¼šæ·±å±‚ç¥ç»ç½‘ç»œçš„å±‚æ•°çµæ´»ä½†å®½åº¦æœ‰é™ï¼Œåœ¨æ ·æœ¬ç‚¹å……è¶³ä½†å‚æ•°æœ‰é™æ—¶è¡¨ç°æ›´ä¼˜,æé«˜æ·±åº¦èƒ½æ›´å¥½åœ°å¤„ç†éçº¿æ€§å¤æ‚é—®é¢˜ï¼Œä½†è¿‡æ·±ä¼šé€ æˆæ¢¯åº¦ä¸ç¨³å®šï¼Œæµ…å±‚å­¦ä¹ èƒ½åŠ›ä¸‹é™ç­‰é—®é¢˜ã€‚Â å®½å±‚ç¥ç»ç½‘ç»œçš„éšè—å±‚æœ‰é™ä½†å®½åº¦çµæ´»ï¼Œåœ¨å‚æ•°å¤šä½†æ ·æœ¬ç‚¹æœ‰é™æ—¶æ›´ä¼˜ï¼Œæé«˜å®½åº¦èƒ½è®©ç½‘ç»œæå–æ›´å¤šç‰¹å¾ï¼Œä½†è¿‡å®½ä¼šå¯¼è‡´æå–ç‰¹å¾è¿‡å¤šé‡å¤ï¼Œå¢åŠ è®¡ç®—è´Ÿæ‹…ã€‚\nQ5:ä¸ºä»€ä¹ˆè¦ä½¿â½¤Softmax? Aï¼šsoftmaxå‡½æ•°èƒ½å¤Ÿå°†æœªè§„èŒƒåŒ–çš„é¢„æµ‹å˜æ¢ä¸ºéè´Ÿæ•°å¹¶ä¸”æ€»å’Œä¸º1ï¼ŒåŒæ—¶è®©æ¨¡å‹ä¿æŒå¯å¯¼çš„æ€§è´¨ã€‚\nQ6:SGD å’Œ Adam å“ªä¸ªæ›´æœ‰æ•ˆï¼Ÿ Aï¼šSGDè®¡ç®—é«˜æ•ˆï¼Œç†è®ºæ”¶æ•›æ€§å¼ºï¼Œä½†æ”¶æ•›é€Ÿåº¦æ…¢ï¼Œä¾èµ–å­¦ä¹ ç‡è°ƒå‚ï¼Œé€‚åˆå°æ‰¹é‡ä»»åŠ¡ï¼›\nAdamæ”¶æ•›é€Ÿåº¦å¿«ï¼Œæ— æ•ˆæ‰‹åŠ¨è°ƒå‚ï¼Œèƒ½å¤Ÿé€‚åº”å¤æ‚æ›²é¢ï¼Œä½†å†…å­˜å æ¯”ç¨é«˜ï¼Œä¸”æ³›åŒ–æ€§ä¸è¶³ï¼Œåœ¨å¤„ç†å°æ•°æ®é›†æ—¶å¯èƒ½å¯¼è‡´æ¨¡å‹é™·å…¥å°–é”çš„å±€éƒ¨æå°å€¼ã€‚\nè€ƒè™‘åˆ°Adamå‰æœŸæ”¶æ•›å¿«ï¼ŒSGDåæœŸç²¾åº¦é«˜ï¼Œåˆ©ç”¨Adamå¿«é€Ÿæ”¶æ•›ï¼Œå†ç”¨SGDå¾®è°ƒä¼šæ›´ä¸ºæœ‰æ•ˆã€‚\n","date":"2025-12-05T20:13:02+08:00","permalink":"https://SelYioZn.github.io/p/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0week1/","title":"æ·±åº¦å­¦ä¹ Week1"},{"content":"ä¸€ã€æ³›å‹åŸºç±»ï¼ˆé€šç”¨å•ä¾‹æ¨¡å¼ï¼‰ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šç¡®ä¿åœ¨æ•´ä¸ªæ¸¸æˆä¸­ï¼ŒæŸä¸ªç±»ï¼ˆæ¯”å¦‚Â GameManagerï¼‰æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€çš„è®¿é—®ç‚¹ï¼ˆInstanceï¼‰ï¼Œè®©ä»»ä½•å…¶ä»–è„šæœ¬éƒ½èƒ½è½»æ¾è°ƒç”¨å®ƒã€‚\nè®¾è®¡æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰ã€‚\næŠ€æœ¯äº®ç‚¹ï¼šä½¿ç”¨äº†Â C# æ³›å‹ï¼ˆGenericsï¼‰ï¼Œè¿™æ„å‘³ç€ä½ åªéœ€è¦å†™ä¸€æ¬¡è¿™ä¸ªåŸºç±»ï¼Œä»¥åä»»ä½•ç®¡ç†ç±»æƒ³è¦å˜èº«å•ä¾‹ï¼Œåªéœ€è¦ç»§æ‰¿å®ƒå³å¯ï¼Œæ— éœ€é‡å¤å†™å•ä¾‹é€»è¾‘ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 using UnityEngine; /// \u0026lt;summary\u0026gt; /// æ³›å‹å•ä¾‹åŸºç±» - å·¥ä¸šçº§ç‰ˆæœ¬ /// \u0026lt;para\u0026gt;ç”¨æ³•ï¼špublic class MyManager : Singleton\u0026lt;MyManager\u0026gt;\u0026lt;/para\u0026gt; /// \u0026lt;/summary\u0026gt; public class Singleton\u0026lt;T\u0026gt; : MonoBehaviour where T : MonoBehaviour { private static T _instance; // çº¿ç¨‹é”ï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘è®¿é—®æ—¶ç”Ÿæˆå¤šä¸ªå®ä¾‹ï¼ˆè™½ç„¶Unityå¤§éƒ¨åˆ†APIéçº¿ç¨‹å®‰å…¨ï¼Œä½†è¿™æ˜¯å¥½ä¹ æƒ¯ï¼‰ private static readonly object _lock = new object(); // æ ‡è®°ç¨‹åºæ˜¯å¦æ­£åœ¨é€€å‡º private static bool _isQuitting = false; public static T Instance { get { // å¦‚æœæ¸¸æˆæ­£åœ¨é€€å‡ºï¼Œä¸å†åˆ›å»ºæ–°çš„å•ä¾‹ï¼Œé˜²æ­¢æŠ¥é”™ if (_isQuitting) { Debug.LogWarning($\u0026#34;[Singleton] æ¸¸æˆæ­£åœ¨é€€å‡ºï¼Œä¸å†åˆ›å»º {typeof(T)} çš„å®ä¾‹ã€‚\u0026#34;); return null; } lock (_lock) { if (_instance == null) { // 1. å°è¯•åœ¨åœºæ™¯ä¸­æŸ¥æ‰¾ _instance = FindObjectOfType\u0026lt;T\u0026gt;(); if (_instance == null) { // 2. å¦‚æœåœºæ™¯ä¸­æ²¡æœ‰ï¼Œè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª GameObject singletonObj = new GameObject(); _instance = singletonObj.AddComponent\u0026lt;T\u0026gt;(); singletonObj.name = \u0026#34;(Singleton) \u0026#34; + typeof(T).Name; Debug.Log($\u0026#34;[Singleton] åœºæ™¯ä¸­ä¸å­˜åœ¨ {typeof(T)}ï¼Œå·²è‡ªåŠ¨åˆ›å»ºã€‚\u0026#34;); } } return _instance; } } } protected virtual void Awake() { if (_instance == null) { _instance = this as T; DontDestroyOnLoad(gameObject); // ä¿è¯åˆ‡åœºæ™¯ä¸é”€æ¯ } else if (_instance != this) // ã€å…³é”®ä¿®å¤ã€‘ç¡®ä¿ä¸æ˜¯â€œè‡ªå·±æ€è‡ªå·±â€ { Debug.LogWarning($\u0026#34;[Singleton] å‘ç°é‡å¤çš„ {typeof(T)}ï¼Œé”€æ¯ç‰©ä½“: {gameObject.name}\u0026#34;); Destroy(gameObject); } } // å½“æ¸¸æˆé€€å‡ºæˆ–åœºæ™¯åˆ‡æ¢é”€æ¯æ—¶è°ƒç”¨ protected virtual void OnDestroy() { if (_instance == this) { _isQuitting = true; } } } ç¤ºä¾‹å­ç±»ï¼š // æ³¨æ„è¿™é‡Œï¼šç»§æ‰¿ Singleton\u0026lt;AudioManager\u0026gt; public class AudioManager : Singleton\u0026lt;AudioManager\u0026gt; { // å­ç±»å¦‚æœæœ‰è‡ªå·±çš„Awakeï¼Œå¿…é¡»è°ƒç”¨ base.Awake() !!! protected override void Awake() { base.Awake(); // å¿…é¡»ä¿ç•™è¿™å¥ï¼Œå¦åˆ™å•ä¾‹èµ‹å€¼é€»è¾‘ä¼šå¤±æ•ˆ InitializeAudio(); } public void PlaySound(string clipName) { Debug.Log(\u0026quot;æ’­æ”¾éŸ³æ•ˆ: \u0026quot; + clipName); } private void InitializeAudio() { /*...*/ } } åœ¨å…¶ä»–è„šæœ¬ä¸­è°ƒç”¨ï¼š public class PlayerAttack : MonoBehaviour { void Attack() { // å“ªæ€•ä½ æ²¡æœ‰æŒæœ‰AudioManagerçš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ AudioManager.Instance.PlaySound(\u0026quot;SwordSwing\u0026quot;); } } æ ¸å¿ƒæŠ€èƒ½æ€»ç»“\nâš”ï¸ C# è¯­è¨€ç‰¹æ€§ç»´åº¦ A. æ³›å‹çº¦æŸ (Generic Constraints) ä»£ç ä½“ç°ï¼šwhere T : MonoBehaviour æ ¸å¿ƒçŸ¥è¯†ï¼š æ³›å‹ä¸æ˜¯éšä¾¿ä¼ çš„ï¼Œæˆ‘ä»¬å¿…é¡»å‘Šè¯‰ç¼–è¯‘å™¨ T å¿…é¡»æ˜¯ MonoBehaviour çš„å­ç±»ã€‚ ä¸ºä»€ä¹ˆè¦çº¦æŸï¼Ÿ å› ä¸ºåªæœ‰ MonoBehaviour æ‰æœ‰ FindObjectOfTypeã€Destroyã€gameObject è¿™äº›å±æ€§å’Œæ–¹æ³•ã€‚å¦‚æœä¸çº¦æŸï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ B. é™æ€ vs å®ä¾‹ (Static vs Instance) ä»£ç ä½“ç°ï¼šprivate static T _instance vs public void PlayMusic() æ ¸å¿ƒçŸ¥è¯†ï¼š é™æ€ (static)ï¼šå±äºç±»æœ¬èº«ï¼Œå†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œç”Ÿå‘½å‘¨æœŸä¼´éšæ•´ä¸ªç¨‹åºè¿è¡Œã€‚è¿™æ˜¯å•ä¾‹â€œå…¨å±€å”¯ä¸€â€çš„ç‰©ç†åŸºç¡€ã€‚ å®ä¾‹ (this)ï¼šå±äº new å‡ºæ¥çš„å¯¹è±¡ï¼ˆæˆ– AddComponent å‡ºæ¥çš„ç»„ä»¶ï¼‰ã€‚ éš¾ç‚¹ï¼šåœ¨é™æ€å±æ€§ï¼ˆInstanceï¼‰ä¸­ï¼Œä¸èƒ½ç›´æ¥è®¿é—®éé™æ€æˆå‘˜ï¼ˆé™¤éå…ˆæœ‰äº†å®ä¾‹ _instanceï¼‰ã€‚ C. å±æ€§å°è£…ä¸æ‡’åŠ è½½ (Lazy Loading) ä»£ç ä½“ç°ï¼šget { if (_instance == null) \u0026hellip; } æ ¸å¿ƒçŸ¥è¯†ï¼š å•ä¾‹ä¸åº”è¯¥åœ¨æ¸¸æˆä¸€å¼€å§‹å°±å…¨éƒ¨åˆ›å»ºï¼ˆé‚£æ ·å¯åŠ¨ä¼šå¾ˆå¡ï¼‰ã€‚ æ‡’åŠ è½½ï¼šåªæœ‰å½“ä½ ç¬¬ä¸€æ¬¡è°ƒç”¨ GameManager.Instance æ—¶ï¼Œå®ƒæ‰ä¼šè¢«åˆ›å»ºæˆ–æŸ¥æ‰¾ã€‚è¿™æ˜¯ä¸€ç§ç”¨â€œç¬¬ä¸€æ¬¡è°ƒç”¨çš„å¾®å°å¡é¡¿â€æ¢å–â€œå¿«é€Ÿå¯åŠ¨â€çš„ä¼˜åŒ–ç­–ç•¥ã€‚\nâš™ï¸ Unity å¼•æ“æœºåˆ¶ç»´åº¦ A. è„šæœ¬ç”Ÿå‘½å‘¨æœŸ (Script Lifecycle) æ ¸å¿ƒçŸ¥è¯†ï¼š Awakeï¼šæ˜¯åˆå§‹åŒ–çš„æœ€ä½³æ—¶æœºã€‚å•ä¾‹çš„èµ‹å€¼å¿…é¡»åœ¨ Awakeï¼Œè€Œä¸æ˜¯ Startï¼Œç¡®ä¿å…¶ä»–è„šæœ¬åœ¨ Start è°ƒç”¨å•ä¾‹æ—¶ï¼Œå•ä¾‹å·²ç»å‡†å¤‡å¥½äº†ã€‚ æ‰§è¡Œé¡ºåºé™·é˜±ï¼šUnity ä¸­ä¸åŒè„šæœ¬çš„ Awake æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚æ‰€ä»¥å¿…é¡»æ”¯æŒè‡ªåŠ¨åˆ›å»ºæˆ–æ‡’åŠ è½½ï¼Œé˜²æ­¢è„šæœ¬ A è°ƒç”¨è„šæœ¬ B çš„å•ä¾‹æ—¶ï¼Œè„šæœ¬ B è¿˜æ²¡é†’æ¥ã€‚ B. åœºæ™¯æŒä¹…åŒ– (Persistence) ä»£ç ä½“ç°ï¼šDontDestroyOnLoad(gameObject) æ ¸å¿ƒçŸ¥è¯†ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½æ–°åœºæ™¯æ—¶ï¼Œæ—§åœºæ™¯çš„æ‰€æœ‰ç‰©ä½“éƒ½ä¼šè¢«é”€æ¯ã€‚ å•ä¾‹é€šå¸¸æ˜¯å…¨å±€ç®¡ç†å™¨ï¼Œå¿…é¡»ä½¿ç”¨æ­¤ API è®©å…¶â€œç©¿è¶Šâ€åœºæ™¯è€Œä¸è¢«é”€æ¯ã€‚ C. å¯¹è±¡æŸ¥æ‰¾å¼€é”€ä»£ç ä½“ç°ï¼šFindObjectOfType() æ ¸å¿ƒçŸ¥è¯†ï¼š è¿™æ˜¯ä¸€ä¸ªéå¸¸æ˜‚è´µçš„æ“ä½œï¼ˆéå†å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡ï¼‰ã€‚ å•ä¾‹çš„ä»·å€¼ï¼šç¼“å­˜ï¼ˆCacheï¼‰äº†è¿™ä¸ªç»“æœã€‚ç¬¬ä¸€æ¬¡æ…¢ï¼Œåé¢æ¯æ¬¡è®¿é—® Instance éƒ½æ˜¯ O(1) çš„é€Ÿåº¦ï¼Œæå¿«ã€‚\nğŸ›¡ï¸ æ¶æ„ä¸é˜²å¾¡æ€§ç¼–ç¨‹ï¼ˆèµ„æ·±å¿…å¤‡ï¼‰ A. ç«æ€æ¡ä»¶ä¸è‡ªæ€ Bug (Race Condition) ä»£ç ä½“ç°ï¼šelse if (_instance != this) æ ¸å¿ƒçŸ¥è¯†ï¼š ç†è§£ä¸ºä»€ä¹ˆç®€å•çš„ else { Destroy } ä¼šå¯¼è‡´å•ä¾‹æŠŠè‡ªå·±åˆ æ‰ã€‚ è¿™æ˜¯å¤šè„šæœ¬åä½œæ—¶çš„é€»è¾‘æ¼æ´ï¼Œå¿…é¡»åŒºåˆ†â€œå­˜åœ¨çš„é‚£ä¸ªæ˜¯ä¸æ˜¯æˆ‘â€ã€‚ B. é€€å‡ºæ¸…ç†ä¿æŠ¤ (Quit Safety) ä»£ç ä½“ç°ï¼š_isQuitting æ ‡è®° æ ¸å¿ƒçŸ¥è¯†ï¼š Unity å…³é—­æ¸¸æˆæ—¶ï¼Œä¼šæŒ‰éšæœºé¡ºåºé”€æ¯å¯¹è±¡ã€‚ å¦‚æœ A åœ¨é”€æ¯æ—¶è°ƒç”¨äº† B çš„å•ä¾‹ï¼Œè€Œ B å·²ç»è¢«é”€æ¯äº†ï¼Œæ™®é€šçš„å•ä¾‹é€»è¾‘ä¼šè¯•å›¾åˆ›å»ºä¸€ä¸ªæ–°çš„ Bï¼ˆå› ä¸º _instance ä¸ºç©ºï¼‰ã€‚ è¿™ä¼šå¯¼è‡´æŠ¥é”™ï¼šSome objects were not cleaned up when closing the sceneã€‚å¿…é¡»ç”¨æ ‡å¿—ä½æ‹¦æˆªã€‚ C. çº¿ç¨‹å®‰å…¨ (Thread Safety) ä»£ç ä½“ç°ï¼šlock(_lock) æ ¸å¿ƒçŸ¥è¯†ï¼š è™½ç„¶ Unity çš„ APIï¼ˆå¦‚ FindObjectOfTypeï¼‰åªèƒ½åœ¨ä¸»çº¿ç¨‹è·‘ï¼Œä½† C# é€»è¾‘å±‚å¯èƒ½æ˜¯å¤šçº¿ç¨‹çš„ï¼ˆå¦‚ç½‘ç»œæ¶ˆæ¯å›è°ƒï¼‰ã€‚ åŠ é”æ˜¯ä¸ºäº†é˜²æ­¢æç«¯çš„å¹¶å‘æƒ…å†µä¸‹åˆ›å»ºå‡ºä¸¤ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¿™æ˜¯å·¥ä¸šçº§ä»£ç çš„è§„èŒƒä½“ç°ã€‚\nğŸ“ æœ€ä½³å®è·µå£è¯€ ä¸ºäº†è®©ä½ åœ¨å®é™…å¼€å‘ä¸­ä¸å‡ºé”™ï¼Œè®°ä½è¿™ä¸‰æ¡ï¼š å­ç±» Awake å¿…åŠ  baseï¼š åªè¦ç»§æ‰¿äº† Singletonï¼Œå†™ Awake æ—¶ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯ base.Awake()ï¼Œå¦åˆ™å•ä¾‹é€»è¾‘å¤±æ•ˆã€‚ ä¸è¦åœ¨ OnDestroy ä¹±è°ƒå•ä¾‹ï¼š å°½é‡é¿å…åœ¨ç‰©ä½“é”€æ¯æ—¶å»è°ƒç”¨å…¶ä»–çš„å•ä¾‹ç®¡ç†å™¨ï¼Œå¾ˆå®¹æ˜“è§¦å‘â€œåƒµå°¸å¯¹è±¡â€æŠ¥é”™ã€‚ å•ä¾‹ä¸æ˜¯ä¸‡èƒ½è¯ï¼šæ…ç”¨ï¼šä¸è¦æŠŠæ‰€æœ‰ç±»éƒ½åšæˆå•ä¾‹ã€‚åªæœ‰å…¨å±€å”¯ä¸€ä¸”éœ€è¦è·¨åŸŸè®¿é—®çš„ç®¡ç†å™¨ï¼ˆå¦‚éŸ³é¢‘ã€UIã€æ¸¸æˆçŠ¶æ€ï¼‰æ‰é€‚åˆã€‚å¦‚æœæ»¥ç”¨å•ä¾‹ï¼Œä»£ç è€¦åˆåº¦ä¼šæé«˜ï¼Œå¯¼è‡´åæœŸéš¾ä»¥ç»´æŠ¤ã€‚\näºŒã€åŸºäº DOTween æ’ä»¶çš„åœºæ™¯åˆ‡æ¢æ§åˆ¶å™¨(ç»§æ‰¿æ³›å‹å•ä¾‹) ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæä¾›ä¸€ä¸ªå…¨å±€æ¥å£Â LoadScene(string name)ï¼Œè°ƒç”¨åæ‰§è¡Œæµç¨‹ï¼šå±å¹•å˜é»‘ -\u0026gt; å¼‚æ­¥åŠ è½½æ–°åœºæ™¯ -\u0026gt; å±å¹•å˜äº®ã€‚\nå…³é”®æŠ€æœ¯ï¼š\nCoroutine (åç¨‹)ï¼šå¤„ç†éšæ—¶é—´å‘ç”Ÿçš„é€»è¾‘ï¼ˆå…ˆæ·¡å‡ºï¼Œå†åŠ è½½ï¼Œå†æ·¡å…¥ï¼‰ã€‚\nAsyncOperationï¼šUnity çš„åå°åŠ è½½æœºåˆ¶ï¼Œé˜²æ­¢åŠ è½½å¤§åœºæ™¯æ—¶æ¸¸æˆå½»åº•å¡æ­»ã€‚\nCanvasGroupï¼šæ§åˆ¶ UI é€æ˜åº¦å’Œäº¤äº’çš„æœ€ä¼˜ç»„ä»¶ã€‚\nDOTweenï¼šç”¨äºä¸æ»‘åœ°å¤„ç†æ•°å€¼ï¼ˆé€æ˜åº¦ï¼‰å˜åŒ–ã€‚\nå‡†å¤‡å·¥ä½œï¼ˆåœ¨ Unity ç¼–è¾‘å™¨ä¸­ï¼‰ï¼š\nåˆ›å»º UIï¼š\nåˆ›å»ºä¸€ä¸ª Canvasï¼ŒSort Order è®¾ç½®ä¸ºÂ 999ï¼ˆç¡®ä¿å®ƒæ°¸è¿œè¦†ç›–åœ¨æœ€ä¸Šå±‚ï¼‰ã€‚\nåˆ›å»ºä¸€ä¸ªå…¨å±é»‘è‰²çš„ Panel (Image)ã€‚\nç»™è¿™ä¸ª Panel æ·»åŠ Â CanvasGroupÂ ç»„ä»¶ï¼ŒæŠŠ Alpha è®¾ä¸º 0ï¼Œå‹¾é€‰Â Blocks Raycastsã€‚\né‡è¦ï¼šå–æ¶ˆå‹¾é€‰Â InteractableÂ å’ŒÂ Blocks Raycastsï¼ˆåˆå§‹çŠ¶æ€åº”ä¸é˜»æŒ¡ç‚¹å‡»ï¼Œåªæœ‰åˆ‡æ¢æ—¶æ‰é˜»æŒ¡ï¼‰ã€‚\næŒ‚è½½è„šæœ¬ï¼š\nåˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“Â SceneSystemï¼ŒæŒ‚ä¸Šæ­¤è„šæœ¬ã€‚\næŠŠåˆšæ‰é‚£ä¸ª Panel æ‹–ç»™Â fadeCanvasGroupÂ å˜é‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 using UnityEngine; using UnityEngine.SceneManagement; using UnityEngine.UI; using DG.Tweening; using System.Collections; using System; // ç”¨äº Action å›è°ƒ // 1. ç»§æ‰¿ä¹‹å‰çš„å·¥ä¸šçº§æ³›å‹å•ä¾‹ public class SceneTransitionController : Singleton\u0026lt;SceneTransitionController\u0026gt; { [Header(\u0026#34;UI è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;å¿…é¡»èµ‹å€¼ï¼šç”¨äºé®æŒ¡ç”»é¢çš„å¸¦æœ‰ CanvasGroup çš„ UI ç‰©ä½“\u0026#34;)] public CanvasGroup fadeCanvasGroup; public Image progressBar; // å¯é€‰ï¼šè¿›åº¦æ¡ public float fadeDuration = 0.5f; // æ·»åŠ ä¸€ä¸ªäº‹ä»¶ï¼Œå½“åŠ è½½å¼€å§‹å’Œç»“æŸæ—¶é€šçŸ¥å¤–éƒ¨ï¼ˆä¾‹å¦‚åœæ­¢èƒŒæ™¯éŸ³ä¹ï¼‰ public event Action OnLoaderStart; public event Action OnLoaderComplete; protected override void Awake() { base.Awake(); // åˆ«å¿˜äº†è¿™å¥ï¼ // é˜²å‘†è®¾è®¡ï¼šå¦‚æœæ²¡èµ‹å€¼ï¼Œå°è¯•è‡ªå·±æ‰¾ä¸€ä¸‹ï¼Œæˆ–è€…æŠ¥é”™ if (fadeCanvasGroup == null) { fadeCanvasGroup = GetComponentInChildren\u0026lt;CanvasGroup\u0026gt;(); if(fadeCanvasGroup == null) Debug.LogError(\u0026#34;âŒ SceneTransitionController: å¿˜äº†èµ‹å€¼ FadeCanvasGroupï¼\u0026#34;); } // åˆå§‹çŠ¶æ€ç¡®ä¿æ˜¯é€çš„ä¸”ä¸é˜»æŒ¡ç‚¹å‡» fadeCanvasGroup.alpha = 0f; fadeCanvasGroup.blocksRaycasts = false; } /// \u0026lt;summary\u0026gt; /// åŠ è½½åœºæ™¯ /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;sceneName\u0026#34;\u0026gt;åœºæ™¯å\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;onSceneLoaded\u0026#34;\u0026gt;å¯é€‰ï¼šåœºæ™¯åŠ è½½å®Œæ¯•ä½†åœ¨æ·¡å…¥å‰çš„å›è°ƒï¼ˆæ¯”å¦‚åˆå§‹åŒ–ç©å®¶ä½ç½®ï¼‰\u0026lt;/param\u0026gt; public void LoadScene(string sceneName, Action onSceneLoaded = null) { StartCoroutine(ProcessSceneLoading(sceneName, onSceneLoaded)); } private IEnumerator ProcessSceneLoading(string sceneName, Action onSceneLoaded) { // è§¦å‘å¼€å§‹äº‹ä»¶ OnLoaderStart?.Invoke(); // 1. é˜»æŒ¡ç‚¹å‡»å¹¶æ·¡å‡ºï¼ˆå˜é»‘ï¼‰ fadeCanvasGroup.blocksRaycasts = true; yield return fadeCanvasGroup.DOFade(1f, fadeDuration).WaitForCompletion(); // 2. å¼‚æ­¥åŠ è½½ AsyncOperation asyncLoad = SceneManager.LoadSceneAsync(sceneName); asyncLoad.allowSceneActivation = false; // å…³é”®ï¼šå…ˆä¸è‡ªåŠ¨åˆ‡æ¢ï¼Œç­‰æˆ‘ä»¬æ‰‹åŠ¨æ”¾è¡Œ // 3. æ¨¡æ‹Ÿè¿›åº¦æ¡é€»è¾‘ // AsyncOperation çš„ progress åªä¼šä» 0 èµ°åˆ° 0.9ï¼Œå‰©ä¸‹ 0.1 æ˜¯æ¿€æ´»é˜¶æ®µ while (asyncLoad.progress \u0026lt; 0.9f) { if (progressBar != null) progressBar.fillAmount = asyncLoad.progress; yield return null; } // è¡¥æ»¡è¿›åº¦æ¡è§†è§‰ if (progressBar != null) progressBar.fillAmount = 1f; // ç­‰å¾…ä¸€å°ä¼šå„¿è®©ç©å®¶çœ‹æ¸…è¿›åº¦æ¡æ»¡äº†ï¼ˆå¯é€‰ä½“éªŒä¼˜åŒ–ï¼‰ yield return new WaitForSeconds(0.2f); // å…è®¸åˆ‡æ¢åœºæ™¯ asyncLoad.allowSceneActivation = true; // ç­‰å¾…åœºæ™¯å½»åº•åˆå§‹åŒ–å®Œæ¯• while (!asyncLoad.isDone) yield return null; // æ‰§è¡Œåœºæ™¯åŠ è½½å®Œæˆçš„é€»è¾‘ï¼ˆæ¯”å¦‚ç”Ÿæˆä¸»è§’ï¼‰ onSceneLoaded?.Invoke(); // 4. æ·¡å…¥ï¼ˆå˜é€æ˜ï¼‰å¹¶æ¢å¤ç‚¹å‡» yield return fadeCanvasGroup.DOFade(0f, fadeDuration).WaitForCompletion(); fadeCanvasGroup.blocksRaycasts = false; // è§¦å‘ç»“æŸäº‹ä»¶ OnLoaderComplete?.Invoke(); } } ä»£ç è°ƒç”¨ç¤ºä¾‹ï¼š public class MainMenu : MonoBehaviour { public void OnStartButtonClick() { // ç‚¹å‡»åï¼Œå¹³æ»‘è¿‡æ¸¡åˆ° \u0026quot;GameScene\u0026quot; SceneTransitionController.Instance.LoadScene(\u0026quot;GameScene\u0026quot;); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ CanvasGroup vs SetActiveï¼š\nåš UI æ¸éšæ¸æ˜¾ï¼Œæ°¸è¿œé¦–é€‰Â CanvasGroupã€‚å®ƒæ¯”æ§åˆ¶Â GameObject.SetActiveÂ å¼€é”€ç•¥å¤§ï¼Œä½†å®ƒèƒ½å¤„ç† Alpha æ¸å˜ï¼Œè¿˜èƒ½é€šè¿‡Â InteractableÂ å’ŒÂ BlocksRaycastsÂ æ‰¹é‡æ§åˆ¶äº¤äº’ï¼Œéå¸¸é€‚åˆåšé®ç½©ã€‚ DOTween åç¨‹é›†æˆï¼š\næŒæ¡Â WaitForCompletion()ã€‚å®ƒè®©ä½ å¯ä»¥åƒå†™çº¿æ€§ä»£ç ä¸€æ ·å†™åŠ¨ç”»é€»è¾‘ï¼Œé¿å…äº†å¤æ‚çš„â€œå›è°ƒåœ°ç‹±â€ï¼ˆCallback Hellï¼‰ã€‚ AsyncOperation çš„ 0.9 é™·é˜±ï¼š\né¢è¯•å¸¸é—®ï¼šasyncLoad.progressÂ æœ€å¤šåªèƒ½åˆ° 0.9ã€‚å¦‚æœä½ è®¾ç½®äº†Â allowSceneActivation = falseï¼Œå®ƒå°±ä¼šå¡åœ¨ 0.9 ç­‰å¾…ä½ è®¾ç½®ä¸ºÂ trueã€‚ DontDestroyOnLoad çš„ UI å‘ï¼š\nç”±äºè¿™ä¸ª Canvas æ˜¯Â DontDestroyOnLoadÂ çš„ï¼Œå®ƒé‡Œé¢å¼•ç”¨çš„Â CameraÂ (Render Camera) åœ¨åˆ‡æ¢åœºæ™¯åå¯èƒ½ä¼šä¸¢å¤±ï¼ˆå¦‚æœä½ çš„ Canvas æ˜¯ Screen Space - Camera æ¨¡å¼ï¼‰ã€‚é€šå¸¸å»ºè®®åŠ è½½è¿‡æ¸¡é¡µä½¿ç”¨Â Screen Space - OverlayÂ æ¨¡å¼ï¼Œè¿™æ ·ä¸éœ€è¦ä¾èµ–æ‘„åƒæœºã€‚ ä¸‰ã€3Då…¬å‘Šæ¿ï¼ˆç›¸æœºï¼‰ï¼š ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šè®©æŒ‚è½½æ­¤è„šæœ¬çš„ç‰©ä½“ï¼ˆé€šå¸¸æ˜¯ Quad é¢ç‰‡æˆ– Canvasï¼‰å§‹ç»ˆæœå‘æ‘„åƒæœºã€‚\nåº”ç”¨åœºæ™¯ï¼š\nå¤´é¡¶è¡€æ¡/åå­—ï¼šæ— è®ºç©å®¶æ€ä¹ˆè½¬è§†è§’ï¼Œè¡€æ¡æ°¸è¿œæ­£å¯¹å±å¹•ã€‚\nåœºæ™¯è£…é¥°ï¼šä½æ¶ˆè€—çš„æ ‘æœ¨ã€è‰ä¸›ï¼ˆLODæŠ€æœ¯ï¼‰ï¼Œè¿œçœ‹æ˜¯çº¸ç‰‡ï¼Œä½†æ°¸è¿œé¢æœä½ ï¼Œçœ‹èµ·æ¥åƒç«‹ä½“çš„ã€‚\nç‰©å“æ‰è½ï¼šåœ°ä¸Šçš„é‡‘å¸ã€è£…å¤‡å›¾æ ‡ã€‚\nå…³é”®é€»è¾‘ï¼šä½¿ç”¨äº†Â LateUpdateÂ é…åˆÂ LookAtÂ ç®—æ³•ã€‚\nä½¿ç”¨ç¤ºä¾‹ï¼š\nåœºæ™¯ Aï¼šæ€ªç‰©å¤´é¡¶çš„è¡€æ¡\nåˆ›å»ºä¸€ä¸ª Canvasï¼Œè®¾ç½®ä¸ºÂ World Spaceã€‚\nåœ¨ Canvas ä¸‹æ”¾ä¸€ä¸ª Sliderï¼ˆè¡€æ¡ï¼‰ã€‚\næŠŠè¿™ä¸ª Canvas æ”¾åœ¨æ€ªç‰©çš„å­ç‰©ä½“é‡Œï¼Œè°ƒæ•´åˆ°å¤´é¡¶ä½ç½®ã€‚\næŒ‚è½½æ­¤è„šæœ¬ï¼Œå–æ¶ˆå‹¾é€‰Â lockYAxisã€‚\næ•ˆæœï¼šæ— è®ºä½ ä»å¤©ä¸Šçœ‹è¿˜æ˜¯ä¾§é¢çœ‹ï¼Œè¡€æ¡æ°¸è¿œæ­£æ­£æ–¹æ–¹åœ°æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ åœºæ™¯ Bï¼šåœºæ™¯é‡Œçš„çº¸ç‰‡æ ‘\nåˆ›å»ºä¸€ä¸ª Quadï¼ˆå››è¾¹å½¢é¢ç‰‡ï¼‰ï¼Œè´´ä¸Šæ ‘çš„çº¹ç†ï¼ˆé€æ˜è´´å›¾ï¼‰ã€‚\næŒ‚è½½æ­¤è„šæœ¬ï¼Œå‹¾é€‰Â lockYAxisã€‚\næ•ˆæœï¼šå½“ä½ åœ¨åœ°é¢è·‘åŠ¨æ—¶ï¼Œæ ‘ä¼šç»•ç€ Y è½´è½¬åŠ¨é¢æœä½ ï¼›å½“ä½ é£åˆ°ç©ºä¸­ä¿¯è§†æ—¶ï¼Œæ ‘ä¾ç„¶ç›´ç«‹ï¼Œä¸ä¼šå€’ä¸‹ï¼Œç¬¦åˆé€è§†è§„å¾‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 using UnityEngine; public class Billboard : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ˜¯å¦é”å®šYè½´ï¼ˆæ ‘æœ¨/åœ°é¢NPCé€‰Trueï¼Œé£è¡Œç‰©/è¡€æ¡UIé€‰Falseï¼‰\u0026#34;)] public bool lockYAxis = false; [Tooltip(\u0026#34;å¦‚æœè´´å›¾æ˜¾ç¤ºåäº†ï¼Œå‹¾é€‰æ­¤é¡¹è¿›è¡Œç¿»è½¬\u0026#34;)] public bool reverseFace = false; // è‡ªåŠ¨å¯»æ‰¾æ‘„åƒæœºçš„ç­–ç•¥ private Camera _targetCamera; void Start() { // åˆå§‹åŒ–æ—¶æ‰¾ä¸€æ¬¡ UpdateCameraReference(); } void LateUpdate() { // æ¯ä¸€å¸§æ£€æŸ¥ä¸€ä¸‹æ‘„åƒæœºæ˜¯å¦å­˜åœ¨ï¼ˆè½»é‡çº§æ£€æŸ¥ï¼‰ if (_targetCamera == null) { UpdateCameraReference(); // å¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼ˆæ¯”å¦‚åœºæ™¯é‡Œæ²¡æ‘„åƒæœºï¼‰ï¼Œç›´æ¥é€€å‡ºï¼Œé˜²æ­¢æŠ¥é”™ if (_targetCamera == null) return; } // 1. è·å–ç›®æ ‡å‘é‡ï¼ˆä¸å…¶è¯´æ˜¯â€œçœ‹ç€æ‘„åƒæœºâ€ï¼Œä¸å¦‚è¯´æ˜¯â€œä¸æ‘„åƒæœºå¹³è¡Œâ€ï¼‰ // ä½¿ç”¨ transform.forward = camera.transform.forward æ˜¯æœ€é«˜æ•ˆçš„ï¼Œä¸éœ€è¦ LookAt è®¡ç®— Vector3 targetForward = _targetCamera.transform.forward; // 2. å¤„ç†åå‘ if (reverseFace) targetForward = -targetForward; // 3. å¤„ç† Y è½´é”å®š if (lockYAxis) { // æŠ•å½±åˆ°æ°´å¹³é¢ï¼šæŠŠ Y è½´åˆ†é‡å»æ‰ targetForward.y = 0; targetForward.Normalize(); // å½’ä¸€åŒ–ï¼Œé˜²æ­¢å‘é‡é•¿åº¦å˜ä¸º0 } // 4. åº”ç”¨æ—‹è½¬ // ç›´æ¥ä¿®æ”¹ forward æ¯” LookAt æ€§èƒ½ç¨å¾®å¥½ä¸€ç‚¹ç‚¹ï¼Œä¸”é€»è¾‘æ›´ç›´è§‚ if (targetForward != Vector3.zero) { transform.forward = targetForward; } } // å°è£…æŸ¥æ‰¾æ‘„åƒæœºçš„é€»è¾‘ï¼Œæ–¹ä¾¿åç»­æ‰©å±• private void UpdateCameraReference() { _targetCamera = Camera.main; } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ LateUpdate çš„é‡è¦æ€§ï¼šä»»ä½•è·Ÿéšæ‘„åƒæœºç§»åŠ¨æˆ–æ—‹è½¬çš„ç‰©ä½“ï¼ˆUIã€è·Ÿéšå® ç‰©ã€æ‘„åƒæœºè‡‚ï¼‰ï¼Œå¿…é¡»æ”¾åœ¨Â LateUpdateï¼Œå¦åˆ™å¿…ç„¶æŠ–åŠ¨ã€‚\nLookAt çš„ä¸¤ç§æµæ´¾ï¼š\nLookAt(target)ï¼šèšå…‰ç¯æ•ˆæœï¼Œç‰©ä½“éƒ½æŒ‡å‘ä¸­å¿ƒç‚¹ï¼ˆé€‚åˆç‚®å°ã€çœ¼çƒï¼‰ã€‚\nforward = target.forwardï¼ˆæˆ–åŸä»£ç çš„å†™æ³•ï¼‰ï¼šå¹³è¡Œå…‰æ•ˆæœï¼Œæ‰€æœ‰ç‰©ä½“æœå‘ä¸€è‡´ï¼ˆé€‚åˆ UIã€ç²’å­ã€Billboardï¼‰ã€‚\nç¼“å­˜ Camera.mainï¼šè™½ç„¶ Unity 2020+ å¯¹Â Camera.mainÂ åšäº†ä¼˜åŒ–ï¼Œä½†åœ¨Â UpdateÂ è¿™ç§é«˜é¢‘è°ƒç”¨ä¸­ï¼Œç¼“å­˜å¼•ç”¨ä¾ç„¶æ˜¯ä¸å¯åŠ¨æ‘‡çš„é»„é‡‘æ³•åˆ™ã€‚\n2.5Dé€‚ç”¨ç‰ˆæœ¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 using UnityEngine; public class Billboard2D : MonoBehaviour { [Header(\u0026#34;2.5D è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;é€šå¸¸ 2.5D æ¸¸æˆï¼ˆå¦‚é¥¥è’ï¼‰éœ€è¦é”å®š Y è½´ï¼Œè®©ç‰©ä½“ç«™ç«‹\u0026#34;)] public bool lockYAxis = true; private Transform _camTransform; private Quaternion _originalRotation; void Start() { if (Camera.main != null) _camTransform = Camera.main.transform; // è®°å½•åˆå§‹æ—‹è½¬ï¼Œé˜²æ­¢è„šæœ¬æŠŠç¾æœ¯åŸæœ¬è°ƒå¥½çš„å€¾è§’è¦†ç›–äº† _originalRotation = transform.rotation; } void LateUpdate() { if (_camTransform == null) return; // 1. è·å–æ‘„åƒæœºçš„æœå‘ Vector3 forward = _camTransform.forward; // 2. å¦‚æœæ˜¯ 2.5D æ ‘æœ¨/äººç‰©ï¼Œå¿…é¡»é”å®š Y è½´ï¼ˆåªç»• Y è½¬ï¼Œä¸æŠ¬å¤´ä½å¤´ï¼‰ if (lockYAxis) { forward.y = 0; forward.Normalize(); } // 3. åº”ç”¨æ—‹è½¬ // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬åªæ”¹å˜ LookRotationï¼Œä½†ä¿ç•™ç‰©ä½“è‡ªèº«çš„ Up å‘é‡ // è¿™æ ·å¯ä»¥é¿å…ä¸€äº›å¥‡æ€ªçš„ç¿»è½¬é—®é¢˜ transform.rotation = Quaternion.LookRotation(forward, Vector3.up); } } å››ã€UIçš„æ·¡å…¥æ·¡å‡ºï¼ˆDotween) ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæ§åˆ¶ UI é¢æ¿çš„Â æ˜¾ç¤º (Show)Â å’ŒÂ éšè— (Hide)ï¼Œå¹¶è‡ªåŠ¨å¤„ç†è¿‡æ¸¡åŠ¨ç”»ã€‚\nå…³é”®ç»„ä»¶ï¼šCanvasGroupï¼ˆæ ¸å¿ƒï¼‰ã€DOTweenï¼ˆåŠ¨ç”»é©±åŠ¨ï¼‰ã€‚\nè®¾è®¡äº®ç‚¹ï¼š\nDOKill()ï¼šé˜²æ­¢ç©å®¶æ‰‹é€Ÿè¿‡å¿«ï¼ˆç–¯ç‹‚å¼€å…³é¢æ¿ï¼‰å¯¼è‡´çš„åŠ¨ç”»å†²çªã€‚\nActionÂ å›è°ƒï¼šå…è®¸åŠ¨ç”»æ’­æ”¾å®Œåæ‰§è¡Œé€»è¾‘ï¼ˆæ¯”å¦‚å…³é—­çª—å£åé”€æ¯æ•°æ®ï¼‰ã€‚\nSetActiveÂ ä¼˜åŒ–ï¼šéšè—åå…³é—­ç‰©ä½“ï¼Œé¿å…ä¸å¯è§çš„ UI ç»§ç»­æ¶ˆè€— CPU/GPU èµ„æºï¼ˆDraw Calls \u0026amp; Raycast è®¡ç®—ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 using UnityEngine; using DG.Tweening; using System; [RequireComponent(typeof(CanvasGroup))] public class UIPanelFader : MonoBehaviour { [Header(\u0026#34;åŠ¨ç”»è®¾ç½®\u0026#34;)] public float duration = 0.3f; public Ease showEase = Ease.OutBack; // æ¨èï¼šå¸¦ä¸€ç‚¹å›å¼¹ï¼Œæ‰‹æ„Ÿæ›´å¥½ public Ease hideEase = Ease.InBack; // æ¨èï¼šç¼©å›å»æ—¶çš„åŠ é€Ÿæ„Ÿ [Header(\u0026#34;åŠŸèƒ½å¼€å…³\u0026#34;)] public bool animateScale = true; // æ˜¯å¦å¯ç”¨ç¼©æ”¾åŠ¨ç”» public bool startHidden = true; private CanvasGroup _canvasGroup; private RectTransform _rectTransform; // ç”¨äºç¼©æ”¾åŠ¨ç”» private void Awake() { _canvasGroup = GetComponent\u0026lt;CanvasGroup\u0026gt;(); _rectTransform = GetComponent\u0026lt;RectTransform\u0026gt;(); if (startHidden) { HideImmediate(); } } public void Show(Action onComplete = null) { // 1. å‡†å¤‡å·¥ä½œ gameObject.SetActive(true); _canvasGroup.DOKill(); if (animateScale) _rectTransform.DOKill(); // 2. å¦‚æœæ˜¯ä»éšè—çŠ¶æ€å¼€å§‹ï¼Œé‡ç½®åˆå§‹å€¼ // å¦‚æœå½“å‰å·²ç»æ˜¯åŠé€æ˜ï¼ˆæ¯”å¦‚ alpha 0.5ï¼‰ï¼Œåˆ™ä¸é‡ç½®ï¼Œç›´æ¥ç»§ç»­æ¸å˜ if (_canvasGroup.alpha == 0) { _canvasGroup.alpha = 0f; if (animateScale) _rectTransform.localScale = Vector3.one * 0.8f; // åˆå§‹å¤§å° 0.8 } // 3. æ‰§è¡ŒåŠ¨ç”» _canvasGroup.DOFade(1f, duration).SetUpdate(true); // SetUpdate(true) ä¿è¯æ¸¸æˆæš‚åœæ—¶UIä¹Ÿèƒ½åŠ¨ if (animateScale) { _rectTransform.DOScale(Vector3.one, duration).SetEase(showEase).SetUpdate(true); } // 4. å»¶è¿Ÿè°ƒç”¨å®Œæˆå›è°ƒ // è¿™é‡Œç”¨ Sequence æˆ–è€…ç®€å•çš„ Timer éƒ½å¯ä»¥ï¼ŒDOTween çš„ OnComplete æŒ‚åœ¨ä¸€ä¸ª Tween ä¸Šå³å¯ DOVirtual.DelayedCall(duration, () =\u0026gt; { _canvasGroup.interactable = true; _canvasGroup.blocksRaycasts = true; onComplete?.Invoke(); }).SetUpdate(true); } public void Hide(Action onComplete = null) { _canvasGroup.DOKill(); if (animateScale) _rectTransform.DOKill(); // 1. ç«‹å³ç¦æ­¢äº¤äº’ _canvasGroup.interactable = false; _canvasGroup.blocksRaycasts = false; // 2. æ‰§è¡ŒåŠ¨ç”» _canvasGroup.DOFade(0f, duration).SetUpdate(true); if (animateScale) { _rectTransform.DOScale(Vector3.one * 0.8f, duration).SetEase(hideEase).SetUpdate(true); } // 3. å®Œæˆæ¸…ç† DOVirtual.DelayedCall(duration, () =\u0026gt; { gameObject.SetActive(false); onComplete?.Invoke(); }).SetUpdate(true); } public void HideImmediate() { _canvasGroup.DOKill(); _canvasGroup.alpha = 0f; _canvasGroup.interactable = false; _canvasGroup.blocksRaycasts = false; gameObject.SetActive(false); } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šä¸€ä¸ªé€šç”¨çš„æ¸¸æˆæš‚åœçª—å£ (PausePanel)\næ­¥éª¤ï¼š\nåˆ›å»ºä¸€ä¸ª UI Panelï¼Œå‘½åä¸ºÂ PausePanelã€‚\næŒ‚è½½Â UIPanelFaderÂ è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨æ·»åŠ Â CanvasGroupï¼‰ã€‚\nç¼–å†™ä¸€ä¸ªç®¡ç†å™¨æ¥æ§åˆ¶å®ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public class UIManager : MonoBehaviour { public UIPanelFader pausePanel; // å½“ç©å®¶æŒ‰ä¸‹ ESC é”® public void TogglePauseMenu() { if (pausePanel.gameObject.activeSelf) { // å…³é—­æ—¶ï¼Œæˆ‘æƒ³åœ¨å®Œå…¨çœ‹ä¸è§åï¼Œæ‰“å°ä¸€å¥è¯ pausePanel.Hide(() =\u0026gt; Debug.Log(\u0026#34;æš‚åœèœå•å·²å®Œå…¨å…³é—­\u0026#34;)); } else { pausePanel.Show(); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ CanvasGroup çš„ç»Ÿæ²»åŠ›ï¼š\nåš UI æ•´ä½“æ˜¾éšï¼Œæ°¸è¿œä½¿ç”¨Â CanvasGroupï¼Œä¸è¦å»éå†ä¿®æ”¹Â Image.colorã€‚\nCanvasGroupÂ ä¿®æ”¹ Alpha åªä¼šäº§ç”Ÿæå°‘çš„ DrawCall å¼€é”€ï¼Œè€Œä¸”èƒ½ç»Ÿä¸€æ§åˆ¶å­ç‰©ä½“çš„é€æ˜åº¦ã€‚\nTween çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š\nå¿…é¡»æŒæ¡Â DOKill()ã€‚åœ¨å¼‚æ­¥åŠ¨ç”»çš„ä¸–ç•Œé‡Œï¼Œæ°¸è¿œå‡è®¾ç”¨æˆ·ä¼šä»¥æ¯ç§’ 10 æ¬¡çš„é€Ÿåº¦ç‹‚ç‚¹æŒ‰é’®ï¼Œä½ çš„ä»£ç å¿…é¡»èƒ½å¤„ç†è¿™ç§æƒ…å†µã€‚ UI ä¸å—æ—¶é—´ç¼©æ”¾å½±å“ï¼š\nç‰¢è®°Â SetUpdate(true)ã€‚UIï¼ˆå°¤å…¶æ˜¯æš‚åœèœå•ã€è®¾ç½®èœå•ï¼‰å¿…é¡»ç‹¬ç«‹äºæ¸¸æˆæ—¶é—´ï¼ˆTimeScaleï¼‰è¿è¡Œã€‚ äº¤äº’é˜»æ–­ (Raycast Blocking)ï¼š\néšè—åŠ¨ç”»å¼€å§‹æ—¶ï¼Œç¬¬ä¸€ä»¶äº‹å°±æ˜¯å…³æ‰å°„çº¿æ£€æµ‹ (blocksRaycasts = false)ã€‚è¿™æ˜¯ç”¨æˆ·ä½“éªŒä¼˜åŒ–çš„é“å¾‹ã€‚ äº”ã€UIè·Ÿéšï¼ˆ2Då¯ç”¨ï¼‰ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæ¯ä¸€å¸§è®¡ç®—ç›®æ ‡ç‰©ä½“åœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼Œå¹¶æŠŠ UI ç§»åŠ¨åˆ°é‚£é‡Œã€‚\né€‚ç”¨åœºæ™¯ï¼šCanvas æ¨¡å¼ä¸ºÂ Screen Space - OverlayÂ æˆ–Â Screen Space - CameraÂ çš„æƒ…å†µã€‚\nå…³é”®ç®—æ³•ï¼šCamera.WorldToScreenPointã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 using UnityEngine; using UnityEngine.UI; public class UIFollowWorldObject : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;åŸºç¡€åç§»é‡ï¼ˆåŸºäºå‚è€ƒåˆ†è¾¨ç‡ï¼Œä¾‹å¦‚1920x1080ï¼‰\u0026#34;)] public Vector2 baseOffset = new Vector2(0, 50); [Tooltip(\u0026#34;æ˜¯å¦é™åˆ¶åœ¨å±å¹•èŒƒå›´å†…ï¼ˆç±»ä¼¼æŒ‡ç¤ºå™¨ï¼‰\u0026#34;)] public bool clampToScreen = false; private Transform _targetTransform; private Camera _mainCamera; private RectTransform _myRectTransform; private CanvasGroup _canvasGroup; // ç”¨äºä¼˜åŒ–æ˜¾éš private Canvas _parentCanvas; void Awake() { _myRectTransform = GetComponent\u0026lt;RectTransform\u0026gt;(); _canvasGroup = GetComponent\u0026lt;CanvasGroup\u0026gt;(); // å¦‚æœæ²¡æœ‰ CanvasGroupï¼Œè‡ªåŠ¨åŠ ä¸€ä¸ªï¼Œç”¨äºé«˜æ€§èƒ½æ˜¾éš if (_canvasGroup == null) _canvasGroup = gameObject.AddComponent\u0026lt;CanvasGroup\u0026gt;(); // è·å–çˆ¶çº§ Canvasï¼Œç”¨äºè®¡ç®—ç¼©æ”¾ _parentCanvas = GetComponentInParent\u0026lt;Canvas\u0026gt;(); // åˆå§‹ç¼“å­˜æ‘„åƒæœº UpdateCamera(); } public void SetTarget(Transform target) { _targetTransform = target; } void LateUpdate() { // 1. å®‰å…¨æ£€æŸ¥ if (_targetTransform == null) { SetVisible(false); return; } // 2. æ‘„åƒæœºç¼“å­˜æ£€æŸ¥ï¼ˆé˜²æ­¢æ‘„åƒæœºåˆ‡æ¢åä¸¢å¤±ï¼‰ if (_mainCamera == null) UpdateCamera(); if (_mainCamera == null) return; // è¿˜æ˜¯æ²¡æ‘„åƒæœºï¼Œå•¥ä¹Ÿä¸å¹² // 3. è®¡ç®—å±å¹•åæ ‡ Vector3 worldPos = _targetTransform.position; Vector3 screenPos = _mainCamera.WorldToScreenPoint(worldPos); // 4. å¤„ç†èƒŒåé€»è¾‘ (Z \u0026lt; 0) bool isBehind = screenPos.z \u0026lt; 0; if (isBehind \u0026amp;\u0026amp; !clampToScreen) { SetVisible(false); return; } // 5. è®¡ç®—çœŸæ­£çš„åç§»é‡ï¼ˆå…³é”®ç‚¹ï¼šåˆ†è¾¨ç‡è‡ªé€‚åº”ï¼‰ // è·å– Canvas çš„ç¼©æ”¾å› å­ï¼Œè®© 50px åœ¨ 4K å±ä¸Šè‡ªåŠ¨å˜æˆ 100px float scaleFactor = _parentCanvas.scaleFactor; Vector2 finalOffset = baseOffset * scaleFactor; // 6. åº”ç”¨åæ ‡ Vector2 finalPos = new Vector2(screenPos.x + finalOffset.x, screenPos.y + finalOffset.y); // (é€‰åš) é™åˆ¶åœ¨å±å¹•è¾¹ç¼˜é€»è¾‘ if (clampToScreen) { // å¦‚æœåœ¨èƒŒåï¼Œè¦æŠŠåæ ‡ç¿»è½¬è¿‡æ¥ï¼Œå¦åˆ™æŒ‡ç¤ºå™¨æ–¹å‘æ˜¯åçš„ if (isBehind) finalPos *= -1; // é™åˆ¶åæ ‡åœ¨å±å¹•èŒƒå›´å†… finalPos.x = Mathf.Clamp(finalPos.x, 0, Screen.width); finalPos.y = Mathf.Clamp(finalPos.y, 0, Screen.height); // åªè¦å¼€å¯é™åˆ¶ï¼Œå°±æ°¸è¿œæ˜¾ç¤º SetVisible(true); } else { // æ™®é€šæ¨¡å¼ï¼šåœ¨å±å¹•èŒƒå›´å†…æ‰æ˜¾ç¤º bool isOnScreen = screenPos.x \u0026gt; 0 \u0026amp;\u0026amp; screenPos.x \u0026lt; Screen.width \u0026amp;\u0026amp; screenPos.y \u0026gt; 0 \u0026amp;\u0026amp; screenPos.y \u0026lt; Screen.height; SetVisible(isOnScreen); } _myRectTransform.position = finalPos; } // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ CanvasGroup æ¥æ˜¾éšï¼Œé¿å… Canvas Rebuild private void SetVisible(bool visible) { float targetAlpha = visible ? 1f : 0f; if (!Mathf.Approximately(_canvasGroup.alpha, targetAlpha)) { _canvasGroup.alpha = targetAlpha; } } private void UpdateCamera() { _mainCamera = Camera.main; } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šåˆ¶ä½œä¸€ä¸ªæ€ªç‰©å¤´é¡¶çš„è¡€æ¡\nå‡†å¤‡ UIï¼š\nåœ¨ Canvas (Screen Space - Overlay) ä¸‹åˆ›å»ºä¸€ä¸ª Imageï¼ˆä½œä¸ºè¡€æ¡èƒŒæ™¯ï¼‰ã€‚\nå°†æ­¤è„šæœ¬æŒ‚è½½åˆ°è¿™ä¸ª Image ä¸Šã€‚\nå‡†å¤‡æ€ªç‰©ï¼š\nåœºæ™¯é‡Œæœ‰ä¸€ä¸ªæ€ªç‰©Â Enemy_Goblinã€‚ è¿æ¥é€»è¾‘ï¼š\nä½ éœ€è¦ä¸€ä¸ªç®¡ç†å™¨ï¼ˆæˆ–è€…æ€ªç‰©è‡ªèº«çš„è„šæœ¬ï¼‰åœ¨ç”Ÿæˆæ€ªç‰©æ—¶ï¼Œåˆå§‹åŒ–è¿™ä¸ª UIã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class Enemy : MonoBehaviour { public GameObject healthBarPrefab; // æ‹–å…¥åˆšæ‰åšå¥½çš„ UI Prefab void Start() { // 1. å®ä¾‹åŒ– UI åˆ° Canvas ä¸‹ GameObject uiObj = Instantiate(healthBarPrefab, FindObjectOfType\u0026lt;Canvas\u0026gt;().transform); // 2. è·å–è„šæœ¬å¹¶è®¾ç½®ç›®æ ‡ UIFollowWorldObject follower = uiObj.GetComponent\u0026lt;UIFollowWorldObject\u0026gt;(); // 3. å‘Šè¯‰ UIï¼šä½ è·Ÿç€æˆ‘ï¼ˆthis.transformï¼‰ follower.SetTarget(this.transform); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ åæ ‡ç©ºé—´è½¬æ¢ (Coordinate Space)ï¼š\nå¿…é¡»ç†Ÿç»ƒæŒæ¡Â WorldToScreenPointã€‚\nç†è§£Â World Spaceï¼ˆ3Dåæ ‡ï¼‰ã€Screen Spaceï¼ˆåƒç´ åæ ‡ï¼‰ã€Viewport Spaceï¼ˆ0-1 æ¯”ä¾‹åæ ‡ï¼‰çš„åŒºåˆ«ã€‚\næŠ•å½±æ•°å­¦ (Projection Math)ï¼š\nç†è§£ä¸ºä»€ä¹ˆÂ screenPos.z \u0026lt; 0Â ä»£è¡¨åœ¨èƒŒåã€‚è¿™æ˜¯é€è§†æŠ•å½±çŸ©é˜µè¿ç®—çš„ç»“æœã€‚ UI æ€§èƒ½ä¼˜åŒ–ï¼š\nDirty Flagï¼ˆè„æ ‡è®°ï¼‰ï¼šUI åŠ¨ä¸€ä¸‹ä»£ä»·æ˜¯å¾ˆå¤§çš„ï¼ˆMesh é‡ç»˜ï¼‰ã€‚å°½é‡å‡å°‘Â SetActiveï¼Œå°½é‡ä¸è¦æ¯å¸§ä¿®æ”¹Â LayoutÂ ç»„ä»¶ã€‚\nè¿™ç§è·Ÿéšè„šæœ¬æœ€å¥½é…åˆ Canvas çš„Â Screen Space - CameraÂ æ¨¡å¼ä½¿ç”¨ï¼Œæˆ–è€…å°½é‡è®©è¿™äº› UI å¤„äº Canvas çš„ç‹¬ç«‹å­å±‚çº§ä¸­ã€‚\n2Dä¸“ç”¨ç‰ˆæœ¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 using UnityEngine; public class UIFollow2D : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;å‚ç›´åç§»é‡ (åƒç´ )\u0026#34;)] public float yOffset = 50f; private Transform targetTransform; private Camera mainCamera; private RectTransform myRectTransform; private Canvas parentCanvas; void Awake() { mainCamera = Camera.main; myRectTransform = GetComponent\u0026lt;RectTransform\u0026gt;(); parentCanvas = GetComponentInParent\u0026lt;Canvas\u0026gt;(); } public void SetTarget(Transform target) { targetTransform = target; } void LateUpdate() { if (targetTransform == null || mainCamera == null) { gameObject.SetActive(false); return; } // 1. ä¸–ç•Œåæ ‡è½¬å±å¹•åæ ‡ // åœ¨ 2D æ­£äº¤ç›¸æœºä¸­ï¼ŒZ è½´æ·±åº¦ä¸å½±å“ screenPos.x/y çš„ç»“æœï¼Œåªå½±å“ screenPos.z Vector3 screenPos = mainCamera.WorldToScreenPoint(targetTransform.position); // 2. 2D æ¸¸æˆç‰¹æœ‰çš„å‰”é™¤é€»è¾‘ // åœ¨ 2D ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¸éœ€è¦åˆ¤æ–­ screenPos.z \u0026lt; 0 (å› ä¸ºç›¸æœºä¸ä¼šæ—‹è½¬åˆ°èƒŒé¢) // ä½†æˆ‘ä»¬éœ€è¦åˆ¤æ–­ç‰©ä½“æ˜¯å¦åœ¨å±å¹•èŒƒå›´å†…ï¼ˆè§†é”¥ä½“å‰”é™¤ï¼‰ï¼Œé¿å…åœ¨å±å¹•å¤–è¿˜æ¸²æŸ“UI // ç®€å•çš„åšæ³•æ˜¯ï¼šåªè¦ target æ´»ç€å°±æ˜¾ç¤ºï¼Œå¤æ‚çš„å¯ä»¥è®¡ç®—å±å¹•è¾¹ç¼˜ if (!gameObject.activeSelf) gameObject.SetActive(true); // 3. è®¡ç®—åç§» (ç»“åˆ Canvas ç¼©æ”¾) // è¿™ä¸€æ­¥å¯¹äºé€‚é…ä¸åŒåˆ†è¾¨ç‡è‡³å…³é‡è¦ float finalOffset = yOffset * parentCanvas.scaleFactor; // 4. èµ‹å€¼ myRectTransform.position = new Vector3(screenPos.x, screenPos.y + finalOffset, 0); } } æ‘„åƒæœºç¼©æ”¾ï¼š 1 2 3 // åŠ¨æ€åç§»ç®—æ³• float zoomRatio = 5f / mainCamera.orthographicSize; // å‡è®¾ 5 æ˜¯æ ‡å‡†å¤§å° float dynamicOffset = yOffset * zoomRatio * parentCanvas.scaleFactor; å…­ã€éŸ³æ•ˆæ’­æ”¾å™¨(2D) ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå®ç°â€œå³ç”¨å³å¼ƒâ€çš„ 3D éŸ³æ•ˆæ’­æ”¾ã€‚\nè®¾è®¡æ¨¡å¼ï¼šé™æ€å·¥å…·ç±»ï¼ˆStatic Utility Classï¼‰ã€‚\né€‚ç”¨åœºæ™¯ï¼šå¿«é€ŸåŸå‹å¼€å‘ã€Game Jamï¼Œæˆ–è€…ä¸éœ€è¦ç»Ÿä¸€ç®¡ç†éŸ³é‡çš„å°å‹é¡¹ç›®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 using UnityEngine; using UnityEngine.Audio; // å¼•å…¥æ··éŸ³å™¨å‘½åç©ºé—´ using System.Collections; using System.Collections.Generic; // ç»§æ‰¿è‡ªä¹‹å‰çš„æ³›å‹å•ä¾‹åŸºç±» public class SoundManager : Singleton\u0026lt;SoundManager\u0026gt; { [Header(\u0026#34;2D éŸ³é¢‘é…ç½®\u0026#34;)] [Tooltip(\u0026#34;å¿…é¡»èµ‹å€¼ï¼šéŸ³æ•ˆè¾“å‡ºåˆ°çš„æ··éŸ³ç»„ (Master/SFX)\u0026#34;)] public AudioMixerGroup sfxMixerGroup; [Tooltip(\u0026#34;å¯¹è±¡æ± å®¹é‡ (æ ¹æ®åŒå±æœ€å¤§éŸ³æ•ˆæ•°è®¾å®šï¼Œ2Dæ¸¸æˆé€šå¸¸20-30å¤Ÿäº†)\u0026#34;)] public int poolSize = 20; // å¯¹è±¡æ± é˜Ÿåˆ— private Queue\u0026lt;AudioSource\u0026gt; _audioSourcePool; private GameObject _poolRoot; protected override void Awake() { base.Awake(); InitializePool(); } private void InitializePool() { _audioSourcePool = new Queue\u0026lt;AudioSource\u0026gt;(); _poolRoot = new GameObject(\u0026#34;AudioPool_Root\u0026#34;); _poolRoot.transform.SetParent(transform); for (int i = 0; i \u0026lt; poolSize; i++) { CreateNewAudioSource(); } } private AudioSource CreateNewAudioSource() { GameObject go = new GameObject(\u0026#34;Pooled_SFX\u0026#34;); go.transform.SetParent(_poolRoot.transform); AudioSource source = go.AddComponent\u0026lt;AudioSource\u0026gt;(); // === 2D å…³é”®è®¾ç½® === // 1. è®¾ç½®ä¸º 2D å£°éŸ³ (Spatial Blend = 0) // è¿™æ ·å£°éŸ³å¤§å°å°±ä¸å— Z è½´æ·±åº¦å½±å“ï¼Œåªå—ä»£ç é€»è¾‘æ§åˆ¶ï¼Œ // å½»åº•è§£å†³äº† \u0026#34;2Dæ¸¸æˆå› ä¸ºæ‘„åƒæœºè¿œå¯¼è‡´å£°éŸ³å°\u0026#34; çš„é—®é¢˜ã€‚ source.spatialBlend = 0f; // 2. ç»‘å®šæ··éŸ³å™¨ source.outputAudioMixerGroup = sfxMixerGroup; // 3. ä¸è¦åœ¨å”¤é†’æ—¶æ’­æ”¾ source.playOnAwake = false; go.SetActive(false); _audioSourcePool.Enqueue(source); return source; } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾ 2D éŸ³æ•ˆï¼ˆæ™ºèƒ½å¤„ç†å·¦å³å£°é“ï¼‰ /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;clip\u0026#34;\u0026gt;éŸ³æ•ˆç‰‡æ®µ\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;worldPos\u0026#34;\u0026gt;å‘å£°çš„ä¸–ç•Œåæ ‡ (ç”¨äºè®¡ç®—å·¦å³å£°é“)\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;volume\u0026#34;\u0026gt;åŸºç¡€éŸ³é‡\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;pitchRandom\u0026#34;\u0026gt;éšæœºéŸ³è°ƒèŒƒå›´ (0.1 è¡¨ç¤º 0.9~1.1)\u0026lt;/param\u0026gt; public void PlaySound(AudioClip clip, Vector2 worldPos, float volume = 1.0f, float pitchRandom = 0f) { if (clip == null) return; // 1. ä»æ± ä¸­è·å– AudioSource source; if (_audioSourcePool.Count \u0026gt; 0) source = _audioSourcePool.Dequeue(); else source = CreateNewAudioSource(); // æ± å­ä¸å¤Ÿäº†ä¸´æ—¶åŠ ä¸€ä¸ª source.gameObject.SetActive(true); source.transform.position = worldPos; // ä½ç½®å…¶å®ä¸å½±å“éŸ³é‡äº†ï¼Œä½†åœ¨Sceneé‡Œçœ‹ç€æ–¹ä¾¿ // 2. è®¡ç®— 2D ç«‹ä½“å£° (Stereo Pan) // åŸç†ï¼šå°†ä¸–ç•Œåæ ‡è½¬ä¸ºè§†å£åæ ‡ (0~1)ï¼Œç„¶åæ˜ å°„åˆ° Pan (-1~1) if (Camera.main != null) { Vector3 viewportPos = Camera.main.WorldToViewportPoint(worldPos); // viewport.x: 0(å·¦) ~ 0.5(ä¸­) ~ 1(å³) // panStereo: -1(å·¦) ~ 0(ä¸­) ~ 1(å³) float pan = (viewportPos.x - 0.5f) * 2f; source.panStereo = Mathf.Clamp(pan, -0.8f, 0.8f); // é™åˆ¶ä¸€ä¸‹ï¼Œé˜²æ­¢å•è€³å¤ªç»å¯¹ } else { source.panStereo = 0f; // æ²¡æ‘„åƒæœºå°±å±…ä¸­ } // 3. åº”ç”¨éšæœºéŸ³è°ƒ float finalPitch = 1.0f; if (pitchRandom \u0026gt; 0) { finalPitch = 1.0f + Random.Range(-pitchRandom, pitchRandom); } source.pitch = finalPitch; // 4. æ’­æ”¾ source.clip = clip; source.volume = volume; source.Play(); // 5. å»¶è¿Ÿå›æ”¶ (è€ƒè™‘ Pitch å¯¹æ—¶é•¿çš„å½±å“) // å¦‚æœ pitch = 0.5 (åŠé€Ÿ)ï¼Œæ—¶é•¿éœ€è¦ / 0.5 = 2å€æ—¶é•¿ StartCoroutine(ReturnToPool(source, clip.length / finalPitch)); } // ç®€å•çš„UIéŸ³æ•ˆæ’­æ”¾ï¼ˆä¸éœ€è¦ä½ç½®ï¼Œæ°¸è¿œå±…ä¸­ï¼‰ public void PlayUISound(AudioClip clip, float volume = 1.0f) { PlaySound(clip, Vector2.zero, volume); // è¿™é‡Œè™½ç„¶ä¼ äº† Vector2.zeroï¼Œä½†åœ¨ PlaySound é‡Œå¦‚æœæ²¡æœ‰æ‘„åƒæœºçœ‹è¿™é‡Œï¼ŒpanStereo å¯èƒ½ä¼šå // æ›´å¥½çš„åšæ³•æ˜¯ç»™ source.panStereo å¼ºåˆ¶è®¾ä¸º 0ï¼Œè¿™é‡Œä¸ºäº†ä»£ç ç²¾ç®€å°±ä¸å±•å¼€äº† } private IEnumerator ReturnToPool(AudioSource source, float delay) { // å¤šç­‰ 0.1ç§’ ç¼“å†²ï¼Œé˜²æ­¢å£°éŸ³æ²¡å°¾éŸ³çªç„¶åˆ‡æ–­ yield return new WaitForSeconds(delay + 0.1f); source.Stop(); source.clip = null; source.gameObject.SetActive(false); _audioSourcePool.Enqueue(source); } } ä½¿ç”¨ç¤ºä¾‹ å‡è®¾ä½ æœ‰ä¸€ä¸ª 2D è§’è‰²Â PlayerController2Dï¼Œåœ¨è·³è·ƒæ—¶æ’­æ”¾éŸ³æ•ˆï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 public class PlayerController2D : MonoBehaviour { public AudioClip jumpSFX; void Update() { if (Input.GetButtonDown(\u0026#34;Jump\u0026#34;)) { Jump(); } } void Jump() { // é€»è¾‘... // è°ƒç”¨å•ä¾‹æ’­æ”¾ // ä¼ å…¥ transform.positionï¼Œç®¡ç†å™¨ä¼šè‡ªåŠ¨è®¡ç®—å£°éŸ³è¯¥ä»å·¦è€³æœºå‡ºè¿˜æ˜¯å³è€³æœºå‡º // 0.1f çš„éšæœºéŸ³è°ƒï¼Œè®©è¿ç»­è·³è·ƒçš„å£°éŸ³ä¸é‚£ä¹ˆæœºæ¢° SoundManager.Instance.PlaySound(jumpSFX, transform.position, 1.0f, 0.1f); } } 2D é¡¹ç›®å¿…é¡»æ³¨æ„çš„é…ç½® ä¸ºäº†è®©è¿™æ®µä»£ç æ­£å¸¸å·¥ä½œï¼Œè¯·ç¡®ä¿ï¼š\nAudioMixerï¼šåœ¨ Project é¢æ¿å³é”® -\u0026gt; Create -\u0026gt; Audio Mixerï¼Œåˆ›å»ºä¸€ä¸ªã€‚åŒå‡»æ‰“å¼€ï¼Œç‚¹ \u0026ldquo;Groups\u0026rdquo; ä¸‹é¢çš„ Masterï¼Œç‚¹åŠ å·åˆ›å»ºä¸€ä¸ªå­ç»„å« \u0026ldquo;SFX\u0026rdquo;ã€‚\nSoundManager æŒ‚è½½ï¼šåœ¨åœºæ™¯é‡Œåˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“Â GameManagerï¼ŒæŒ‚ä¸ŠÂ SoundManagerÂ è„šæœ¬ã€‚\nèµ‹å€¼ï¼šæŠŠåˆšæ‰åˆ›å»ºçš„ SFX Mixer Group æ‹–åˆ°è„šæœ¬çš„Â Sfx Mixer GroupÂ æ§½ä½é‡Œã€‚\nä¸ƒã€åˆ—è¡¨æ´—ç‰Œæ‰©å±• ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šä¸º C# çš„é›†åˆç±»å‹å¢åŠ â€œæ´—ç‰Œâ€å’Œâ€œéšæœºè·å–â€åŠŸèƒ½ã€‚\nè¯­æ³•ç‰¹æ€§ï¼šé™æ€æ‰©å±•æ–¹æ³• (thisÂ å…³é”®å­—)ã€‚è¿™æ˜¯ C# çš„è¯­æ³•ç³–ï¼Œèƒ½è®©ä½ åƒè°ƒç”¨åŸç”Ÿæ–¹æ³•ä¸€æ ·è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•ï¼ˆä¾‹å¦‚Â myList.Shuffle()ï¼‰ã€‚\nç®—æ³•æ ¸å¿ƒï¼šFisher-Yates æ´—ç‰Œç®—æ³•ã€‚è¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­å…¬è®¤çš„ã€æ•ˆç‡æœ€é«˜ï¼ˆO(n)ï¼‰ã€éšæœºæ€§æœ€å‡åŒ€çš„æ´—ç‰Œç®—æ³•ã€‚\n2D åº”ç”¨åœºæ™¯ï¼š\nå¡ç‰Œæ¸¸æˆï¼šæ´—ç‰Œå †ã€‚\nRoguelikeï¼šéšæœºç”Ÿæˆåœ°ç‰¢æˆ¿é—´é¡ºåºã€‚\nRPGï¼šä»æ‰è½åˆ—è¡¨ä¸­éšæœºæŠ½å–ä¸€ä»¶è£…å¤‡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 using System.Collections.Generic; using UnityEngine; public static class ListExtensions { /// /// å¯¹åˆ—è¡¨è¿›è¡Œéšæœºæ´—ç‰Œ (Fisher-Yates ç®—æ³•) - ä½¿ç”¨ Unity éšæœºåº“ /// public static void Shuffle\u0026lt;T\u0026gt;(this IList\u0026lt;T\u0026gt; list) { using System.Collections.Generic; using UnityEngine; public static class ListExtensions { /// \u0026lt;summary\u0026gt; /// å¯¹åˆ—è¡¨è¿›è¡Œéšæœºæ´—ç‰Œ (Fisher-Yates ç®—æ³•) - ä½¿ç”¨ Unity éšæœºåº“ /// \u0026lt;/summary\u0026gt; public static void Shuffle\u0026lt;T\u0026gt;(this IList\u0026lt;T\u0026gt; list) { if (list == null || list.Count \u0026lt;= 1) return; int n = list.Count; while (n \u0026gt; 1) { n--; // ä½¿ç”¨ UnityEngine.Random ä¿æŒå…¨é¡¹ç›®éšæœºç»Ÿä¸€ (æ–¹ä¾¿åšç§å­å›æ”¾) int k = UnityEngine.Random.Range(0, n + 1); // äº¤æ¢ T value = list[k]; list[k] = list[n]; list[n] = value; } } } /// /// éšæœºè·å–ä¸€ä¸ªå…ƒç´ ï¼ˆä¸ç§»é™¤ï¼‰ /// public static T GetRandom\u0026lt;T\u0026gt;(this IList\u0026lt;T\u0026gt; list) { if (list == null || list.Count == 0) return default(T); return list[UnityEngine.Random.Range(0, list.Count)]; } /// /// ã€æ–°å¢åŠŸèƒ½ã€‘éšæœºè·å–ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†å…¶ä»åˆ—è¡¨ä¸­ç§»é™¤ (ç±»ä¼¼æŠ½å¡ã€æ‰è½æ± ) /// public static T PopRandom\u0026lt;T\u0026gt;(this List\u0026lt;T\u0026gt; list) { if (list == null || list.Count == 0) return default(T); int index = UnityEngine.Random.Range(0, list.Count); T item = list[index]; // ç§»é™¤è¯¥å…ƒç´  list.RemoveAt(index); return item; } /// /// ã€æ–°å¢åŠŸèƒ½ã€‘ä¼˜åŒ–ç‰ˆç§»é™¤ï¼šå°†é€‰ä¸­çš„å…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œç„¶åç§»é™¤æœ€åä¸€ä¸ªã€‚ /// æ³¨æ„ï¼šè¿™ä¼šç ´ååˆ—è¡¨é¡ºåºï¼Œä½†å¯¹äºâ€œè¢‹ä¸­å–çƒâ€é€»è¾‘ï¼Œæ€§èƒ½æ¯” RemoveAt é«˜å¾—å¤š (O(1) vs O(n)) /// public static T PopRandomSwap\u0026lt;T\u0026gt;(this List\u0026lt;T\u0026gt; list) { if (list == null || list.Count == 0) return default(T); int index = UnityEngine.Random.Range(0, list.Count); T item = list[index]; int lastIndex = list.Count - 1; // æŠŠé€‰ä¸­çš„å…ƒç´ è¦†ç›–ä¸ºæœ€åä¸€ä¸ªå…ƒç´  list[index] = list[lastIndex]; // ç§»é™¤æœ€åä¸€ä¸ªï¼ˆå¼€é”€æå°ï¼‰ list.RemoveAt(lastIndex); return item; } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ å‡è®¾ä½ æ­£åœ¨åšä¸€ä¸ªÂ 2D å¡ç‰Œæˆ˜æ–—æ¸¸æˆã€‚\nåœºæ™¯ Aï¼šæˆ˜æ–—å¼€å§‹ï¼Œæ´—ç‰Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 using System.Collections.Generic; using UnityEngine; public class DeckManager : MonoBehaviour { public List\u0026lt;string\u0026gt; myDeck = new List\u0026lt;string\u0026gt;() { \u0026#34;æ”»å‡»\u0026#34;, \u0026#34;é˜²å¾¡\u0026#34;, \u0026#34;ç«çƒæœ¯\u0026#34;, \u0026#34;æ²»ç–—\u0026#34; }; void Start() { // å¦‚æœæ²¡æœ‰æ‰©å±•æ–¹æ³•ï¼Œä½ å¾—å†™ä¸ªå¾ªç¯å»æ´—ç‰Œ // æœ‰äº†æ‰©å±•æ–¹æ³•ï¼Œç›´æ¥åƒåŸç”ŸåŠŸèƒ½ä¸€æ ·è°ƒç”¨ï¼š myDeck.Shuffle(); Debug.Log(\u0026#34;ç¬¬ä¸€å¼ ç‰Œæ˜¯: \u0026#34; + myDeck[0]); } } åœºæ™¯ Bï¼šæ•Œäººéšæœºç”Ÿæˆç‚¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class EnemySpawner : MonoBehaviour { // åœºæ™¯é‡Œæ”¾äº†ä¸€å †ç©ºç‰©ä½“ä½œä¸ºå‡ºç”Ÿç‚¹ public Transform[] spawnPoints; public GameObject enemyPrefab; void SpawnEnemy() { // æ•°ç»„ä¹Ÿå®ç°äº† IListï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨ GetRandomï¼ Transform randomPoint = spawnPoints.GetRandom(); if (randomPoint != null) { Instantiate(enemyPrefab, randomPoint.position, Quaternion.identity); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ æ‰©å±•æ–¹æ³• (Extension Methods)ï¼š\nå­¦ä¼šä½¿ç”¨Â thisÂ å…³é”®å­—æ‰©å±•ç°æœ‰ç±»ã€‚è¿™æ˜¯ç¼–å†™â€œè¯­æ³•ç³–â€å’Œâ€œå·¥å…·åº“â€çš„ç¥æŠ€ï¼Œèƒ½æå¤§åœ°æé«˜ä»£ç å¯è¯»æ€§ã€‚ æ³›å‹ (Generics)ï¼š\nçš„ä½¿ç”¨è®©ä½ çš„ä»£ç å¯ä»¥å¤ç”¨äºä»»ä½•æ•°æ®ç±»å‹ï¼Œä½“ç°äº† DRY (Don\u0026rsquo;t Repeat Yourself) åŸåˆ™ã€‚ Fisher-Yates æ´—ç‰Œç®—æ³•ï¼š\né¢è¯•å¿…è€ƒé¢˜ã€‚è®°ä½å®ƒæ¯”Â OrderBy(Random)Â æ€§èƒ½å¥½å¾—å¤šä¸”åˆ†å¸ƒæ›´å‡åŒ€ã€‚ List æ€§èƒ½é™·é˜±ï¼š\nç†è§£Â RemoveAtÂ ä¼šå¼•èµ·å†…å­˜ç§»åŠ¨ã€‚å¯¹äºå¤§åˆ—è¡¨çš„éšæœºæŠ½å–ï¼ŒæŒæ¡â€œäº¤æ¢ç§»é™¤æ³• (Swap Removal)â€æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚ å…«ã€æ‹–æ‹½ç„å‡†æ§åˆ¶å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæŒ‰ä¸‹é¼ æ ‡ -\u0026gt; æ‹–æ‹½è“„åŠ› -\u0026gt; æ¾å¼€é¼ æ ‡ -\u0026gt; å‘å‡ºä¸€ä¸ªå‘å°„å‘é‡ï¼ˆVector2ï¼‰ã€‚\näº¤äº’æ¨¡å¼ï¼šåå‘æ‹–æ‹½ï¼ˆDrag Backï¼‰ã€‚å³é¼ æ ‡å‘å·¦æ‹‰ï¼Œç‰©ä½“å‘å³é£ï¼ˆç±»ä¼¼æ‹‰å¼¹å¼“ï¼‰ã€‚\nè®¾è®¡äº®ç‚¹ï¼šä½¿ç”¨äº†Â System.ActionÂ å§”æ‰˜ã€‚è¿™æ„å‘³ç€è¿™ä¸ªè„šæœ¬åªè´Ÿè´£è®¡ç®—è¾“å…¥ï¼Œä¸è´Ÿè´£å…·ä½“çš„ç§»åŠ¨é€»è¾‘ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„è§£è€¦è®¾è®¡ã€‚\n1.ç›´çº¿ç„å‡† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 using UnityEngine; [RequireComponent(typeof(LineRenderer))] public class DragAimController : MonoBehaviour { [Header(\u0026#34;ç‰©ç†å‚æ•°\u0026#34;)] [Tooltip(\u0026#34;æœ€å¤§æ–½åŠ åŠ›çš„å¤§å°\u0026#34;)] public float maxPower = 20f; [Tooltip(\u0026#34;é¼ æ ‡æ‹–æ‹½è·ç¦» -\u0026gt; åŠ›åº¦çš„è½¬åŒ–å€ç‡\u0026#34;)] public float powerMultiplier = 2f; // è°ƒæ•´è¿™ä¸ªæ‰‹æ„Ÿ [Tooltip(\u0026#34;é¼ æ ‡æœ€å¤§å…è®¸æ‹–æ‹½å¤šè¿œï¼ˆä¸–ç•Œåæ ‡å•ä½ï¼‰\u0026#34;)] public float maxDragDistance = 3f; [Header(\u0026#34;è§†è§‰è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ˜¯å¦åå‘æ˜¾ç¤ºç„å‡†çº¿ï¼ˆTrue=æ˜¾ç¤ºé£å‡ºæ–¹å‘ï¼ŒFalse=æ˜¾ç¤ºæ‹‰çš®ç­‹æ–¹å‘ï¼‰\u0026#34;)] public bool showLaunchDirection = true; // äº‹ä»¶ï¼šå‘å°„ public System.Action\u0026lt;Vector2\u0026gt; OnFire; // äº‹ä»¶ï¼šå¼€å§‹ç„å‡†/ç„å‡†ä¸­ï¼ˆå¯é€‰ï¼šç”¨äºè®©æ‘„åƒæœºç¨å¾®åç§»æˆ–è€…ä¸»è§’æ’­æ”¾åŠ¨ç”»ï¼‰ public System.Action OnAimStart; public System.Action OnAimEnd; private LineRenderer _aimLine; private bool _isDragging = false; private Vector2 _startPoint; private Camera _mainCam; void Awake() { _mainCam = Camera.main; _aimLine = GetComponent\u0026lt;LineRenderer\u0026gt;(); _aimLine.positionCount = 2; _aimLine.enabled = false; // 2D ä¼˜åŒ–ï¼šç¡®ä¿çº¿åœ¨æœ€ä¸Šå±‚ _aimLine.sortingOrder = 10; _aimLine.useWorldSpace = true; } void Update() { HandleInput(); } private void HandleInput() { // 1. æŒ‰ä¸‹ (å…¼å®¹é¼ æ ‡å·¦é”®å’Œå•ç‚¹è§¦æ‘¸) if (Input.GetMouseButtonDown(0)) { StartAiming(); } // 2. æ‹–æ‹½ä¸­ if (_isDragging \u0026amp;\u0026amp; Input.GetMouseButton(0)) { UpdateAiming(); } // 3. æ¾å¼€ if (_isDragging \u0026amp;\u0026amp; Input.GetMouseButtonUp(0)) { Fire(); } } private void StartAiming() { _isDragging = true; _startPoint = transform.position; // é”å®šå‘å°„ç‚¹ä¸ºè§’è‰²å½“å‰ä½ç½® _aimLine.enabled = true; _aimLine.SetPosition(0, _startPoint); OnAimStart?.Invoke(); } private void UpdateAiming() { // ã€å…³é”®ä¿®å¤ã€‘è·å–é¼ æ ‡ä½ç½®å¹¶å¼ºåˆ¶ Z=0 Vector3 rawMousePos = _mainCam.ScreenToWorldPoint(Input.mousePosition); Vector2 currentMousePos = new Vector2(rawMousePos.x, rawMousePos.y); // è®¡ç®—æ‹‰æ‹½å‘é‡ (èµ·ç‚¹ -\u0026gt; é¼ æ ‡) Vector2 dragVector = currentMousePos - _startPoint; // é™åˆ¶æ‹–æ‹½åŠå¾„ if (dragVector.magnitude \u0026gt; maxDragDistance) { dragVector = dragVector.normalized * maxDragDistance; } // è®¡ç®—è¿™ä¸€å¸§å¦‚æœå‘å°„ï¼Œä¼šæœ‰å¤šå¤§çš„åŠ› // çœŸæ­£çš„å‘å°„æ–¹å‘æ˜¯æ‹–æ‹½çš„åæ–¹å‘ (-dragVector) Vector2 launchDirection = -dragVector; // è§†è§‰ç»˜åˆ¶ if (showLaunchDirection) { // ç”»å‡ºé£å‡ºå»çš„æ–¹å‘ _aimLine.SetPosition(1, _startPoint + launchDirection); } else { // ç”»å‡ºæ‹‰çš®ç­‹çš„æ•ˆæœï¼ˆè·Ÿéšé¼ æ ‡ï¼‰ _aimLine.SetPosition(1, _startPoint + dragVector); } } private void Fire() { _isDragging = false; _aimLine.enabled = false; OnAimEnd?.Invoke(); // é‡æ–°è®¡ç®—æœ€ç»ˆåŠ›åº¦ï¼ˆé¿å… Update å’Œ Fire ä¹‹é—´æœ‰å¾®å°è¯¯å·®ï¼‰ Vector3 rawMousePos = _mainCam.ScreenToWorldPoint(Input.mousePosition); Vector2 currentMousePos = new Vector2(rawMousePos.x, rawMousePos.y); Vector2 dragVector = currentMousePos - _startPoint; if (dragVector.magnitude \u0026gt; maxDragDistance) { dragVector = dragVector.normalized * maxDragDistance; } // å‘å°„å‘é‡ = æ‹–æ‹½åæ–¹å‘ * å€ç‡ Vector2 fireVector = -dragVector * powerMultiplier; // æœ€ç»ˆåŠ›åº¦é’³åˆ¶ fireVector = Vector2.ClampMagnitude(fireVector, maxPower); // åªæœ‰æ‹‰åŠ¨äº†ä¸€å®šè·ç¦»æ‰å‘å°„ï¼ˆé˜²è¯¯è§¦ï¼‰ if (fireVector.magnitude \u0026gt; 0.1f) { OnFire?.Invoke(fireVector); } } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šè®©ä¸»è§’åƒç‚®å¼¹ä¸€æ ·é£å‡ºå»\nä¸»è§’è®¾ç½®ï¼š\nç»™ä¸»è§’æŒ‚ä¸ŠÂ Rigidbody2DÂ (è®¾ä¸º Dynamic)ã€‚\næŒ‚ä¸ŠÂ DragAimControllerÂ è„šæœ¬ã€‚\nåˆ›å»ºä¸€ä¸ªæ–°è„šæœ¬Â PlayerMovementÂ æ¥æ¥æ”¶ä¿¡å·ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public class PlayerMovement : MonoBehaviour { private DragAimController _aimController; private Rigidbody2D _rb; void Awake() { _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); _aimController = GetComponent\u0026lt;DragAimController\u0026gt;(); } void OnEnable() { // è®¢é˜…äº‹ä»¶ï¼šå½“ç„å‡†æ§åˆ¶å™¨å†³å®šâ€œå‘å°„â€æ—¶ï¼Œæ‰§è¡Œ Launch æ–¹æ³• _aimController.OnFire += Launch; } void OnDisable() { // å…»æˆå¥½ä¹ æƒ¯ï¼šè¦åœ¨ OnDisable å–æ¶ˆè®¢é˜…ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ _aimController.OnFire -= Launch; } void Launch(Vector2 forceVector) { // 2D ç‰©ç†å‘å°„ // Impulse æ¨¡å¼é€‚åˆç¬é—´çš„çˆ†å‘åŠ›ï¼ˆå¦‚å¼€ç‚®ã€è·³è·ƒï¼‰ _rb.AddForce(forceVector, ForceMode2D.Impulse); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ (2D ç‰¹åŒ–) å±å¹•è½¬ä¸–ç•Œåæ ‡çš„ Z è½´å½’é›¶ï¼š\nScreenToWorldPointÂ å¿…é¡»å¤„ç† Z è½´ã€‚å¦‚æœä¸å¤„ç†ï¼Œå®ƒä¼šè¿”å›Â Camera.zÂ (é€šå¸¸æ˜¯ -10)ï¼Œå¯¼è‡´è·ç¦»è®¡ç®—é”™è¯¯ã€‚\næ ‡å‡†å†™æ³•ï¼šVector2 worldPos = Camera.main.ScreenToWorldPoint(Input.mousePosition);Â (C# è‡ªåŠ¨æŠŠ Vector3 å¼ºè½¬ä¸º Vector2ï¼Œè‡ªåŠ¨ä¸¢å¼ƒ Z è½´ï¼Œè¿™æ˜¯æœ€å®‰å…¨çš„åšæ³•)ã€‚\nè§£è€¦è®¾è®¡ (Decoupling)ï¼š\nè¿™ä¸ªè„šæœ¬åªè´Ÿè´£â€œç®—åŠ›åº¦â€ï¼Œä¸è´Ÿè´£â€œæ€ä¹ˆåŠ¨â€ã€‚\né€šè¿‡Â ActionÂ æŠŠåŠ›åº¦ä¼ å‡ºå»ï¼Œä½ å¯ä»¥æŠŠè¿™ä¸ªè„šæœ¬æŒ‚åœ¨ä¸»è§’èº«ä¸Šè®©ä»–é£ï¼Œä¹Ÿå¯ä»¥æŒ‚åœ¨å¼¹å¼“ä¸Šå‘å°„çŸ³å¤´ï¼Œç”šè‡³æŒ‚åœ¨ UI æ‘‡æ†ä¸Šã€‚\nVector2.ClampMagnitudeï¼š\nè¿™æ˜¯é™åˆ¶è“„åŠ›ä¸Šé™çš„ç¥å™¨ã€‚æ¯”æ‰‹åŠ¨å†™Â if (v.magnitude \u0026gt; max) v = v.normalized * maxÂ è¦ä¼˜é›…å¾—å¤šã€‚ LineRenderer æ’åºï¼š\nåœ¨ 2D æ¸¸æˆä¸­ï¼ŒLineRenderer ç»å¸¸è¢«èƒŒæ™¯é®æŒ¡ã€‚è®°å¾—è®¾ç½®Â sortingOrderÂ æˆ–è€…Â sortingLayerNameÂ ç¡®ä¿å®ƒç”»åœ¨æœ€ä¸Šå±‚ã€‚ 2.æŠ›ç‰©çº¿ç„å‡† 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 using System.Collections.Generic; using UnityEngine; [RequireComponent(typeof(LineRenderer))] [RequireComponent(typeof(Rigidbody2D))] // éœ€è¦ç‰©ç†ç»„ä»¶æ¥è·å–è´¨é‡å’Œé‡åŠ›ç¼©æ”¾ public class ParabolicAimController : MonoBehaviour { [Header(\u0026#34;ç‰©ç†å‚æ•°\u0026#34;)] public float maxPower = 20f; public float powerMultiplier = 3f; public float maxDragDistance = 3f; [Header(\u0026#34;æŠ›ç‰©çº¿è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ¨¡æ‹Ÿçš„ç‚¹æ•°é‡ï¼ˆç‚¹è¶Šå¤šçº¿è¶Šåœ†æ»‘ï¼Œä½†æ¶ˆè€—è¶Šé«˜ï¼‰\u0026#34;)] public int resolution = 30; [Tooltip(\u0026#34;æ¨¡æ‹Ÿçš„æ€»æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œå†³å®šçº¿èƒ½ç”»å¤šé•¿\u0026#34;)] public float simulationDuration = 1.5f; [Tooltip(\u0026#34;ç¢°æ’æ£€æµ‹å±‚çº§ï¼ˆçº¿ç¢°åˆ°ä»€ä¹ˆå±‚çº§ä¼šåœæ­¢ç»˜åˆ¶ï¼Œæ¯”å¦‚åœ°é¢/å¢™å£ï¼‰\u0026#34;)] public LayerMask collisionLayer; // äº‹ä»¶ public System.Action\u0026lt;Vector2\u0026gt; OnFire; private LineRenderer _lineRenderer; private Rigidbody2D _rb; private bool _isDragging = false; private Vector2 _startPoint; private Camera _mainCam; void Awake() { _mainCam = Camera.main; _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); _lineRenderer = GetComponent\u0026lt;LineRenderer\u0026gt;(); _lineRenderer.enabled = false; _lineRenderer.sortingOrder = 10; // å…³é”®ä¼˜åŒ–ï¼šè®©çº¿çœ‹èµ·æ¥æ›´åƒè™šçº¿æˆ–å¹³æ»‘æ›²çº¿ _lineRenderer.positionCount = resolution; } void Update() { HandleInput(); } private void HandleInput() { if (Input.GetMouseButtonDown(0)) StartAiming(); if (_isDragging \u0026amp;\u0026amp; Input.GetMouseButton(0)) UpdateAiming(); if (_isDragging \u0026amp;\u0026amp; Input.GetMouseButtonUp(0)) Fire(); } private void StartAiming() { _isDragging = true; _startPoint = transform.position; _lineRenderer.enabled = true; } private void UpdateAiming() { // 1. è®¡ç®—å‘å°„åŠ›åº¦å‘é‡ (Force) Vector2 forceVector = CalculateForce(); // 2. å°† åŠ› è½¬æ¢ä¸º åˆé€Ÿåº¦ (Velocity) // ç‰©ç†å…¬å¼ï¼šF = m * a =\u0026gt; a = F / m // å¦‚æœä½¿ç”¨ ForceMode2D.Impulseï¼Œç¬æ—¶é€Ÿåº¦å˜åŒ–é‡ = Force / Mass // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾ä½ å‘å°„æ—¶ä½¿ç”¨çš„æ˜¯ Impulse æ¨¡å¼ Vector2 launchVelocity = forceVector / _rb.mass; // 3. ç»˜åˆ¶æŠ›ç‰©çº¿ DrawTrajectory(launchVelocity); } private void DrawTrajectory(Vector2 initialVelocity) { Vector3[] points = new Vector3[resolution]; points[0] = transform.position; // èµ·ç‚¹ // è·å–å½“å‰ä¸–ç•Œçš„é‡åŠ›åŠ é€Ÿåº¦ (åˆ«å¿˜äº†ä¹˜ç‰©ä½“è‡ªèº«çš„é‡åŠ›ç¼©æ”¾) Vector2 gravity = Physics2D.gravity * _rb.gravityScale; for (int i = 1; i \u0026lt; resolution; i++) { // è®¡ç®—æ—¶é—´ç‚¹ t float t = (float)i / resolution * simulationDuration; // æ ¸å¿ƒç‰©ç†å…¬å¼ï¼šP = P0 + vt + 0.5gt^2 Vector2 displacement = (initialVelocity * t) + (0.5f * gravity * (t * t)); Vector2 drawPoint = (Vector2)transform.position + displacement; // ç¢°æ’æ£€æµ‹ï¼šé˜²æ­¢çº¿ç©¿å¢™ // æ£€æµ‹ä¸Šä¸€ä¸ªç‚¹åˆ°å½“å‰ç‚¹ä¹‹é—´æœ‰æ²¡æœ‰éšœç¢ç‰© Vector2 previousPoint = points[i - 1]; Vector2 direction = drawPoint - previousPoint; float distance = direction.magnitude; RaycastHit2D hit = Physics2D.Raycast(previousPoint, direction.normalized, distance, collisionLayer); if (hit.collider != null) { // å¦‚æœæ’åˆ°äº†å¢™ï¼ŒæŠŠå½“å‰ç‚¹è®¾ä¸ºæ’å‡»ç‚¹ points[i] = hit.point; // å‰©ä¸‹çš„ç‚¹å…¨éƒ¨é‡å åœ¨è¿™ä¸ªæ’å‡»ç‚¹ä¸Šï¼ˆæˆ–è€…ä½ å¯ä»¥ç›´æ¥æˆªæ–­ LineRenderer çš„ countï¼‰ // è¿™é‡Œä¸ºäº†ç®€å•ï¼ŒæŠŠå‰©ä¸‹çš„ç‚¹éƒ½è®¾ä¸ºåŒä¸€ä¸ªä½ç½®ï¼Œè§†è§‰ä¸Šå°±æ˜¯çº¿åœä½äº† for (int j = i + 1; j \u0026lt; resolution; j++) { points[j] = hit.point; } break; // åœæ­¢è®¡ç®—åç»­è½¨è¿¹ } points[i] = drawPoint; } _lineRenderer.SetPositions(points); } private Vector2 CalculateForce() { Vector3 rawMousePos = _mainCam.ScreenToWorldPoint(Input.mousePosition); Vector2 mousePos = new Vector2(rawMousePos.x, rawMousePos.y); Vector2 dragVector = mousePos - _startPoint; if (dragVector.magnitude \u0026gt; maxDragDistance) { dragVector = dragVector.normalized * maxDragDistance; } // åå‘æ‹–æ‹½ return -dragVector * powerMultiplier; } private void Fire() { _isDragging = false; _lineRenderer.enabled = false; Vector2 forceVector = CalculateForce(); // é™åˆ¶æœ€å¤§åŠ›åº¦ forceVector = Vector2.ClampMagnitude(forceVector, maxPower); if (forceVector.magnitude \u0026gt; 0.1f) { OnFire?.Invoke(forceVector); } } } å¦‚ä½•è®¾ç½® Unity ç»„ä»¶ ä¸ºäº†è®©æ•ˆæœæœ€å¥½ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nLineRenderer è®¾ç½®ï¼š\nWidth: è®¾ä¸º 0.1 æˆ– 0.2ï¼Œä¸¤å¤´å¯ä»¥è®¾ç½®æ¸å˜ï¼ˆå¤´éƒ¨ç²—å°¾éƒ¨ç»†ï¼‰ã€‚\nMaterial: æ‰¾ä¸€ä¸ªç®€å•çš„Â Sprites-DefaultÂ æè´¨ï¼Œæˆ–è€…è™šçº¿æè´¨ã€‚\nColor: è®¾ä¸ºç™½è‰²å¸¦é€æ˜åº¦ï¼Œæˆ–è€…äº®é»„è‰²ã€‚\nTexture Mode: å»ºè®®è®¾ä¸ºÂ TileÂ å¹¶é…åˆè™šçº¿è´´å›¾ï¼Œè¿™æ ·çœ‹èµ·æ¥å°±æ˜¯ä¸€æ¡ä¸€æ¡çš„è™šçº¿è½¨è¿¹ã€‚\nRigidbody2D è®¾ç½®ï¼š\nMass: å»ºè®®é»˜è®¤ä¸º 1ã€‚\nGravity Scale: å»ºè®®è®¾ä¸º 2~4ï¼Œæ‰‹æ„Ÿæ¯”è¾ƒæ‰å®ã€‚\nLayer Mask:\nåˆ›å»ºä¸€ä¸ª Layer å«Â GroundÂ æˆ–Â Wallã€‚\næŠŠåœ°æ¿å’Œå¢™å£è®¾ä¸ºè¿™ä¸ª Layerã€‚\nåœ¨è„šæœ¬çš„Â Collision LayerÂ é€‰é¡¹ä¸­ï¼Œåªå‹¾é€‰Â GroundÂ å’ŒÂ Wallã€‚\nåƒä¸‡ä¸è¦å‹¾é€‰ Player è‡ªå·±ï¼Œå¦åˆ™å°„çº¿ä¸€å‡ºæ¥å°±æ‰“ä¸­è‡ªå·±ï¼Œçº¿ä¼šæ˜¾ç¤ºä¸å‡ºæ¥ã€‚\nå‘å°„è„šæœ¬ (PlayerMovement)ï¼š\nå’Œä¹‹å‰ä¸€æ ·ï¼Œè®¢é˜…Â OnFireÂ äº‹ä»¶ã€‚\nå…³é”®ï¼šå‘å°„æ—¶å¿…é¡»ä½¿ç”¨Â ImpulseÂ æ¨¡å¼ï¼Œæ‰èƒ½åŒ¹é…æˆ‘ä»¬çš„é¢„æµ‹ç®—æ³•ã€‚\n1 2 3 4 5 void Launch(Vector2 force) { // å¿…é¡»æ˜¯ç”¨ Impulseï¼Œå› ä¸ºæˆ‘ä»¬çš„é¢„æµ‹ç®—æ³•åŸºäºç¬æ—¶é€Ÿåº¦æ”¹å˜ _rb.AddForce(force, ForceMode2D.Impulse); } ä¹ã€æ•°å€¼ä¸UIç»‘å®šç³»ç»Ÿ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒæ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆé€šè¿‡ C#Â event ActionÂ å®ç°ï¼‰ã€‚\nè®¾è®¡ç›®çš„ï¼šåˆ›å»ºä¸€ä¸ªé€šç”¨çš„æ•°å€¼å®¹å™¨ï¼Œä»»ä½•æ•°å€¼å˜åŒ–éƒ½èƒ½è‡ªåŠ¨é€šçŸ¥ç›‘å¬è€…ï¼ˆUIã€ç‰¹æ•ˆç®¡ç†å™¨ã€éŸ³æ•ˆç®¡ç†å™¨ï¼‰ã€‚\näº®ç‚¹ï¼š\n[System.Serializable]ï¼šè¿™æ˜¯ä¸€ä¸ªçº¯ C# ç±»ï¼Œä½†åŠ ä¸Šè¿™ä¸ªæ ‡ç­¾åï¼Œå®ƒå°±èƒ½åƒ Unity åŸç”Ÿç»„ä»¶ä¸€æ ·æ˜¾ç¤ºåœ¨ Inspector é¢æ¿ä¸­ï¼Œéå¸¸æ–¹ä¾¿è°ƒè¯•ã€‚\nMathf.Clampï¼šæ•°æ®å®‰å…¨ä¿æŠ¤ï¼Œé˜²æ­¢è¡€é‡å˜æˆè´Ÿæ•°æˆ–è¶…è¿‡ä¸Šé™ï¼Œæœç»äº†ç»å…¸çš„â€œè´Ÿè¡€ä¸æ­»â€æˆ–â€œè¡€æ¡æº¢å‡ºâ€Bugã€‚\nOnDepletedï¼šä¸“é—¨ä¸ºâ€œå½’é›¶â€ï¼ˆæ­»äº¡/æ²¡è“ï¼‰è®¾è®¡çš„äº‹ä»¶ï¼Œé€»è¾‘æ¸…æ™°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 using System; using UnityEngine; [System.Serializable] public class ObservableStat { [SerializeField] private float _currentValue; [SerializeField] private float _maxValue; // ä¼˜åŒ–ï¼šå¢åŠ ä¸€ä¸ªåªè¯»å±æ€§ï¼Œç›´æ¥è¿”å› 0-1 çš„ç™¾åˆ†æ¯”ï¼Œæ–¹ä¾¿ UI ä½¿ç”¨ public float Ratio =\u0026gt; (_maxValue \u0026gt; 0) ? (_currentValue / _maxValue) : 0f; public float Current =\u0026gt; _currentValue; public float Max =\u0026gt; _maxValue; public event Action\u0026lt;ObservableStat\u0026gt; OnValueChanged; // ä¼ è‡ªå·±å‡ºå»ï¼Œå‚æ•°æ›´çµæ´» public event Action OnDepleted; // æ„é€ å‡½æ•°ï¼Œæ–¹ä¾¿ä»£ç é‡Œç›´æ¥ new public ObservableStat(float max, float current = -1) { _maxValue = max; _currentValue = (current \u0026lt; 0) ? max : current; } /// \u0026lt;summary\u0026gt; /// åˆå§‹åŒ–ï¼ˆé€šå¸¸åœ¨ Start æˆ– Awake ä¸­è°ƒç”¨ï¼‰ /// \u0026lt;/summary\u0026gt; public void Initialize(float max, float current = -1) { _maxValue = max; _currentValue = (current \u0026lt; 0) ? max : current; Notify(); } /// \u0026lt;summary\u0026gt; /// ç›¸å¯¹ä¿®æ”¹ (åŠ è¡€/æ‰£è¡€) /// \u0026lt;/summary\u0026gt; public void Modify(float amount) { if (Mathf.Approximately(amount, 0f)) return; // æ²¡å˜åŒ–å°±ä¸æ‰§è¡Œ float finalValue = _currentValue + amount; SetCurrent(finalValue); } /// \u0026lt;summary\u0026gt; /// ç»å¯¹ä¿®æ”¹ (ç›´æ¥è®¾ç½®è¡€é‡) /// \u0026lt;/summary\u0026gt; public void SetCurrent(float value) { float prevValue = _currentValue; _currentValue = Mathf.Clamp(value, 0, _maxValue); if (!Mathf.Approximately(_currentValue, prevValue)) { Notify(); if (_currentValue \u0026lt;= 0) OnDepleted?.Invoke(); } } /// \u0026lt;summary\u0026gt; /// ä¿®æ”¹æœ€å¤§å€¼ (æ¯”å¦‚å‡çº§ï¼Œè·å¾—Buff) /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;newMax\u0026#34;\u0026gt;æ–°ä¸Šé™\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;keepRatio\u0026#34;\u0026gt;æ˜¯å¦ä¿æŒç™¾åˆ†æ¯”? (True=ç­‰æ¯”åŠ è¡€, False=åªåŠ ä¸Šé™å½“å‰è¡€ä¸å˜)\u0026lt;/param\u0026gt; public void SetMax(float newMax, bool keepRatio = true) { if (newMax \u0026lt;= 0) return; float ratio = Ratio; _maxValue = newMax; if (keepRatio) { _currentValue = _maxValue * ratio; } else { _currentValue = Mathf.Clamp(_currentValue, 0, _maxValue); } Notify(); } // ä¾› Unity ç¼–è¾‘å™¨è„šæœ¬è°ƒç”¨ï¼Œè§£å†³ Inspector ä¿®æ”¹æ•°å€¼ä¸åˆ·æ–° UI çš„é—®é¢˜ // æ³¨æ„ï¼šè¿™éœ€è¦é…åˆè‡ªå®šä¹‰ Editor è„šæœ¬ä½¿ç”¨ï¼Œæˆ–è€…åœ¨ OnValidate é‡Œæ‰‹åŠ¨è°ƒç”¨ public void EditorForceNotify() =\u0026gt; Notify(); private void Notify() { // ä¼ é€’ \u0026#39;this\u0026#39;ï¼Œè®©ç›‘å¬è€…å¯ä»¥è®¿é—® Ratio, Current, Max ç­‰æ‰€æœ‰å±æ€§ OnValueChanged?.Invoke(this); } } ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼šUI è¡€æ¡ç»‘å®š æœ‰äº†Â RatioÂ å±æ€§å’Œæ”¹è‰¯çš„äº‹ä»¶ï¼Œä½ çš„ UI è„šæœ¬ä¼šå˜å¾—å¼‚å¸¸ç®€æ´ã€‚\nHealthBarUI.cs (UI è„šæœ¬)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 using UnityEngine; using UnityEngine.UI; using DG.Tweening; // å¼ºçƒˆå»ºè®®é…åˆ DOTween åšè¡€æ¡ç¼“å†² public class HealthBarUI : MonoBehaviour { public Image fillImage; public Image easeImage; // ç¼“å†²å±‚ï¼ˆé»„è‰²è¡€æ¡ï¼‰ // ç°åœ¨çš„å‚æ•°ç›´æ¥æ˜¯ ObservableStat å¯¹è±¡ï¼Œå¤ªæ–¹ä¾¿äº† public void UpdateHealth(ObservableStat stat) { // 1. ç›´æ¥æ‹¿ç™¾åˆ†æ¯” float targetFill = stat.Ratio; // 2. ä¸»è¡€æ¡ç›´æ¥å˜ fillImage.fillAmount = targetFill; // 3. ç¼“å†²è¡€æ¡æ…¢æ…¢å˜ (DOTween) if (easeImage != null) { easeImage.DOKill(); easeImage.DOFillAmount(targetFill, 0.5f).SetEase(Ease.OutCirc); } } } Player.cs (è§’è‰²è„šæœ¬) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 public class Player : MonoBehaviour { public ObservableStat health = new ObservableStat(100); public HealthBarUI healthBar; void Start() { // åˆå§‹åŒ– health.Initialize(100); // ç»‘å®š UI health.OnValueChanged += healthBar.UpdateHealth; // å¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡ UIï¼Œè®©è¡€æ¡æ˜¾ç¤ºåˆå§‹çŠ¶æ€ // è¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œé˜²æ­¢ UI åœ¨ Start å‰æ˜¯ç©ºçš„ health.Modify(0); } void Update() { // æµ‹è¯•æ‰£è¡€ if (Input.GetKeyDown(KeyCode.Space)) { health.Modify(-10); } // æµ‹è¯•å‡çº§ (è¡€é‡ä¸Šé™ç¿»å€ï¼Œä¿æŒç™¾åˆ†æ¯”) if (Input.GetKeyDown(KeyCode.U)) { health.SetMax(health.Max * 2, true); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ MVC æ€æƒ³ (Model-View-Controller)ï¼š\nObservableStatÂ æ˜¯Â ModelÂ (çº¯æ•°æ®)ã€‚\nHealthBarUIÂ æ˜¯Â ViewÂ (çº¯è¡¨ç°)ã€‚\nPlayerÂ æ˜¯Â ControllerÂ (æŠŠ Model ç»™ View)ã€‚\nè¿™æ˜¯é¿å…é¡¹ç›®åæœŸå˜æˆâ€œä»£ç å±å±±â€çš„å”¯ä¸€è§£è¯ã€‚\näº‹ä»¶å‚æ•°ä¼˜åŒ–ï¼š\nåŸä»£ç ä¼ Â float, floatã€‚æ”¹è‰¯ç‰ˆä¼ Â this (ObservableStat)ã€‚\nä¸ºä»€ä¹ˆï¼ŸÂ ä¼ å¯¹è±¡æ‰©å±•æ€§æ›´å¼ºã€‚å¦‚æœæœªæ¥ UI æƒ³è¦æ˜¾ç¤ºâ€œæ˜¯å¦æ¿’æ­»â€çŠ¶æ€ï¼Œç›´æ¥è®¿é—®Â stat.Current \u0026lt; 10Â å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹äº‹ä»¶ç­¾åã€‚\nRatio å±æ€§ï¼š\nå°è£…Â Current / MaxÂ çš„è®¡ç®—é€»è¾‘ã€‚æ°¸è¿œä¸è¦åœ¨ UI å±‚åšæ•°å­¦é¢˜ï¼ŒModel å±‚åº”è¯¥æä¾›å¥½ç°æˆçš„æ•°æ®ã€‚ åºåˆ—åŒ–ç±»çš„å±€é™æ€§ï¼š\nè™½ç„¶Â [Serializable]Â å¾ˆæ£’ï¼Œä½†è¦æ³¨æ„ï¼šå®ƒæ˜¯å¼•ç”¨ç±»å‹ã€‚å¦‚æœä½ ç›´æ¥Â new ObservableStat()Â èµ‹å€¼ç»™ä¸¤ä¸ªå˜é‡ï¼Œå®ƒä»¬ä¼šæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼ˆè¡€æ¡åŒæ­¥æ‰£è¡€ï¼‰ã€‚åœ¨ MonoBehaviour å­—æ®µä¸­å®ä¾‹åŒ–æ˜¯å®‰å…¨çš„ã€‚ åã€å¯¹è±¡æ± æ¡†æ¶ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šé¢„å…ˆç”Ÿæˆä¸€æ‰¹ç‰©ä½“éšè—èµ·æ¥ã€‚éœ€è¦æ—¶â€œå€Ÿâ€å‡ºæ¥ï¼ˆæ¿€æ´»ï¼‰ï¼Œç”¨å®Œâ€œè¿˜â€å›å»ï¼ˆéšè—ï¼‰ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„é”€æ¯ã€‚\næ•°æ®ç»“æ„ï¼šQueueï¼ˆé˜Ÿåˆ—ï¼‰ã€‚\nå…ˆè¿›å…ˆå‡º (FIFO)ï¼šè¿™æ˜¯ç®¡ç†æ± å­æœ€å¿«çš„æ•°æ®ç»“æ„ (O(1) å¤æ‚åº¦)ã€‚ 2D åº”ç”¨åœºæ™¯ï¼š\næœºæªå°„å‡ºçš„å­å¼¹ã€‚\né‡‘å¸æ‰è½åŠ¨ç”»ã€‚\næ€ªç‰©çš„æ­»äº¡çˆ†ç‚¸ç‰¹æ•ˆã€‚\næ­¥éª¤ 1ï¼šå®šä¹‰å¤ä½æ¥å£\nä»»ä½•æƒ³æ”¾å…¥æ± å­çš„ä¸œè¥¿ï¼ˆå­å¼¹ã€ç‰¹æ•ˆï¼‰ï¼Œæœ€å¥½éƒ½å®ç°è¿™ä¸ªæ¥å£ã€‚\n1 2 3 4 5 6 7 8 using UnityEngine; // æ‰€æœ‰æ± å­é‡Œçš„ç‰©ä½“ï¼Œå»ºè®®å®ç°è¿™ä¸ªæ¥å£ï¼Œç”¨äºè‡ªåŠ¨â€œæ´—ç™½â€çŠ¶æ€ public interface IPoolable { void OnSpawn(); // å½“ä»æ± å­å–å‡ºæ—¶è°ƒç”¨ï¼ˆä»£æ›¿ Startï¼‰ void OnDespawn(); // å½“æ”¾å›æ± å­æ—¶è°ƒç”¨ï¼ˆä»£æ›¿ OnDestroyï¼‰ } æ­¥éª¤ 2ï¼šç¼–å†™é€šç”¨å¯¹è±¡æ± ç®¡ç†å™¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 ç»§æ‰¿ä¹‹å‰çš„Â SingletonÂ æ¡†æ¶ã€‚using System.Collections.Generic; using UnityEngine; public class ObjectPoolManager : Singleton\u0026lt;ObjectPoolManager\u0026gt; { [System.Serializable] public class PoolConfig { public string tag; // æ ‡è¯†ç¬¦ (å¦‚ \u0026#34;Bullet\u0026#34;, \u0026#34;Coin\u0026#34;) public GameObject prefab; public int size = 20; } [Header(\u0026#34;æ± å­é…ç½®è¡¨\u0026#34;)] public List\u0026lt;PoolConfig\u0026gt; configs; // å­—å…¸ï¼šKeyæ˜¯Tagï¼ŒValueæ˜¯è¯¥Tagå¯¹åº”çš„å¯¹è±¡é˜Ÿåˆ— private Dictionary\u0026lt;string, Queue\u0026lt;GameObject\u0026gt;\u0026gt; _poolDictionary; protected override void Awake() { base.Awake(); InitializePools(); } private void InitializePools() { _poolDictionary = new Dictionary\u0026lt;string, Queue\u0026lt;GameObject\u0026gt;\u0026gt;(); foreach (var config in configs) { Queue\u0026lt;GameObject\u0026gt; objectPool = new Queue\u0026lt;GameObject\u0026gt;(); // åˆ›å»ºçˆ¶èŠ‚ç‚¹ï¼Œä¿æŒ Hierarchy å¹²å‡€æ•´æ´ GameObject poolParent = new GameObject($\u0026#34;Pool_{config.tag}\u0026#34;); poolParent.transform.SetParent(transform); for (int i = 0; i \u0026lt; config.size; i++) { GameObject obj = Instantiate(config.prefab, poolParent.transform); obj.SetActive(false); objectPool.Enqueue(obj); } _poolDictionary.Add(config.tag, objectPool); } } /// \u0026lt;summary\u0026gt; /// è·å–å¯¹è±¡ /// \u0026lt;/summary\u0026gt; public GameObject Spawn(string tag, Vector2 position, Quaternion rotation) { if (!_poolDictionary.ContainsKey(tag)) { Debug.LogWarning($\u0026#34;æ± å­ä¸­ä¸å­˜åœ¨ Tag: {tag}\u0026#34;); return null; } // 1. å–å‡ºå¯¹è±¡ GameObject objToSpawn; Queue\u0026lt;GameObject\u0026gt; pool = _poolDictionary[tag]; if (pool.Count == 0) { // æ± å­ç©ºäº†ï¼Ÿè¿™æ˜¯ä¸ªç­–ç•¥é—®é¢˜ã€‚ // ç­–ç•¥Aï¼šæ‰©å®¹ï¼ˆæ¨èï¼‰ // ç­–ç•¥Bï¼šå¼ºåˆ¶å›æ”¶æœ€æ—©çš„ä¸€ä¸ªï¼ˆé€‚ç”¨äºç‰¹æ•ˆï¼‰ // è¿™é‡Œæ¼”ç¤ºæ‰©å®¹ï¼šéœ€è¦æ‰¾åˆ°å¯¹åº”çš„ prefab æ¯”è¾ƒéº»çƒ¦ï¼Œç®€å•å¤„ç†æ˜¯å¤ç”¨æœ€æ—©çš„æˆ–æŠ¥é”™ // ä¸ºç®€åŒ–ä»£ç ï¼Œå‡è®¾æ± å­å¤Ÿç”¨ï¼Œæˆ–è€…æ­¤å¤„åº”è¯¥æ‰©å®¹é€»è¾‘... // ç®€å•æ‰©å®¹é€»è¾‘ï¼š Debug.LogWarning($\u0026#34;æ± å­ {tag} ç©ºäº†ï¼Œå»ºè®®å¢åŠ åˆå§‹å¤§å°\u0026#34;); return null; } objToSpawn = pool.Dequeue(); // 2. è®¾ç½®ç‰©ç†çŠ¶æ€ objToSpawn.SetActive(true); objToSpawn.transform.position = position; objToSpawn.transform.rotation = rotation; // 3. ã€å…³é”®ã€‘è°ƒç”¨æ¥å£å¤ä½çŠ¶æ€ (Rigidbody, HPç­‰) IPoolable poolable = objToSpawn.GetComponent\u0026lt;IPoolable\u0026gt;(); if (poolable != null) { poolable.OnSpawn(); } return objToSpawn; } /// \u0026lt;summary\u0026gt; /// å›æ”¶å¯¹è±¡ /// \u0026lt;/summary\u0026gt; public void ReturnObj(string tag, GameObject obj) { if (!_poolDictionary.ContainsKey(tag)) return; // è°ƒç”¨å›æ”¶æ¥å£ IPoolable poolable = obj.GetComponent\u0026lt;IPoolable\u0026gt;(); if (poolable != null) { poolable.OnDespawn(); } obj.SetActive(false); _poolDictionary[tag].Enqueue(obj); } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼š2D é£èˆ¹å‘å°„å­å¼¹\nåœºæ™¯è®¾ç½®ï¼š\nåˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“Â BulletPoolï¼ŒæŒ‚è½½æ­¤è„šæœ¬ã€‚\næŠŠÂ BulletPrefabÂ æ‹–è¿›å»ï¼ŒInitial Size è®¾ä¸º 20ã€‚\né£èˆ¹è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class Spaceship : MonoBehaviour { public SimpleObjectPool bulletPool; // å¼•ç”¨æ± å­è„šæœ¬ public Transform firePoint; void Update() { if (Input.GetButtonDown(\u0026#34;Fire1\u0026#34;)) { // ä¸å†ä½¿ç”¨ Instantiateï¼Œè€Œæ˜¯å‘æ± å­è¦ bulletPool.Get(firePoint.position, firePoint.rotation); } } } å­å¼¹å›æ”¶è„šæœ¬ï¼ˆæŒ‚åœ¨å­å¼¹ Prefab ä¸Šï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 [RequireComponent(typeof(Rigidbody2D))] public class Bullet2D : MonoBehaviour, IPoolable { private Rigidbody2D _rb; public float speed = 10f; void Awake() { _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); } // æ¥å£å®ç°ï¼šå–å‡ºæ—¶è‡ªåŠ¨å‘å°„ public void OnSpawn() { // 1. æ¸…é›¶ä¹‹å‰çš„é€Ÿåº¦ï¼ˆéå¸¸é‡è¦ï¼å¦åˆ™å­å¼¹ä¼šä¹±é£ï¼‰ _rb.velocity = Vector2.zero; _rb.angularVelocity = 0f; // 2. é‡æ–°æ–½åŠ åŠ› // transform.right åœ¨ 2D ä¸­é€šå¸¸ä»£è¡¨â€œå‰æ–¹â€ _rb.velocity = transform.right * speed; // 3. å¼€å¯è‡ªåŠ¨å›æ”¶å€’è®¡æ—¶ CancelInvoke(); // é˜²æ­¢é‡å¤ Invoke(nameof(DespawnMe), 3f); } // æ¥å£å®ç°ï¼šå›æ”¶æ—¶æ¸…ç† public void OnDespawn() { // å¯ä»¥åœ¨è¿™é‡Œé‡ç½®ç²’å­æ‹–å°¾ç­‰ } void DespawnMe() { ObjectPoolManager.Instance.ReturnObj(\u0026#34;Bullet\u0026#34;, gameObject); } // ç¢°åˆ°ä¸œè¥¿ä¹Ÿè¦å›æ”¶ void OnTriggerEnter2D(Collider2D other) { if (other.CompareTag(\u0026#34;Enemy\u0026#34;)) { // é€ æˆä¼¤å®³é€»è¾‘... DespawnMe(); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ IPoolable æ¥å£æ¨¡å¼ï¼š\né¢è¯•å¿…æ€æŠ€ã€‚åœ¨å¯¹è±¡æ± ä¸­ï¼Œæœ€å¤§çš„ Bug æ¥æºå°±æ˜¯**â€œè„çŠ¶æ€â€**ï¼ˆDirty Stateï¼‰ã€‚é€šè¿‡æ¥å£å¼ºåˆ¶å¯¹è±¡åœ¨Â OnSpawnÂ ä¸­é‡ç½®è‡ªå·±çš„Â Rigidbody.velocityã€è¡€é‡ã€åŠ¨ç”»çŠ¶æ€æœºï¼Œæ˜¯ 2D æ¸¸æˆç¨³å®šçš„åŸºçŸ³ã€‚ Dictionary æ± ç®¡ç†ï¼š\nä½¿ç”¨Â Dictionary\u0026lt;string, Queue\u0026gt;Â å¯ä»¥è®©ä½ åœ¨ä¸€ä¸ªç®¡ç†å™¨é‡ŒåŒæ—¶å¤„ç†å­å¼¹ã€é‡‘å¸ã€è¡€ç“¶ç­‰å¤šç§ç‰©ä½“ï¼Œä¿æŒé¡¹ç›®ç»“æ„æ¸…æ™°ã€‚ Hierarchy ç®¡ç†ï¼š\nåœ¨Â InitializePoolsÂ ä¸­ï¼Œæˆ‘åˆ›å»ºäº†Â poolParentã€‚è¿™ä¼šè®© Unity ç¼–è¾‘å™¨çš„ Hierarchy é¢æ¿éå¸¸æ•´æ´ï¼Œè€Œä¸æ˜¯å‡ ç™¾ä¸ªå­å¼¹æ•£è½åœ¨æ ¹ç›®å½•ä¸‹ã€‚ 2D ç‰©ç†é™·é˜±ï¼š\nåˆ‡è®°ï¼šGameObject.SetActive(false)Â ä¸ä¼šè‡ªåŠ¨æ¸…ç©º Rigidbody çš„é€Ÿåº¦ã€‚å¦‚æœä½ ä¸æ‰‹åŠ¨Â velocity = Vector2.zeroï¼Œä¸‹æ¬¡æ¿€æ´»æ—¶ç‰©ä½“ä¼šç¬ç§»æˆ–ä¿ç•™æƒ¯æ€§ã€‚ åä¸€ã€è§†è§‰åé¦ˆ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šä¸ºæ¸¸æˆç‰©ä½“æä¾›ä¸€å¥—é€šç”¨çš„è§†è§‰åé¦ˆæ¥å£ï¼ˆç¼©æ”¾ã€å˜è‰²ã€éœ‡åŠ¨ï¼‰ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nPlayPunchScaleï¼šUI æŒ‰é’®ç‚¹å‡»ã€è·å¾—é‡‘å¸ã€å²è±å§†è½åœ°ã€‚\nPlayFlashï¼šè§’è‰²å—å‡»ï¼ˆHit Flashï¼‰ã€æ‹¾å–é“å…·é«˜äº®ã€‚\nPlayShakeï¼šç‚¸å¼¹çˆ†ç‚¸ã€å—åˆ°é‡å‡»ã€æ–¹å—è¢«ç ´åã€‚\næ ¸å¿ƒæ’ä»¶ï¼šDOTween (éœ€è¦ DG.Tweening å‘½åç©ºé—´)ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 using UnityEngine; using DG.Tweening; public class VisualFeedback : MonoBehaviour { [Header(\u0026#34;å¼¹æ€§ç¼©æ”¾è®¾ç½®\u0026#34;)] // 2D æ¸¸æˆé€šå¸¸ä¸ç¼©æ”¾ Z è½´ï¼Œæ‰€ä»¥ç”¨ Vector2 å³å¯ public Vector2 punchScaleAmount = new Vector2(0.3f, 0.3f); public float punchDuration = 0.2f; [Range(0, 10)] public int vibrato = 10; [Range(0, 1)] public float elasticity = 1f; [Header(\u0026#34;é—ªçƒè®¾ç½®\u0026#34;)] public SpriteRenderer targetSprite; public Color flashColor = Color.red; // é»˜è®¤æ”¹ä¸ºçº¢è‰²ï¼Œå› ä¸ºç™½è‰²é€šå¸¸æ²¡æ•ˆæœ public float flashDuration = 0.1f; // ã€é«˜çº§ã€‘å¦‚æœä½ ä½¿ç”¨äº†æ”¯æŒ \u0026#34;Flash\u0026#34; å±æ€§çš„ Shaderï¼ˆä¾‹å¦‚ Shader Graphï¼‰ï¼Œå‹¾é€‰æ­¤é¡¹ public bool useShaderFlash = false; public string shaderProperty = \u0026#34;_FlashAmount\u0026#34;; private Vector3 _baseScale; // ç¼“å­˜åˆå§‹å¤§å° private Color _baseColor; private Material _targetMaterial; private Tween _flashTween; private Tween _scaleTween; void Start() { // 1. è‡ªåŠ¨è·å–ç»„ä»¶ if (targetSprite == null) targetSprite = GetComponentInChildren\u0026lt;SpriteRenderer\u0026gt;(); // 2. ç¼“å­˜åˆå§‹çŠ¶æ€ï¼ˆå…³é”®ï¼ï¼‰ _baseScale = transform.localScale; if (targetSprite != null) { _baseColor = targetSprite.color; if (useShaderFlash) _targetMaterial = targetSprite.material; } } // çª—å£å…³é—­æˆ–ç‰©ä½“é”€æ¯æ—¶ï¼Œå¿…é¡»æ€æ­»åŠ¨ç”»ï¼Œé˜²æ­¢æŠ¥é”™ void OnDisable() { transform.DOKill(); if (targetSprite != null) targetSprite.DOKill(); if (_targetMaterial != null) _targetMaterial.DOKill(); } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾å¼¹æ€§ç¼©æ”¾ (ä¿®å¤äº†ç¼©æ”¾é‡ç½® Bug) /// \u0026lt;/summary\u0026gt; public void PlayPunchScale() { // æ€æ‰æ—§åŠ¨ç”»ï¼Œé˜²æ­¢å¿«é€Ÿè¿ç»­è°ƒç”¨æ—¶åŠ¨ç”»å åŠ å¯¼è‡´ç‰©ä½“è¶Šæ¥è¶Šå¤§ if (_scaleTween != null \u0026amp;\u0026amp; _scaleTween.IsActive()) _scaleTween.Kill(); // ç¬é—´å¤ä½åˆ°â€œåˆå§‹å¤§å°â€ï¼Œè€Œä¸æ˜¯ Vector3.one transform.localScale = _baseScale; // æ’­æ”¾æ–°åŠ¨ç”» _scaleTween = transform.DOPunchScale(new Vector3(punchScaleAmount.x, punchScaleAmount.y, 0), punchDuration, vibrato, elasticity); } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾å—å‡»é—ªçƒ /// \u0026lt;/summary\u0026gt; public void PlayFlash() { if (targetSprite == null) return; // åŒæ ·ï¼Œå…ˆæ€æ‰æ—§åŠ¨ç”» if (_flashTween != null \u0026amp;\u0026amp; _flashTween.IsActive()) _flashTween.Kill(); if (useShaderFlash \u0026amp;\u0026amp; _targetMaterial != null) { // æ–¹æ¡ˆ Aï¼šé«˜çº§ Shader å˜ç™½ (ä¿®æ”¹ Material å±æ€§ 0 -\u0026gt; 1 -\u0026gt; 0) _targetMaterial.SetFloat(shaderProperty, 0); // å¤ä½ _flashTween = _targetMaterial.DOFloat(1f, shaderProperty, flashDuration) .SetLoops(2, LoopType.Yoyo); } else { // æ–¹æ¡ˆ Bï¼šæ™®é€šé¢œè‰²å åŠ  (å˜çº¢/å˜é€æ˜) targetSprite.color = _baseColor; // å¤ä½ _flashTween = targetSprite.DOColor(flashColor, flashDuration) .SetLoops(2, LoopType.Yoyo); } } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾éœ‡åŠ¨ (å»ºè®®æŒ‚åœ¨ Visual å­ç‰©ä½“ä¸Šï¼Œä¸è¦æŒ‚åœ¨æ ¹èŠ‚ç‚¹) /// \u0026lt;/summary\u0026gt; public void PlayShake(float strength = 0.5f) { transform.DOKill(true); // éœ‡åŠ¨é€šå¸¸éœ€è¦å®Œå…¨è¦†ç›–æ—§éœ‡åŠ¨ // ä»…éœ‡åŠ¨ä½ç½®ï¼Œä¸éœ‡åŠ¨æ—‹è½¬å’Œç¼©æ”¾ // randomness: 90 æ˜¯éœ‡åŠ¨æ–¹å‘çš„éšæœºæ€§ï¼ŒfadeOut: true è¡¨ç¤ºéœ‡åŠ¨ä¼šæ…¢æ…¢åœä¸‹æ¥ transform.DOShakePosition(0.3f, strength, 10, 90, false, true); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ DOKill çš„é‡è¦æ€§ï¼š\nåœ¨æ¸¸æˆä¸­ï¼Œç©å®¶å¯èƒ½ä¼šåœ¨ä¸€ç§’å†…è¿ç»­æ”»å‡» 5 æ¬¡ã€‚å¦‚æœä¸å†™Â DOKillï¼Œ5 ä¸ªåŠ¨ç”»ä¼šåŒæ—¶è¿è¡Œï¼Œå¯¼è‡´é¢œè‰²é”™ä¹±æˆ–è€…ç‰©ä½“ç¼©æ”¾æ¯”ä¾‹çˆ†ç‚¸ã€‚æ°¸è¿œå‡è®¾ä½ çš„å‡½æ•°ä¼šè¢«ç–¯ç‹‚è¿ç»­è°ƒç”¨ã€‚ åˆå§‹å€¼ç¼“å­˜ (_baseScale)ï¼š\nåˆ‡è®°ï¼šæ°¸è¿œä¸è¦å‡è®¾Â transform.localScaleÂ æ˜¯Â Vector3.oneã€‚åœ¨ 2D æ¸¸æˆä¸­ï¼Œä¸ºäº†åšé€è§†æˆ–è°ƒæ•´å¤§å°ï¼Œç¾æœ¯ç»å¸¸ä¼šæŠŠ Scale è®¾ä¸º 0.8 æˆ– -1ï¼ˆç¿»è½¬ï¼‰ã€‚ç›´æ¥èµ‹å€¼Â oneÂ ä¼šç ´åç¾æœ¯æˆæœã€‚ Visual å­ç‰©ä½“æ¶æ„ï¼š\nä¸ºäº†å®ç°å®Œç¾çš„Â PlayShakeï¼Œå»ºè®®ä½ çš„ Hierarchy ç»“æ„å¦‚ä¸‹ï¼š\nPlayer (Root): æŒ‚Â Rigidbody2D,Â Collider2D,Â MovementScriptã€‚\n\u0026ndash; Visual (Child): æŒ‚Â SpriteRenderer,Â VisualFeedbackã€‚\nè¿™æ ·Â PlayShakeÂ åªä¼šéœ‡åŠ¨Â Visualï¼Œè€Œä¸ä¼šå½±å“Â RootÂ çš„ç‰©ç†ç§»åŠ¨ã€‚\nShader Flash (è¿›é˜¶)ï¼š\nå¦‚æœä½ æƒ³è¦é‚£ç§â€œäº®ççœ¼â€çš„çº¯ç™½é—ªå…‰ï¼Œå» Unity Asset Store æœä¸€ä¸ªå…è´¹çš„Â \u0026ldquo;Sprite Flash Shader\u0026rdquo;ï¼Œç„¶åå‹¾é€‰è„šæœ¬é‡Œçš„Â useShaderFlashï¼Œæ•ˆæœä¼šæ¯”æ”¹ Color å¥½ä¸€ä¸‡å€ã€‚ åäºŒã€åˆšä½“é€Ÿåº¦ä¿æŒ/ä¼ é€é—¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå®ç°ä¿ç•™åŠ¨é‡ï¼ˆMomentumï¼‰çš„ç‰©ç†ä¼ é€ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nPortal æœºåˆ¶ï¼šåƒã€Šä¼ é€é—¨ã€‹é‚£æ ·è¿›å»å‡ºæ¥é€Ÿåº¦ä¸å˜ã€‚\nå±å¹•ç¯ç»•ï¼ˆScreen Wrappingï¼‰ï¼šåƒã€Šåƒè±†äººã€‹æˆ–ã€ŠAsteroidsã€‹ï¼Œä»å±å¹•å·¦è¾¹é£å‡ºå»ï¼Œä»å³è¾¹é£è¿›æ¥ï¼Œé€Ÿåº¦ä¿æŒä¸€è‡´ã€‚\nç¬ç§»æŠ€èƒ½ï¼šè§’è‰²é—ªç°åˆ°æ•Œäººèº«åï¼Œä½†ä¿æŒä¹‹å‰çš„å†²åˆºæƒ¯æ€§ã€‚\næ ¸å¿ƒæŠ€å·§ï¼šstoredVelocityã€‚è¿™æ˜¯ä¸ºäº†å¯¹æŠ— Unity ç‰©ç†å¼•æ“çš„â€œç¢°æ’åè‡ªåŠ¨å‡é€Ÿâ€æœºåˆ¶ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 using UnityEngine; using System.Collections; [RequireComponent(typeof(Rigidbody2D))] public class PhysicsTeleporter : MonoBehaviour { private Rigidbody2D _rb; private TrailRenderer _trail; // ç¼“å­˜æ‹–å°¾ç»„ä»¶ private Vector2 _storedVelocity; // ä¼ é€å†·å´æ—¶é—´ï¼Œé˜²æ­¢åœ¨ä¸¤ä¸ªé—¨ä¹‹é—´é«˜é¢‘é¬¼ç•œ private float _cooldownTimer = 0f; private const float COOLDOWN_DURATION = 0.2f; void Awake() { _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); _trail = GetComponentInChildren\u0026lt;TrailRenderer\u0026gt;(); // å°è¯•è‡ªåŠ¨æ‰¾æ‹–å°¾ } void FixedUpdate() { // åªæœ‰åœ¨éä¼ é€å†·å´æœŸæ‰è®°å½•é€Ÿåº¦ // é˜²æ­¢åˆšä¼ é€å®Œé‚£ä¸€å¸§é€Ÿåº¦è¢«é‡ç½®å¯¼è‡´åŠ¨é‡ä¸¢å¤± if (_cooldownTimer \u0026lt;= 0) { _storedVelocity = _rb.velocity; } else { _cooldownTimer -= Time.fixedDeltaTime; } } public void TeleportTo(Vector3 newPosition, bool invertX = false, bool invertY = false) { if (_cooldownTimer \u0026gt; 0) return; // å†·å´ä¸­ï¼Œä¸ä¼ é€ StartCoroutine(ExecuteTeleport(newPosition, invertX, invertY)); } // ä½¿ç”¨åç¨‹æ¥å¤„ç† Trail çš„æ–­å¼€å’Œé‡è¿ private IEnumerator ExecuteTeleport(Vector3 newPos, bool invertX, bool invertY) { // 1. æš‚æ—¶å…³é—­æ‹–å°¾ï¼ˆé˜²æ­¢æ‹‰ä¸ï¼‰ float originalTime = 0; if (_trail != null) { originalTime = _trail.time; _trail.time = 0; // å°†æ—¶é—´è®¾ä¸º0ä¼šæ¸…é™¤å½“å‰æ‹–å°¾ _trail.emitting = false; } // 2. ç§»åŠ¨ä½ç½® transform.position = newPos; // 3. è®¡ç®—å¹¶åº”ç”¨æ–°é€Ÿåº¦ Vector2 newVel = _storedVelocity; if (invertX) newVel.x = -newVel.x; if (invertY) newVel.y = -newVel.y; _rb.velocity = newVel; // å¼€å¯å†·å´ _cooldownTimer = COOLDOWN_DURATION; // 4. ç­‰å¾…ä¸€å¸§ï¼Œè®©æ¸²æŸ“å¼•æ“æ›´æ–°ä½ç½®ï¼Œä¸å†æ‹‰ä¸ yield return null; // 5. æ¢å¤æ‹–å°¾ if (_trail != null) { _trail.time = originalTime; _trail.emitting = true; } } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ï¼šåˆ¶ä½œä¸€å¯¹ä¼ é€é—¨ ä½ éœ€è¦ä¸¤ä¸ªç‰©ä½“ï¼šPortalAÂ å’ŒÂ PortalBï¼Œä»¥åŠä¸€ä¸ªä¸»è§’ã€‚\nPortal.cs (ä¼ é€é—¨è§¦å‘å™¨) public class Portal : MonoBehaviour { public Transform targetPortal; // è¿æ¥åˆ°å¦ä¸€ä¸ªé—¨ public bool invertX; // æ˜¯å¦åè½¬Xé€Ÿåº¦ void OnTriggerEnter2D(Collider2D other) { // 1. æ£€æŸ¥æ˜¯å¦æ˜¯å¸¦ä¼ é€åŠŸèƒ½çš„ç‰©ä½“ var teleporter = other.GetComponent(); if (teleporter != null) { // 2. è°ƒç”¨ä¼ é€ // æ³¨æ„ï¼šå‡ºç‚¹ä½ç½®é€šå¸¸è¦ç¨å¾®åç§»ä¸€ç‚¹ï¼Œé˜²æ­¢æ— é™å¾ªç¯ä¼ é€ Vector3 exitPos = targetPortal.position; teleporter.TeleportTo(exitPos, invertX, false); } } }\næ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ FixedUpdate ç¼“å­˜æœºåˆ¶ï¼š\né¢è¯•é‡‘å¥ï¼šå¤„ç†ç‰©ç†åå¼¹æˆ–ä¼ é€é€»è¾‘æ—¶ï¼Œæ°¸è¿œä¸è¦ç›¸ä¿¡Â CollisionEnterÂ æ—¶åˆ»çš„Â velocityï¼Œæ°¸è¿œè¦ç”¨Â FixedUpdateÂ ç¼“å­˜çš„â€œä¸Šä¸€å¸§é€Ÿåº¦â€ã€‚ TrailRenderer çš„å‘ï¼š\nå‡¡æ˜¯æ¶‰åŠç¬ç§»ï¼ˆTeleport/Respawnï¼‰çš„åŠŸèƒ½ï¼Œå¿…é¡»å¤„ç†Â TrailRendererã€‚ç®€å•åšæ³•æ˜¯Â Clear()ï¼Œæ›´å½»åº•çš„åšæ³•æ˜¯æš‚æ—¶æŠŠÂ timeÂ è®¾ä¸º 0ã€‚ é˜²æŠ–åŠ¨ (Debounce/Cooldown)ï¼š\nç‰©ç† Trigger å¾ˆå®¹æ˜“åœ¨è¾¹ç¼˜åå¤è§¦å‘ã€‚ä¼ é€åç»™äºˆ 0.1~0.2ç§’ çš„æ— æ•Œ/å†·å´æ—¶é—´ï¼Œæ˜¯é˜²æ­¢é€»è¾‘æ­»é”çš„å¿…è¦æ‰‹æ®µã€‚ åä¸‰ã€æ™ºèƒ½ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå®šæ—¶é”€æ¯ç‰©ä½“ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nåŸå‹å¼€å‘ï¼šå¿«é€Ÿæµ‹è¯•åŠŸèƒ½ã€‚\nä½é¢‘ç‰©ä½“ï¼šæ¯”å¦‚å‡ åˆ†é’Ÿæ‰æ‰è½ä¸€ä¸ªçš„ç‰¹æ®Šé“å…·ï¼Œæˆ–è€…æ˜¯è¿‡å…³ååªå‡ºç°ä¸€æ¬¡çš„èƒœåˆ©ç‰¹æ•ˆã€‚\n2D å¼€å‘ä¸­çš„éšæ‚£ï¼š\nGCï¼ˆåƒåœ¾å›æ”¶ï¼‰å¡é¡¿ï¼šå¦‚æœä½ æŠŠè¿™ä¸ªè„šæœ¬æŒ‚åœ¨å­å¼¹æˆ–å—å‡»ç‰¹æ•ˆä¸Šï¼Œä¸€æŠŠæœºæªæ¯ç§’å°„å‡º 20 å‘å­å¼¹ï¼Œæ„å‘³ç€æ¯ç§’Â newÂ 20æ¬¡ï¼ŒDestroyÂ 20æ¬¡ã€‚è¿™ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ‰‹æœºå‘çƒ«ã€æ¸¸æˆå‘¨æœŸæ€§å¡é¡¿ã€‚\nå¯¹è±¡æ± æ€æ‰‹ï¼šå®ƒä¼šçœŸçš„æŠŠç‰©ä½“ä»å†…å­˜é‡Œåˆ æ‰ã€‚å¦‚æœä½ ç”¨äº†å¯¹è±¡æ± ï¼Œç‰©ä½“è¢«å®ƒåˆ äº†ï¼Œæ± å­å†æ¬¡å¼•ç”¨è¯¥ç‰©ä½“æ—¶å°±ä¼šæŠ¥Â MissingReferenceExceptionï¼ˆç©ºå¼•ç”¨ï¼‰ã€‚\nåœºæ™¯ç¤ºä¾‹ï¼ˆé”™è¯¯ç¤ºèŒƒ vs æ­£ç¡®ç¤ºèŒƒï¼‰ âŒ é”™è¯¯åœºæ™¯ï¼šæŒ‚åœ¨å­å¼¹ä¸Šä½ åšäº†ä¸€ä¸ªå¼¹å¹•æ¸¸æˆï¼ŒåŒå±æœ‰ 500 å‘å­å¼¹ã€‚ä½ ç»™å­å¼¹æŒ‚äº†è¿™ä¸ªè„šæœ¬ã€‚\nåæœï¼šæ¯ä¸€å¸§ Unity éƒ½åœ¨å¿™ç€ç”³è¯·å†…å­˜å’Œé‡Šæ”¾å†…å­˜ï¼Œå¸§ç‡ä» 60 æ‰åˆ° 15ã€‚ âœ… æ­£ç¡®åœºæ™¯ï¼šæŒ‚åœ¨ Boss æ­»äº¡åçš„å‰§æƒ…é“å…·ä¸ŠBoss æ­»äº†ï¼Œæ‰è½äº†ä¸€æŠŠâ€œä¼ è¯´ä¹‹å‰‘â€ï¼Œè¿™æŠŠå‰‘åªå‡ºç°ä¸€æ¬¡ï¼Œæ¡ä¸åˆ°å°±æ¶ˆå¤±ã€‚\nç†ç”±ï¼šè¿™ç§ä½é¢‘äº‹ä»¶ï¼Œä¸ºäº†çœäº‹ç›´æ¥ Destroy æ˜¯å®Œå…¨æ²¡é—®é¢˜çš„ï¼Œæ²¡å¿…è¦ä¸ºäº†ä¸€ä¸ªç‰©ä½“å»å»ºä¸ªå¯¹è±¡æ± ã€‚ è‡ªåŠ¨è¯†åˆ«ç²’å­ç³»ç»Ÿï¼šå¦‚æœæ˜¯ç‰¹æ•ˆï¼Œåº”è¯¥ç­‰ç²’å­æ’­å®Œå†æ¶ˆå¤±ï¼Œè€Œä¸æ˜¯æ­»æ¿åœ°è¯»ç§’ã€‚\nå…¼å®¹å¯¹è±¡æ± ï¼šå¦‚æœæ˜¯æ± å­é‡Œçš„ä¸œè¥¿ï¼Œå°±å½’è¿˜ï¼›å¦‚æœæ˜¯ä¸´æ—¶ç”Ÿæˆçš„ï¼Œå°±é”€æ¯.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 using UnityEngine; public class SmartDespawn : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;å›ºå®šå­˜æ´»æ—¶é—´ï¼ˆå¦‚æœå‹¾é€‰ AutoDetectParticle åˆ™æ­¤é¡¹æ— æ•ˆï¼‰\u0026#34;)] public float lifeTime = 2.0f; [Tooltip(\u0026#34;æ˜¯å¦è‡ªåŠ¨æ ¹æ®ç²’å­ç‰¹æ•ˆçš„æ—¶é•¿æ¥å†³å®šå­˜æ´»æ—¶é—´\u0026#34;)] public bool autoDetectParticle = true; [Tooltip(\u0026#34;å¦‚æœæ˜¯ä»å¯¹è±¡æ± å‡ºæ¥çš„ï¼Œå¿…é¡»å¡«å…¥æ± å­çš„ Tagï¼Œå¦åˆ™ä¼šç›´æ¥ Destroy\u0026#34;)] public string poolTag = \u0026#34;\u0026#34;; private void OnEnable() { float finalDelay = lifeTime; // 1. æ™ºèƒ½æ£€æµ‹ç²’å­ç³»ç»Ÿ if (autoDetectParticle) { ParticleSystem ps = GetComponent\u0026lt;ParticleSystem\u0026gt;(); if (ps != null) { // ç²’å­çš„ duration åªæ˜¯å‘å°„æ—¶é•¿ï¼Œè¦åŠ ä¸Š startLifetime æ‰æ˜¯çœŸæ­£çš„å­˜æ´»æ—¶é—´ // ä½†é€šå¸¸ main.duration + startLifetime æ¯”è¾ƒä¿é™©ï¼Œæˆ–è€…ç›´æ¥ç”¨ main.duration å¦‚æœæ˜¯ loop=false finalDelay = ps.main.duration + ps.main.startLifetime.constantMax; } } // 2. å¯åŠ¨è®¡æ—¶å™¨ // æ—¢ç„¶å¯èƒ½è¦å›æ± å­ï¼Œå°±ä¸èƒ½ç”¨ Destroy(go, time) äº† // æˆ‘ä»¬ç”¨ Invokeï¼Œå› ä¸ºå®ƒæ–¹ä¾¿å–æ¶ˆ CancelInvoke(); Invoke(nameof(Despawn), finalDelay); } private void Despawn() { // 3. æ ¸å¿ƒåˆ†æµé€»è¾‘ï¼šæ˜¯é”€æ¯è¿˜æ˜¯å›æ± å­ï¼Ÿ // æ£€æŸ¥æ˜¯å¦æœ‰æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ IPoolable æ¥å£ï¼ˆæˆ–è€…ç›´æ¥æ ¹æ® poolTag åˆ¤æ–­ï¼‰ // è¿™é‡Œæ¼”ç¤ºé…åˆä¹‹å‰çš„ ObjectPoolManager ä½¿ç”¨ if (!string.IsNullOrEmpty(poolTag) \u0026amp;\u0026amp; ObjectPoolManager.Instance != null) { // å¦‚æœå¡«äº† Tagï¼Œè¯´æ˜æƒ³å›æ± å­ ObjectPoolManager.Instance.ReturnObj(poolTag, gameObject); } else { // æ²¡å¡« Tagï¼Œæˆ–è€…æ˜¯é‡ç”Ÿçš„ç‰©ä½“ï¼Œç›´æ¥é”€æ¯ Destroy(gameObject); } } // å½“ç‰©ä½“è¢«å¼ºåˆ¶éšè—æˆ–æ‰‹åŠ¨å›æ”¶æ—¶ï¼Œå–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è®¡æ—¶ private void OnDisable() { CancelInvoke(); } } 2D ç‰¹æ•ˆç®¡ç†çš„æœ€ä½³å®è·µ åœ¨ 2D æ¸¸æˆä¸­ï¼Œå—å‡»ç‰¹æ•ˆ (Hit Effect)Â å’ŒÂ çˆ†ç‚¸ç‰¹æ•ˆ (Explosion)Â æ˜¯æœ€å¸¸ç”¨çš„ã€‚\nä½¿ç”¨ä¸Šè¿°è„šæœ¬çš„æµç¨‹ï¼š\nåˆ¶ä½œç‰¹æ•ˆ Prefabï¼šåšä¸€ä¸ªçˆ†ç‚¸åŠ¨ç”»ã€‚\næŒ‚è½½è„šæœ¬ï¼šæŒ‚ä¸ŠÂ SmartDespawnã€‚\nå‹¾é€‰Â Auto Detect Particleã€‚\nPool TagÂ å¡«å…¥ \u0026ldquo;Explosion\u0026rdquo;ã€‚\næ”¾å…¥æ± å­ï¼šåœ¨Â ObjectPoolManagerÂ é‡Œæ³¨å†Œ \u0026ldquo;Explosion\u0026rdquo;ã€‚\nè°ƒç”¨ï¼š // æ€ªç‰©è„šæœ¬\n1 2 3 4 5 void OnDeath() { // ä»æ± å­æ‹¿å‡ºæ¥ï¼ŒSmartDespawn çš„ OnEnable ä¼šè‡ªåŠ¨å¼€å§‹å€’è®¡æ—¶ ObjectPoolManager.Instance.Spawn(\u0026#34;Explosion\u0026#34;, transform.position, Quaternion.identity); } è‡ªåŠ¨å›æ”¶ï¼šç²’å­æ’­å®Œåï¼ŒSmartDespawnÂ é‡Œçš„Â InvokeÂ è§¦å‘ï¼Œæ‰§è¡ŒÂ Despawnï¼Œå› ä¸ºå®ƒæœ‰ Tagï¼Œæ‰€ä»¥å®ƒä¼šæŠŠè‡ªå·±è¿˜å›æ± å­ï¼Œè€Œä¸æ˜¯é”€æ¯ã€‚ åäº”ã€2Dæ—‹è½¬å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šè®©ç‰©ä½“ç»•ç€ Z è½´ï¼ˆå‚ç›´äºå±å¹•çš„è½´ï¼‰æŒç»­æ—‹è½¬ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nçº¯è§†è§‰ç‰©ä½“ï¼šUI loading å›¾æ ‡ã€èƒŒæ™¯é‡Œçš„é£è½¦ã€é‡‘å¸ç‰¹æ•ˆã€‚\næ— ç‰©ç†äº¤äº’çš„ç‰©ä½“ï¼šä¸éœ€è¦æŠŠç©å®¶å¼¹å¼€ï¼Œä¹Ÿä¸éœ€è¦äº§ç”Ÿç¢°æ’åŠ›çš„ç‰©ä½“ã€‚\næ ¸å¿ƒé€»è¾‘ï¼šæ¯å¸§ä¿®æ”¹ Transform çš„æ¬§æ‹‰è§’ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 using UnityEngine; public class Rotator2D : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ—‹è½¬é€Ÿåº¦ (åº¦/ç§’)\u0026#34;)] public float speed = 180f; [Tooltip(\u0026#34;æ˜¯å¦é¡ºæ—¶é’ˆ\u0026#34;)] public bool clockwise = true; [Tooltip(\u0026#34;æ—‹è½¬è½´å‘ (2Dæ¸¸æˆé€šå¸¸é€‰ Z)\u0026#34;)] public Vector3 rotateAxis = Vector3.forward; // é»˜è®¤ (0, 0, 1) // ç¼“å­˜ç»„ä»¶ private Rigidbody2D _rb; void Awake() { _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); } void Update() { // å¦‚æœæ²¡æœ‰åˆšä½“ï¼Œå°±åœ¨ Update é‡Œåšçº¯è§†è§‰æ—‹è½¬ (çœæ€§èƒ½) if (_rb == null) { PerformRotation(Time.deltaTime); } } void FixedUpdate() { // å¦‚æœæœ‰åˆšä½“ï¼Œå¿…é¡»åœ¨ FixedUpdate é‡Œåšç‰©ç†æ—‹è½¬ (ä¿è¯ç¢°æ’æ­£ç¡®) if (_rb != null) { PerformPhysicsRotation(Time.fixedDeltaTime); } } // çº¯è§†è§‰æ—‹è½¬é€»è¾‘ private void PerformRotation(float delta) { float dir = clockwise ? -1f : 1f; // ä½¿ç”¨ Rotate çš„è½´å‘é‡è½½ç‰ˆæœ¬ transform.Rotate(rotateAxis, speed * dir * delta); } // ç‰©ç†æ—‹è½¬é€»è¾‘ private void PerformPhysicsRotation(float delta) { float dir = clockwise ? -1f : 1f; // åˆšä½“æ—‹è½¬æ˜¯åŸºäº Z è½´çš„ float angleChange = speed * dir * delta; // MoveRotation æ˜¯ç‰©ç†å®‰å…¨çš„æ—‹è½¬æ–¹å¼ï¼Œå®ƒä¼šè®¡ç®—æ‘©æ“¦åŠ›å’Œç¢°æ’ _rb.MoveRotation(_rb.rotation + angleChange); } } ç®€å•è£…é¥°ç‰©ï¼ˆé‡‘å¸ã€èƒŒæ™¯ï¼‰ï¼šç›´æ¥ç”¨åŸæ¥çš„ä»£ç ï¼ˆæˆ–è€…æ”¹è‰¯ç‰ˆè‡ªåŠ¨èµ°çš„ Update åˆ†æ”¯ï¼‰ï¼Œæ€§èƒ½æœ€å¥½ã€‚\näº¤äº’é™·é˜±ï¼ˆé”¯é½¿ã€é£æ‰‡ï¼‰ï¼šå¿…é¡»ä½¿ç”¨Â Rigidbody2D.MoveRotationï¼Œå¦åˆ™ç¢°æ’æ£€æµ‹ä¼šå¤±æ•ˆã€‚\næ—‹è½¬å¹³å°ï¼šå¿…é¡»ä½¿ç”¨ç‰©ç†æ—‹è½¬ï¼Œå¹¶é…åˆæ‘©æ“¦åŠ›è®¾ç½®ã€‚\nåå…­ã€é¼ æ ‡ç‚¹å‡»å“åº”å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæ£€æµ‹é¼ æ ‡å¯¹ 2D ç‰©ä½“çš„æ“ä½œï¼ˆç‚¹å‡»ã€æ‚¬åœã€ç¦»å¼€ï¼‰ï¼Œå¹¶é€šè¿‡Â UnityEventÂ è§¦å‘å¤–éƒ¨é€»è¾‘ã€‚\nä¾èµ–æ¡ä»¶ï¼š\nç‰©ä½“å¿…é¡»æœ‰Â Collider2Dï¼ˆBoxCollider2D, CircleCollider2D ç­‰ï¼‰ã€‚\nåœºæ™¯ä¸­å¿…é¡»æœ‰æ‘„åƒæœºï¼ˆä¸”æ‘„åƒæœºè§†é”¥ä½“è¦†ç›–è¯¥ç‰©ä½“ï¼‰ã€‚\nä¸èƒ½è¢« UI é®æŒ¡ï¼ˆä½†åŸç”Ÿå†™æ³•å…¶å®é˜²ä¸ä½Â UI é®æŒ¡ï¼Œè¯¦è§ä¸‹æ–‡ï¼‰ã€‚\nè®¾è®¡äº®ç‚¹ï¼šä½¿ç”¨äº†Â UnityEventï¼Œè¿™æ„å‘³ç€ç­–åˆ’äººå‘˜å¯ä»¥ç›´æ¥åœ¨ Inspector é¢æ¿é‡Œæ‹–æ‹½èµ‹å€¼ï¼Œä¸éœ€è¦å†™ä»£ç å°±èƒ½å®ç°â€œç‚¹å‡»å®ç®± -\u0026gt; æ’­æ”¾åŠ¨ç”»â€æˆ–â€œç‚¹å‡»æ€ªç‰© -\u0026gt; æ‰£è¡€â€ã€‚\nä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šä¸€ä¸ªå¯ä»¥ç‚¹å‡»çš„å®ç®±\nåœºæ™¯è®¾ç½®ï¼š\nåœºæ™¯é‡Œæ”¾ä¸€ä¸ªå®ç®± Spriteã€‚\nç»™å®ç®±åŠ Â BoxCollider2Dã€‚\nç»™å®ç®±æŒ‚Â ClickableObjectÂ è„šæœ¬ã€‚\né…ç½® Inspectorï¼š\næ‰¾åˆ°Â On Click ()Â åˆ—è¡¨ã€‚\næ‹–å…¥å®ç®±è‡ªå·±çš„Â AnimatorÂ ç»„ä»¶ã€‚\né€‰æ‹©å‡½æ•°Â Animator.Play(\u0026ldquo;ChestOpen\u0026rdquo;)ã€‚\nå†æ‹–å…¥Â SoundManagerï¼Œé€‰æ‹©Â PlaySound(\u0026ldquo;OpenBox\u0026rdquo;)ã€‚ . æ•ˆæœï¼šç‚¹å‡»å®ç®±ï¼Œè‡ªåŠ¨æ’­æ”¾å¼€ç®±åŠ¨ç”»å¹¶æ’­æ”¾éŸ³æ•ˆï¼Œä¸€è¡Œä»£ç éƒ½ä¸ç”¨å¤šå†™ . ```csharp using UnityEngine; using UnityEngine.Events; using UnityEngine.EventSystems; // 1. å¼•å…¥äº‹ä»¶ç³»ç»Ÿå‘½åç©ºé—´ // 2. å®ç°æ ‡å‡†æ¥å£ [RequireComponent(typeof(Collider2D))] public class ClickableObject : MonoBehaviour, IPointerClickHandler, IPointerEnterHandler, IPointerExitHandler, IPointerDownHandler {\n[Header(\u0026quot;äº¤äº’è®¾ç½®\u0026quot;)] [Tooltip(\u0026quot;æ˜¯å¦å…è®¸ç©¿é€ UI ç‚¹å‡»ï¼ˆé€šå¸¸é€‰ Falseï¼‰\u0026quot;)] public bool allowClickThroughUI = false; [Header(\u0026quot;äº‹ä»¶åé¦ˆ\u0026quot;)] public UnityEvent onClick; public UnityEvent onMouseEnter; public UnityEvent onMouseExit; public UnityEvent onMouseDown; // æ–°å¢ï¼šæŒ‰ä¸‹ç¬é—´ // æ¥å£å®ç°ï¼šç‚¹å‡»ï¼ˆå®Œæ•´çš„æŒ‰ä¸‹+æŠ¬èµ·è¿‡ç¨‹ï¼‰ public void OnPointerClick(PointerEventData eventData) { // è¿™é‡Œä¸éœ€è¦åš UI é˜»æŒ¡åˆ¤æ–­ï¼Œå› ä¸º EventSystem ä¼šè‡ªåŠ¨å¤„ç†å±‚çº§ï¼ // åªè¦ UI æŒ¡åœ¨å‰é¢ï¼Œè¿™ä¸ªæ–¹æ³•å‹æ ¹ä¸ä¼šè§¦å‘ï¼ˆé™¤é UI è®¾ç½®äº†ä¸é˜»æŒ¡å°„çº¿ï¼‰ã€‚ onClick?.Invoke(); } // æ¥å£å®ç°ï¼šé¼ æ ‡æŒ‰ä¸‹ç¬é—´ public void OnPointerDown(PointerEventData eventData) { onMouseDown?.Invoke(); } // æ¥å£å®ç°ï¼šæ‚¬åœè¿›å…¥ public void OnPointerEnter(PointerEventData eventData) { // æ‰‹æœºä¸Šé€šå¸¸ä¸ä¼šè§¦å‘ï¼Œé™¤éæŒ‰ä½æ»‘åŠ¨ç»è¿‡ onMouseEnter?.Invoke(); } // æ¥å£å®ç°ï¼šæ‚¬åœç¦»å¼€ public void OnPointerExit(PointerEventData eventData) { onMouseExit?.Invoke(); } }\nå…³é”®è®¾ç½®ï¼ˆå¿…é¡»åšï¼Œå¦åˆ™ä»£ç æ— æ•ˆï¼ï¼‰ è¦è®©ä¸Šé¢çš„æ¥å£ä»£ç å¯¹ 2D Sprite ç”Ÿæ•ˆï¼Œä½ å¿…é¡»åšä¸€ä»¶äº‹ï¼š\næ‰¾åˆ°ä½ çš„Â Main Cameraã€‚\nç‚¹å‡» Add Componentï¼Œæœç´¢å¹¶æ·»åŠ Â Physics 2D RaycasterÂ ç»„ä»¶ã€‚\nåŸç†ï¼š\nUnity çš„ UI ç³»ç»Ÿï¼ˆCanvasï¼‰é»˜è®¤åªæ£€æµ‹ UI å…ƒç´ ã€‚\nåŠ ä¸ŠÂ Physics 2D RaycasterÂ åï¼Œæ‘„åƒæœºä¼šæŠŠç‰©ç†ä¸–ç•Œçš„ Collider ä¹Ÿè§†ä¸ºâ€œUI çš„ä¸€éƒ¨åˆ†â€å‘é€ç»™ EventSystemã€‚\nå¥½å¤„ï¼šEventSystem ä¼šæ ¹æ®æ·±åº¦ï¼ˆDepthï¼‰è‡ªåŠ¨åˆ¤æ–­è°åœ¨å‰é¢ã€‚å¦‚æœ UI æŒ‰é’®åœ¨ Sprite å‰é¢ï¼Œç‚¹å‡»æ—¶åªæœ‰ UI æŒ‰é’®ä¼šå“ï¼ŒSprite ä¸ä¼šå“ã€‚å®Œç¾è§£å†³äº†ç©¿é€é—®é¢˜ï¼\næ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ UnityEvent çš„å¨åŠ›ï¼š\nåšå·¥å…·ç±»è„šæœ¬æ—¶ï¼Œå°½é‡æš´éœ²Â UnityEventÂ ç»™ç­–åˆ’ï¼Œè€Œä¸æ˜¯å†™æ­»é€»è¾‘ã€‚ OnMouseDown vs EventInterfacesï¼š\nOnMouseDownï¼šç®€å•ç²—æš´ï¼Œé€‚åˆå¿«é€ŸåŸå‹ï¼Œä½†é˜²ä¸ä½ UI ç©¿é€ï¼Œä¸”éš¾ä»¥å¤„ç†å¤šç‚¹è§¦æ§ã€‚\nIPointerClickHandlerï¼šå·¥ä¸šæ ‡å‡†ã€‚ç»Ÿä¸€äº† UI å’Œ 3D/2D ç‰©ä½“çš„è¾“å…¥é€»è¾‘ï¼Œè‡ªåŠ¨å¤„ç†å±‚çº§é®æŒ¡ï¼Œæ”¯æŒå¤šç‚¹è§¦æ§ ID åŒºåˆ†ã€‚\nPhysics 2D Raycasterï¼š\nè¿™æ˜¯æ‰“é€š UI ç³»ç»Ÿå’Œ 2D ç‰©ç†ç³»ç»Ÿçš„æ¡¥æ¢ã€‚è®°ä½ï¼šè¦æƒ³ç”¨æ¥å£æ§åˆ¶ Spriteï¼Œå¿…é¡»ç»™æ‘„åƒæœºåŠ è¿™ä¸ªç»„ä»¶ã€‚ åä¸ƒã€å»¶è¿Ÿæ‰§è¡Œå™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå»¶è¿Ÿæ‰§è¡Œä¸€æ®µé€»è¾‘ã€‚\nè®¾è®¡æ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼çš„ç®€åŒ–ç‰ˆï¼ˆé€šè¿‡Â UnityEventÂ å°è£…å‘½ä»¤ï¼‰ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nç‰¹æ•ˆå›æ”¶ï¼šæ’­æ”¾çˆ†ç‚¸ç‰¹æ•ˆ -\u0026gt; ç­‰ 1 ç§’ -\u0026gt;Â DestroyÂ è‡ªèº«ã€‚\nè¿æ‹›é‡ç½®ï¼šç©å®¶åœæ­¢æ”»å‡» -\u0026gt; ç­‰ 0.5 ç§’ -\u0026gt; é‡ç½®è¿æ‹›è®¡æ•°å™¨ã€‚\nå…³å¡æœºå…³ï¼šè¸©ä¸‹æŒ‰é’® -\u0026gt; ç­‰ 2 ç§’ -\u0026gt; é—¨æ‰“å¼€ã€‚\nä¼˜ç‚¹ï¼šå®Œå…¨è§£è€¦ã€‚è¿™ä¸ªè„šæœ¬ä¸éœ€è¦çŸ¥é“å®ƒè¦è§¦å‘ä»€ä¹ˆï¼Œåªéœ€è¦åœ¨ Inspector é¢æ¿é‡Œæ‹–æ‹½å³å¯ã€‚\nç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šç®€å•çš„å®ç®±å¼€å¯\nè®¾ç½®ï¼š\nå®ç®±ä¸ŠæŒ‚Â Animatorï¼ˆæœ‰ Open åŠ¨ç”»ï¼‰ã€‚\nå®ç®±ä¸ŠæŒ‚Â DelayActionï¼ˆDelay = 0.5ç§’ï¼Œå¯¹åº”åŠ¨ç”»æ’­æ”¾åˆ°ä¸€åŠçš„æ—¶é—´ï¼‰ã€‚\nå®ç®±ä¸ŠæŒ‚Â SoundManagerï¼ˆæ’­æ”¾éŸ³æ•ˆï¼‰ã€‚\né…ç½® DelayActionï¼š\nåœ¨ Inspector çš„Â ActionÂ é‡Œï¼Œæ‹–å…¥Â SoundManager.PlaySoundã€‚\nè¿™æ ·å°±å®ç°äº†ï¼šç‚¹å‡»å®ç®± -\u0026gt; æ’­åŠ¨ç”» -\u0026gt; ï¼ˆå»¶è¿Ÿ0.5ç§’ï¼‰ -\u0026gt; æ’­éŸ³æ•ˆã€‚è®©éŸ³æ•ˆå’ŒåŠ¨ç”»å®Œç¾å¯¹é½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 using UnityEngine; using UnityEngine.Events; using System.Collections; public class DelayAction : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;å»¶è¿Ÿæ—¶é—´ (ç§’)\u0026#34;)] public float delayTime = 1.0f; [Tooltip(\u0026#34;æ˜¯å¦åœ¨ Start æ—¶è‡ªåŠ¨è¿è¡Œ\u0026#34;)] public bool playOnStart = false; [Tooltip(\u0026#34;æ˜¯å¦å¾ªç¯æ‰§è¡Œ\u0026#34;)] public bool loop = false; [Tooltip(\u0026#34;æ˜¯å¦ä½¿ç”¨çœŸå®æ—¶é—´ (ä¸å— TimeScale=0 æš‚åœå½±å“)\u0026#34;)] public bool useRealTime = false; [Header(\u0026#34;å›è°ƒ\u0026#34;)] public UnityEvent action; private Coroutine _currentCoroutine; void OnEnable() { // OnEnable æ¯” Start æ›´å®‰å…¨ï¼Œå› ä¸ºå¯¹è±¡æ± å–å‡ºæ¥æ—¶ä¼šè§¦å‘ OnEnableï¼Œä½†ä¸ä¼šå†æ¬¡è§¦å‘ Start if (playOnStart) Execute(); } void OnDisable() { // å…»æˆå¥½ä¹ æƒ¯ï¼šç‰©ä½“å¤±æ´»æ—¶ï¼Œé‡ç½®åç¨‹å¼•ç”¨ï¼Œé˜²æ­¢é€»è¾‘é”™ä¹± StopTimer(); } /// \u0026lt;summary\u0026gt; /// å¼€å§‹æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡ /// \u0026lt;/summary\u0026gt; public void Execute() { // é˜²æ­¢é‡å¤è°ƒç”¨å¯¼è‡´å¼€å¯å¤šä¸ªè®¡æ—¶å™¨ StopTimer(); _currentCoroutine = StartCoroutine(RunDelay()); } /// \u0026lt;summary\u0026gt; /// å¼ºåˆ¶åœæ­¢è®¡æ—¶ /// \u0026lt;/summary\u0026gt; public void StopTimer() { if (_currentCoroutine != null) { StopCoroutine(_currentCoroutine); _currentCoroutine = null; } } private IEnumerator RunDelay() { do { if (useRealTime) { // UI åŠ¨ç”»å¸¸ç”¨ï¼šä¸å—æš‚åœå½±å“ yield return new WaitForSecondsRealtime(delayTime); } else { // æ¸¸æˆé€»è¾‘å¸¸ç”¨ï¼šå—æš‚åœå½±å“ yield return new WaitForSeconds(delayTime); } action?.Invoke(); } while (loop); // å¦‚æœå¼€å¯å¾ªç¯ï¼Œå°±ä¸€ç›´æ‰§è¡Œ } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ åç¨‹ (Coroutine)ï¼š\nè½»é‡çº§çš„å¤šå¸§æ“ä½œã€‚è®°ä½ï¼šåç¨‹ä¸æ˜¯å¤šçº¿ç¨‹ï¼Œå®ƒä¾ç„¶æ˜¯åœ¨ä¸»çº¿ç¨‹è·‘çš„ã€‚\nWaitForSecondsÂ vsÂ WaitForSecondsRealtimeÂ çš„åŒºåˆ«æ˜¯é¢è¯•å¸¸è€ƒé¢˜ï¼ˆå—ä¸å—Â TimeScaleÂ å½±å“ï¼‰ã€‚\nUnityEvent çš„åŒåˆƒå‰‘ï¼š\nå¥½ï¼šç­–åˆ’å–œæ¬¢ï¼Œè§£è€¦ã€‚\nåï¼šæ€§èƒ½æ¯”ç›´æ¥ä»£ç è°ƒç”¨ç¨å·®ï¼ˆä½†åœ¨è¿™ç§ä½é¢‘å»¶è¿Ÿé€»è¾‘é‡Œå®Œå…¨å¯ä»¥å¿½ç•¥ï¼‰ï¼Œä¸”ä»£ç é‡Œçœ‹ä¸å‡ºè°ƒç”¨å…³ç³»ï¼ˆReferences éš¾æ‰¾ï¼‰ã€‚\nç”Ÿå‘½å‘¨æœŸé™·é˜±ï¼š\næ°¸è¿œè®°ä½ï¼šGameObject SetActive(false) ä¼šç«‹åˆ»æ€æ­»ä¾é™„åœ¨å®ƒä¸Šé¢çš„æ‰€æœ‰åç¨‹ã€‚å¦‚æœéœ€è¦â€œæ­»åä¾ç„¶æ‰§è¡Œâ€çš„é€»è¾‘ï¼Œå¿…é¡»æŠŠåç¨‹äº¤ç»™ä¸€ä¸ªä¸ä¼šæ­»çš„ç‰©ä½“ï¼ˆæ¯”å¦‚å•ä¾‹ GameManagerï¼‰å»è·‘ã€‚ åå…«ã€å¯Œæ–‡æœ¬æ„å»ºå™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå°è£… Unity æ”¯æŒçš„å¯Œæ–‡æœ¬æ ‡ç­¾ï¼Œé€šè¿‡ C# ä»£ç åŠ¨æ€ç”Ÿæˆå¸¦æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nUI æ˜¾ç¤ºï¼šåŠ¨æ€æ‹¼æ¥ç‰©å“æè¿°ï¼ˆå¦‚ï¼šâ€œé€ æˆÂ 50Â ç‚¹ \u0026lt;color=red\u0026gt;ç«ç„°Â ä¼¤å®³â€ï¼‰ã€‚\nDebug è°ƒè¯•ï¼šè®©æ§åˆ¶å°è¾“å‡ºçš„ä¿¡æ¯äº”é¢œå…­è‰²ï¼Œæ–¹ä¾¿åˆ†ç±»æŸ¥æ‰¾ã€‚\né£˜å­—ç‰¹æ•ˆï¼š2D æ¸¸æˆä¸­å¸¸è§çš„ä¼¤å®³æ•°å­—ï¼ˆæš´å‡»æ—¶å˜å¤§ã€å˜çº¢ï¼‰ã€‚\næ ¸å¿ƒæŠ€å·§ï¼šä½¿ç”¨Â ColorUtility.ToHtmlStringRGBAÂ å°† Unity çš„Â ColorÂ ç»“æ„ä½“è½¬ä¸º HTML åå…­è¿›åˆ¶å­—ç¬¦ä¸²\nä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ Aï¼šæ§åˆ¶å°è°ƒè¯•ç¥å™¨\nä½ æ˜¯å¦è§‰å¾— Unity æ§åˆ¶å°å…¨æ˜¯ç™½å­—ï¼Œæ‰¾ä¸åˆ°é‡ç‚¹?\n1 Debug.Log($\u0026#34;ç©å®¶ {RichText.Bold(\u0026#34;Player1\u0026#34;)} è¿›å…¥äº† {RichText.Color(\u0026#34;å±é™©åŒºåŸŸ\u0026#34;, Color.red)}\u0026#34;); åœºæ™¯ Bï¼šRPG ç‰©å“æè¿°\n1 2 3 4 5 6 7 8 9 public string GetItemDescription(string itemName, int damage, string element) { // æ‹¼æ¥å‡ºï¼šè·å¾— [ç«ç„°å‰‘]ï¼Œé€ æˆ 100 ç‚¹ ç«ç„° ä¼¤å®³ string nameStr = RichText.Color($\u0026#34;[{itemName}]\u0026#34;, Color.yellow); string dmgStr = RichText.Size(damage.ToString(), 40); // ä¼¤å®³æ•°å­—å¤§ä¸€ç‚¹ string eleStr = RichText.Color(element, \u0026#34;orange\u0026#34;); // ç›´æ¥ç”¨å•è¯é¢œè‰² return $\u0026#34;è·å¾— {nameStr}ï¼Œé€ æˆ {dmgStr} ç‚¹ {eleStr} ä¼¤å®³\u0026#34;; } ç¤ºä¾‹ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 using System.Text; using UnityEngine; public static class RichText { // === åŸºç¡€ç‰ˆæœ¬ (æ–¹ä¾¿ä½é¢‘ä½¿ç”¨) === public static string Bold(this string text) =\u0026gt; $\u0026#34;\u0026lt;b\u0026gt;{text}\u0026lt;/b\u0026gt;\u0026#34;; public static string Italic(this string text) =\u0026gt; $\u0026#34;\u0026lt;i\u0026gt;{text}\u0026lt;/i\u0026gt;\u0026#34;; public static string Size(this string text, int size) =\u0026gt; $\u0026#34;\u0026lt;size={size}\u0026gt;{text}\u0026lt;/size\u0026gt;\u0026#34;; public static string Color(this string text, Color color) =\u0026gt; $\u0026#34;\u0026lt;color=#{ColorUtility.ToHtmlStringRGBA(color)}\u0026gt;{text}\u0026lt;/color\u0026gt;\u0026#34;; // === TextMeshPro ä¸“å±æ ‡ç­¾ === /// \u0026lt;summary\u0026gt; /// æ’å…¥å›¾é›†ä¸­çš„å›¾æ ‡ (ä¾‹å¦‚ \u0026lt;sprite=0\u0026gt;) /// \u0026lt;/summary\u0026gt; public static string Sprite(int index) =\u0026gt; $\u0026#34;\u0026lt;sprite={index}\u0026gt;\u0026#34;; /// \u0026lt;summary\u0026gt; /// æ’å…¥ç‰¹å®šåç§°çš„å›¾æ ‡ (ä¾‹å¦‚ \u0026lt;sprite name=\u0026#34;GoldIcon\u0026#34;\u0026gt;) /// \u0026lt;/summary\u0026gt; public static string Sprite(string spriteName) =\u0026gt; $\u0026#34;\u0026lt;sprite name=\\\u0026#34;{spriteName}\\\u0026#34;\u0026gt;\u0026#34;; // === StringBuilder é«˜æ€§èƒ½æ‰©å±• (é«˜é¢‘ç¯å¢ƒä¸“ç”¨) === /// \u0026lt;summary\u0026gt; /// è¿½åŠ åŠ ç²—æ–‡æœ¬ /// \u0026lt;/summary\u0026gt; public static StringBuilder AppendBold(this StringBuilder sb, string text) { return sb.Append(\u0026#34;\u0026lt;b\u0026gt;\u0026#34;).Append(text).Append(\u0026#34;\u0026lt;/b\u0026gt;\u0026#34;); } /// \u0026lt;summary\u0026gt; /// è¿½åŠ é¢œè‰²æ–‡æœ¬ /// \u0026lt;/summary\u0026gt; public static StringBuilder AppendColor(this StringBuilder sb, string text, Color color) { return sb.Append(\u0026#34;\u0026lt;color=#\u0026#34;).Append(ColorUtility.ToHtmlStringRGBA(color)).Append(\u0026#34;\u0026gt;\u0026#34;) .Append(text) .Append(\u0026#34;\u0026lt;/color\u0026gt;\u0026#34;); } /// \u0026lt;summary\u0026gt; /// è¿½åŠ å¸¦å›¾æ ‡çš„æ–‡æœ¬ /// \u0026lt;/summary\u0026gt; public static StringBuilder AppendIcon(this StringBuilder sb, int spriteIndex) { return sb.Append(\u0026#34;\u0026lt;sprite=\u0026#34;).Append(spriteIndex).Append(\u0026#34;\u0026gt;\u0026#34;); } } ä¼˜åŒ–ï¼š 1 2 3 4 5 6 // é«˜æ€§èƒ½å†™æ³•ï¼š StringBuilder sb = new StringBuilder(); // æœ€å¥½ç¼“å­˜è¿™ä¸ª sbï¼Œä¸è¦æ¯å¸§ new sb.Append(\u0026#34;HP: \u0026#34;).AppendColor(currentHp.ToString(), Color.green) .Append(\u0026#34; | MP: \u0026#34;).AppendColor(currentMp.ToString(), Color.blue); myTmpText.SetText(sb); // TMP æ”¯æŒç›´æ¥ä¼ å…¥ StringBuilderï¼Œé›¶ GCï¼ æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ å¯Œæ–‡æœ¬ (Rich Text)ï¼š\nè¿™æ˜¯ Unity UI çš„åŸºç¡€ã€‚å³ä½¿ä½ ä¸ç”¨ä»£ç ç”Ÿæˆï¼Œåœ¨ Inspector é‡Œæ‰‹åŠ¨å¡«Â \u0026lt;color=red\u0026gt;HPÂ ä¹Ÿæ˜¯åŸºæœ¬åŠŸã€‚ ColorUtilityï¼š\nè®°ä½è¿™ä¸ªç±»ï¼Œå¤„ç†é¢œè‰²è½¬æ¢ï¼ˆHex \u0026lt;-\u0026gt; Colorï¼‰æ—¶å®ƒæ˜¯æœ€å¿«æœ€ç¨³çš„ã€‚ å­—ç¬¦ä¸²æ€§èƒ½ (String Interning/GC)ï¼š\nå­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆ+Â æˆ–Â $ï¼‰åœ¨ C# ä¸­æ˜¯æ˜‚è´µçš„ã€‚åœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œé™æ€æ–‡æœ¬éšä¾¿æ‹¼ï¼ŒåŠ¨æ€é«˜é¢‘æ–‡æœ¬ç”¨ Builderã€‚ TextMeshPro (TMP)ï¼š\nTMP æ˜¯ 2D æ¸¸æˆå­—ä½“çš„å”¯ä¸€é€‰æ‹©ã€‚å®ƒä¸ä»…æ¸…æ™°ï¼Œè¿˜æ”¯æŒÂ ï¼ˆå›¾æ–‡æ··æ’ï¼‰ã€ï¼ˆåˆ†é¡µï¼‰ã€ï¼ˆè¶…é“¾æ¥ï¼‰ç­‰é«˜çº§æ ‡ç­¾ï¼Œå»ºè®®å»æŸ¥é˜… TMP çš„æ–‡æ¡£ï¼Œè¿™èƒ½æå¤§ä¸°å¯Œä½ çš„ UI è¡¨ç°åŠ›ã€‚ åä¹ã€å¸§ç‡è®¡æ•°å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå®æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºæ¸¸æˆçš„å¸§ç‡ï¼ˆFPSï¼‰å’Œå¸§æ—¶ï¼ˆmsï¼‰ã€‚\nç®—æ³•é€»è¾‘ï¼šä½¿ç”¨äº†åŠ æƒç§»åŠ¨å¹³å‡ç®—æ³•ï¼ˆWeighted Moving Averageï¼‰ã€‚å®ƒä¸æ˜¯åªæ˜¾ç¤ºå½“å‰è¿™ä¸€å¸§çš„æ•°æ®ï¼Œè€Œæ˜¯è®©æ•°å€¼å¹³æ»‘è¿‡æ¸¡ï¼Œé˜²æ­¢æ•°å­—è·³åŠ¨å¤ªå¿«å¯¼è‡´çœ‹ä¸æ¸…ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nå¼€å‘è°ƒè¯•ï¼šæ£€æŸ¥æ¸¸æˆæœ‰æ²¡æœ‰æ‰å¸§å¡é¡¿ã€‚\næ€§èƒ½ä¼˜åŒ–ï¼šå¯¹æ¯”ä¼˜åŒ–å‰åçš„æ•°å€¼å˜åŒ–ã€‚\nè‡´å‘½å¼±ç‚¹ï¼šOnGUIÂ æ¯å¸§è¿è¡Œï¼Œä¸”ä»£ç ä¸­ä¸æ–­Â newÂ å¯¹è±¡å’Œæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„åƒåœ¾å†…å­˜ï¼ˆGarbage Collectionï¼‰ï¼Œåè€Œå¯èƒ½å¯¼è‡´æ¸¸æˆè½»å¾®å¡é¡¿ã€‚\nä½¿ç”¨åœºæ™¯ åœºæ™¯ï¼šå¯»æ‰¾æ€§èƒ½ç“¶é¢ˆ\nä½ å‘ç°æ¸¸æˆåœ¨ç”Ÿæˆå¤§é‡æ€ªç‰©æ—¶å˜å¡äº†ã€‚\næŒ‚ä¸Šè¿™ä¸ªè„šæœ¬ï¼Œæ‰“åŒ…åˆ°æ‰‹æœºä¸Šè¿è¡Œã€‚\nè§‚å¯Ÿ FPSï¼šå¹³æ—¶ 60ï¼Œå‡ºæ€ªæ—¶ç¬é—´æ‰åˆ° 20ã€‚\nè§‚å¯Ÿ msï¼šå¹³æ—¶ 16msï¼Œå‡ºæ€ªæ—¶é£™å‡åˆ° 50msã€‚\nç»“è®ºï¼šå‡ºæ€ªé€»è¾‘ï¼ˆå¯èƒ½æ˜¯Â Instantiateï¼‰å¤ªè€—æ—¶ï¼Œéœ€è¦ä¼˜åŒ–ï¼ˆæ¯”å¦‚ä¸Šå¯¹è±¡æ± ï¼‰ã€‚\nä½¿ç”¨ TextMeshProï¼šæ¸…æ™°ã€ç¾è§‚ï¼Œä¹Ÿæ˜¯ Unity çš„æ ‡å‡† UIã€‚\nä½é¢‘æ›´æ–°ï¼šæ¯ 0.5 ç§’æ›´æ–°ä¸€æ¬¡æ–‡å­—ï¼Œæ—¢çœ‹å¾—æ¸…ï¼Œåˆæå¤§å‡å°‘äº†å­—ç¬¦ä¸²æ‹¼æ¥çš„å¼€é”€ã€‚\né¢œè‰²åˆ†çº§ï¼šFPS é«˜æ˜¾ç¤ºç»¿è‰²ï¼Œä¸­ç­‰æ˜¾ç¤ºé»„è‰²ï¼Œä½æ˜¾ç¤ºçº¢è‰²ï¼ˆç›´è§‚é¢„è­¦ï¼‰ã€‚ using UnityEngine; using TMPro; // å¼•å…¥ TextMeshPro å‘½åç©ºé—´ public class FPSDisplay : MonoBehaviour {\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 using UnityEngine; using TMPro; // å¼•å…¥ TextMeshPro å‘½åç©ºé—´ public class FPSDisplay : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ‹–å…¥åœºæ™¯ Canvas ä¸‹çš„ä¸€ä¸ª TextMeshProUGUI ç»„ä»¶\u0026#34;)] public TextMeshProUGUI fpsText; [Tooltip(\u0026#34;åˆ·æ–°é¢‘ç‡ (ç§’)ï¼Œå»ºè®® 0.5ç§’ æ›´æ–°ä¸€æ¬¡ï¼Œä¸è¦æ¯å¸§æ›´æ–°\u0026#34;)] public float updateInterval = 0.5f; private float _accum = 0f; // ç´¯è®¡æ—¶é—´ private int _frames = 0; // ç´¯è®¡å¸§æ•° private float _timeLeft; // å€’è®¡æ—¶ void Start() { _timeLeft = updateInterval; if (fpsText == null) { Debug.LogError(\u0026#34;FPSDisplay: è¿˜æ²¡æœ‰èµ‹å€¼ Text ç»„ä»¶ï¼\u0026#34;); enabled = false; } } void Update() { // 1. ç´¯è®¡æ¯ä¸€å¸§çš„æ—¶é—´å’Œå¸§æ•° _timeLeft -= Time.unscaledDeltaTime; _accum += Time.unscaledTimeScale / Time.unscaledDeltaTime; _frames++; // 2. æ—¶é—´åˆ°äº†ï¼Œè®¡ç®—ä¸€æ¬¡å¹³å‡ FPS if (_timeLeft \u0026lt;= 0.0) { // å¹³å‡ FPS float fps = _accum / _frames; // 3. è®¾ç½®é¢œè‰² (60ä»¥ä¸Šç»¿ï¼Œ30ä»¥ä¸Šé»„ï¼Œ30ä»¥ä¸‹çº¢) if (fps \u0026gt;= 60) fpsText.color = Color.green; else if (fps \u0026gt;= 30) fpsText.color = Color.yellow; else fpsText.color = Color.red; // 4. æ›´æ–°æ–‡æœ¬ // {0:F1} è¡¨ç¤ºä¿ç•™1ä½å°æ•° fpsText.text = string.Format(\u0026#34;{0:F1} FPS\u0026#34;, fps); // 5. é‡ç½®è®¡æ•°å™¨ _timeLeft = updateInterval; _accum = 0.0f; _frames = 0; } } } å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼ˆSetupï¼‰ åˆ›å»º UIï¼š\nåœ¨ Canvas ä¸‹åˆ›å»ºä¸€ä¸ªÂ Text - TextMeshProã€‚\næ”¾åœ¨å±å¹•å³ä¸Šè§’ï¼Œé¢œè‰²è®¾ä¸ºç™½è‰²ï¼Œå­—ä½“æå¤§ç‚¹ã€‚\nä¸ºäº†é˜²æ­¢è¢«æ¸¸æˆç‰©ä½“é®æŒ¡ï¼Œç¡®ä¿å®ƒåœ¨ Canvas çš„æœ€ä¸‹å±‚ï¼ˆæ¸²æŸ“é¡ºåºçš„æœ€ä¸Šå±‚ï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ Overlay Canvasã€‚\næŒ‚è½½è„šæœ¬ï¼š\nåˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“Â System_FPSï¼ŒæŒ‚è½½ä¸Šé¢çš„è„šæœ¬ã€‚\næŠŠåˆšæ‰åˆ›å»ºçš„ Text æ‹–è¿›Â fpsTextÂ æ§½ä½ã€‚\nè¿è¡Œï¼š\nä½ ä¼šçœ‹åˆ°æ•°å­—æ¯ 0.5 ç§’è·³åŠ¨ä¸€æ¬¡ï¼Œé¢œè‰²ä¼šéšç€æµç•…åº¦å˜åŒ–ã€‚ æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ OnGUI çš„ obsolescence (è¿‡æ—¶)ï¼š\né¢è¯•è€ƒç‚¹ï¼šå°½é‡åˆ«åœ¨æ­£å¼é¡¹ç›®é‡Œç”¨Â OnGUIï¼Œé™¤äº†å®ƒçš„æ€§èƒ½å·®ï¼ˆæ¯å¸§é‡ç»˜ã€GCå¤šï¼‰ï¼Œå®ƒè¿˜æ— æ³•é€‚é…ä¸åŒåˆ†è¾¨ç‡çš„å±å¹•ã€‚ç°åœ¨éƒ½æ˜¯ç”¨ UGUI æˆ– UI Toolkitã€‚ UnscaledDeltaTimeï¼š\nå¿…è®°ï¼šåš UI åŠ¨ç”»ã€ç³»ç»Ÿè®¡æ—¶ã€FPS ç»Ÿè®¡æ—¶ï¼Œæ°¸è¿œä¼˜å…ˆè€ƒè™‘Â Time.unscaledDeltaTimeï¼Œå¦åˆ™æ¸¸æˆæš‚åœæ—¶è¿™äº›é€»è¾‘ä¹Ÿä¼šè·Ÿç€â€œå†»ç»“â€ã€‚ é¢‘ç‡æ§åˆ¶ (Throttling)ï¼š\nä¼˜åŒ–æ€ç»´ï¼šä¸éœ€è¦æ¯ä¸€å¸§éƒ½æ›´æ–° UI æ–‡æœ¬ã€‚äººçš„çœ¼ç›çœ‹ä¸æ¸…æ¯ç§’é—ªçƒ 60 æ¬¡çš„æ•°å­—ã€‚é™ä½æ›´æ–°é¢‘ç‡ï¼ˆå¦‚ 0.5s ä¸€æ¬¡ï¼‰æ˜¯ UI æ€§èƒ½ä¼˜åŒ–çš„å¸¸è§æ‰‹æ®µã€‚ äºŒåã€åˆšä½“å†»ç»“å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæš‚åœå’Œæ¢å¤ç‰©ä½“çš„ç‰©ç†æ¨¡æ‹Ÿã€‚\né€‚ç”¨åœºæ™¯ï¼š\nè´Ÿé¢çŠ¶æ€ï¼ˆDebuffï¼‰ï¼šæ¯”å¦‚è¢«å†°å†»æ³•æœ¯å‡»ä¸­ã€è¢«ç¾æœèçŸ³åŒ–ã€‚\nå‰§æƒ…æ¼”å‡ºï¼šå¯¹è¯æ—¶å¼ºåˆ¶é”å®šä¸»è§’ï¼Œä¸è®©ç©å®¶ä¹±åŠ¨ã€‚\næ—¶é—´åœæ­¢æŠ€èƒ½ï¼šç±»ä¼¼ã€Šå¡å°”è¾¾ä¼ è¯´ï¼šè’é‡ä¹‹æ¯ã€‹çš„â€œæ—¶åœâ€ç¬¦æ–‡ã€‚\næ ¸å¿ƒåŸç†ï¼š\nFreezeï¼šè®°å½•å½“å‰é€Ÿåº¦ -\u0026gt; åˆ‡æ¢ä¸ºÂ Kinematicã€‚\nKinematic ç‰¹æ€§ï¼šä¸å—é‡åŠ›å½±å“ï¼Œä¸å—åŠ›å½±å“ï¼Œåƒé’‰åœ¨å¢™ä¸Šä¸€æ ·ï¼Œä½†ä¾ç„¶èƒ½æŒ¡ä½åˆ«äººï¼ˆæœ‰ç¢°æ’ä½“ç§¯ï¼‰ã€‚ Unfreezeï¼šæ¢å¤åˆšä½“ç±»å‹ -\u0026gt; å°†è®°å½•çš„é€Ÿåº¦å¡å›å»ã€‚\nä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šåˆ¶ä½œä¸€ä¸ªâ€œå†°å†»åœ°é›·â€\nè®¾ç½®ï¼š\nç»™ä¸»è§’æŒ‚ä¸ŠÂ RigidbodyFreezerã€‚\nåˆ¶ä½œä¸€ä¸ªåœ°é›· Prefabï¼ŒæŒ‚è½½ä»¥ä¸‹è„šæœ¬ã€‚\nåœ°é›·è„šæœ¬ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 public class IceMine : MonoBehaviour { void OnTriggerEnter2D(Collider2D other) { var freezer = other.GetComponent\u0026lt;RigidbodyFreezer\u0026gt;(); if (freezer != null) { // å†»ä½ç›®æ ‡ freezer.Freeze(); // 2ç§’åè‡ªåŠ¨è§£å†» // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦ä¸€ä¸ªåç¨‹æˆ–è€…å»¶æ—¶è°ƒç”¨ï¼Œç®€å•çš„å¯ä»¥ç”¨ Invoke freezer.Invoke(\u0026#34;Unfreeze\u0026#34;, 2.0f); // é”€æ¯åœ°é›· Destroy(gameObject); } } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 using UnityEngine; using System.Collections; [RequireComponent(typeof(Rigidbody2D))] public class PhysicsFreezer2D : MonoBehaviour { private Rigidbody2D _rb; private Vector2 _savedVelocity; private float _savedAngularVelocity; // ã€æ–°å¢ã€‘ä¿å­˜æ—‹è½¬é€Ÿåº¦ private RigidbodyType2D _savedType; // ä½¿ç”¨è®¡æ•°å™¨è€Œä¸æ˜¯ boolï¼Œä»¥å¤„ç†å¤šä¸ªå†»ç»“æºåŒæ—¶ä½œç”¨çš„æƒ…å†µ // ä¾‹å¦‚ï¼šå…ˆè¢«å†°å†»ï¼Œè¿˜æ²¡è§£å†»åˆè§¦å‘äº†å‰§æƒ…é”å®šã€‚ private int _freezeCount = 0; // ç¼“å­˜ Animatorï¼Œå†»ç»“ç‰©ç†æ—¶é€šå¸¸ä¹Ÿè¦å†»ç»“åŠ¨ç”» private Animator _animator; private float _savedAnimSpeed; void Awake() { _rb = GetComponent\u0026lt;Rigidbody2D\u0026gt;(); _animator = GetComponent\u0026lt;Animator\u0026gt;(); } /// \u0026lt;summary\u0026gt; /// æ°¸ä¹…å†»ç»“ï¼ˆç›´åˆ°æ‰‹åŠ¨è§£å†»ï¼‰ /// \u0026lt;/summary\u0026gt; public void Freeze() { _freezeCount++; // åªæœ‰ç¬¬ä¸€æ¬¡å†»ç»“æ—¶æ‰§è¡Œé€»è¾‘ if (_freezeCount == 1) { ApplyFreeze(); } } /// \u0026lt;summary\u0026gt; /// æš‚æ—¶å†»ç»“æŒ‡å®šæ—¶é—´ï¼ˆæœ€å¸¸ç”¨çš„æ¥å£ï¼‰ /// \u0026lt;/summary\u0026gt; public void FreezeForDuration(float duration) { StartCoroutine(FreezeCoroutine(duration)); } /// \u0026lt;summary\u0026gt; /// è§£å†» /// \u0026lt;/summary\u0026gt; public void Unfreeze() { if (_freezeCount \u0026lt;= 0) return; _freezeCount--; // åªæœ‰å½“æ‰€æœ‰å†»ç»“æºéƒ½è§£é™¤æ—¶ï¼Œæ‰çœŸæ­£æ¢å¤ if (_freezeCount == 0) { ApplyUnfreeze(); } } private void ApplyFreeze() { // 1. ä¿å­˜çŠ¶æ€ _savedVelocity = _rb.velocity; _savedAngularVelocity = _rb.angularVelocity; // ä¿å­˜æ—‹è½¬ _savedType = _rb.bodyType; // 2. å†»ç»“ç‰©ç† _rb.velocity = Vector2.zero; _rb.angularVelocity = 0f; _rb.bodyType = RigidbodyType2D.Kinematic; // 3. å†»ç»“åŠ¨ç”» (å¯é€‰ï¼Œè§†éœ€æ±‚è€Œå®š) if (_animator != null) { _savedAnimSpeed = _animator.speed; _animator.speed = 0f; } } private void ApplyUnfreeze() { // 1. æ¢å¤ç‰©ç†ç±»å‹ _rb.bodyType = _savedType; // 2. æ¢å¤é€Ÿåº¦ (æ³¨æ„é¡ºåºï¼Œå…ˆæ”¹ç±»å‹å†æ”¹é€Ÿåº¦ï¼Œå¦åˆ™Kinematicå¯èƒ½ä¸æ¥å—é€Ÿåº¦) _rb.velocity = _savedVelocity; _rb.angularVelocity = _savedAngularVelocity; // æ¢å¤æ—‹è½¬ // 3. æ¢å¤åŠ¨ç”» if (_animator != null) { _animator.speed = _savedAnimSpeed; } } private IEnumerator FreezeCoroutine(float duration) { Freeze(); yield return new WaitForSeconds(duration); Unfreeze(); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ RigidbodyType2Dï¼š\nDynamicï¼šå—åŠ›ã€å—é‡åŠ›ï¼ˆä¸»è§’ã€æ€ªï¼‰ã€‚\nKinematicï¼šä¸å—åŠ›ã€ä¸å—é‡åŠ›ï¼Œä½†å¯ä»¥ä»£ç ç§»åŠ¨ï¼Œä¸”æ˜¯ä¸ªåšç¡¬çš„éšœç¢ç‰©ï¼ˆç§»åŠ¨å¹³å°ã€è¢«å†»ä½çš„ä¸»è§’ï¼‰ã€‚\nStaticï¼šå®Œå…¨ä¸åŠ¨ï¼ˆå¢™å£ï¼‰ã€‚\nRigibody.simulated vs bodyTypeï¼š\nå¦‚æœä½ æƒ³è®©ç‰©ä½“æ¶ˆå¤±ï¼ˆä¸æŒ¡å­å¼¹ï¼‰ï¼Œç”¨Â rb.simulated = falseã€‚\nå¦‚æœä½ æƒ³è®©ç‰©ä½“å®šæ ¼ï¼ˆæŒ¡å­å¼¹ï¼‰ï¼Œç”¨Â rb.bodyType = Kinematicã€‚\nçŠ¶æ€å åŠ ç®¡ç†ï¼š\nå½“ä¸€ä¸ªçŠ¶æ€ï¼ˆå¦‚å†»ç»“ã€æ— æ•Œã€æ²‰é»˜ï¼‰å¯èƒ½ç”±å¤šä¸ªæ¥æºè§¦å‘æ—¶ï¼Œæ°¸è¿œä¸è¦ç”¨Â boolï¼Œè¦ç”¨Â intÂ è®¡æ•°å™¨ã€‚ äºŒåä¸€ã€éšæœºæ¿€æ´»å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šäº’æ–¥é€‰æ‹©ï¼ˆMutually Exclusive Selectionï¼‰ã€‚ç¡®ä¿çˆ¶ç‰©ä½“ä¸‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå­ç‰©ä½“æ˜¯æ¿€æ´»çš„ï¼Œå…¶ä½™å…¨éƒ¨éšè—ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nåœºæ™¯è£…é¥°å¤šæ ·æ€§ï¼šè·¯è¾¹çš„ä¸€å—çŸ³å¤´ï¼Œä½ åšäº† 3 ç§é€ å‹ï¼ŒæŒ‚åœ¨è¿™ä¸ªè„šæœ¬ä¸‹ï¼Œæ¯æ¬¡è¿›æ¸¸æˆçœ‹åˆ°çš„çŸ³å¤´å½¢çŠ¶éƒ½ä¸ä¸€æ ·ã€‚\néšæœºå‡ºç”Ÿç‚¹ï¼šåœ¨åœ°å›¾ä¸Šæ”¾ 5 ä¸ªç‚¹ï¼Œéšæœºé€‰ä¸€ä¸ªä½œä¸ºç©å®¶å‡ºç”Ÿä½ç½®ã€‚\næ€ªç‰©æ¢çš®ï¼šåŒä¸€ä¸ªå“¥å¸ƒæ—é¢„åˆ¶ä½“ï¼Œä¸‹é¢æŒ‚äº†â€œæ‹¿åˆ€â€ã€â€œæ‹¿å‰‘â€ã€â€œæ‹¿æ–§å¤´â€ä¸‰ä¸ªå­æ¨¡å‹ï¼Œéšæœºé€‰ä¸€ä¸ªæ˜¾ç¤ºã€‚\næ€§èƒ½éšæ‚£ï¼šä½¿ç”¨äº†Â new List()ï¼Œäº§ç”Ÿäº†ä¸å¿…è¦çš„å †å†…å­˜åˆ†é…ã€‚\nä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼š2D å¹³å°è·³è·ƒæ¸¸æˆä¸­çš„â€œéšæœºè·¯éšœâ€\nåˆ¶ä½œ Prefabï¼š\nåˆ›å»ºä¸€ä¸ªç©ºç‰©ä½“å«Â RandomTrapã€‚\nåœ¨ä¸‹é¢æ”¾ä¸‰ä¸ªå­ç‰©ä½“ï¼š\nSpikesÂ (åœ°åˆº Sprite + Collider)\nSawBladeÂ (é”¯é½¿ Sprite + æ—‹è½¬è„šæœ¬ + Collider)\nEmptyÂ (ä¸€ä¸ªç©ºç‰©ä½“ï¼Œä»£è¡¨è¿™é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå®‰å…¨)\næŒ‚è½½è„šæœ¬ï¼š\nç»™Â RandomTrapÂ æŒ‚ä¸ŠÂ RandomActivatorã€‚ æ•ˆæœï¼š\nä½ åœ¨å…³å¡é‡Œæ‹–å…¥ 10 ä¸ªÂ RandomTrapã€‚\nç©å®¶æ¯æ¬¡ç©ï¼Œè¿™ 10 ä¸ªåœ°æ–¹çš„è·¯éšœåˆ†å¸ƒå®Œå…¨ä¸åŒï¼Œæœ‰äº›åœ°æ–¹å®‰å…¨ï¼Œæœ‰äº›åœ°æ–¹æ˜¯åˆºï¼Œå¢åŠ äº†é‡ç©ä»·å€¼ï¼ˆRogue-lite å…ƒç´ ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 using UnityEngine; public class RandomActivator : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;æ˜¯å¦åœ¨ Start æ—¶è‡ªåŠ¨æ‰§è¡Œ\u0026#34;)] public bool activateOnStart = true; [Tooltip(\u0026#34;æ˜¯å¦å…è®¸â€œå…¨ç©ºâ€ï¼Ÿ(å³å¯èƒ½è¿æ°”å¥½ï¼Œæ‰€æœ‰ç‰©ä½“éƒ½éšè—)\u0026#34;)] public bool allowEmpty = false; void Start() { if (activateOnStart) ActivateRandomChild(); } /// /// éšæœºæ¿€æ´»ä¸€ä¸ªå­ç‰©ä½“ (é›¶ GC ä¼˜åŒ–ç‰ˆ) /// public void ActivateRandomChild() { int childCount = transform.childCount; if (childCount == 0) return; // 1. å†³å®šè°æ˜¯é‚£ä¸ªâ€œå¹¸è¿å„¿â€ // å¦‚æœå…è®¸ç©ºï¼Œæˆ‘ä»¬å°±éšæœºåˆ° childCount (è¶Šç•Œç´¢å¼•ä»£è¡¨ç©º) int maxIndex = allowEmpty ? childCount + 1 : childCount; int targetIndex = Random.Range(0, maxIndex); // 2. éå†å­ç‰©ä½“ (ç›´æ¥ä½¿ç”¨ç´¢å¼•è®¿é—®ï¼Œä¸éœ€è¦ List) for (int i = 0; i \u0026lt; childCount; i++) { Transform child = transform.GetChild(i); // 3. æ ¸å¿ƒä¼˜åŒ–ï¼šåªä¿®æ”¹çŠ¶æ€ä¸ä¸€è‡´çš„ç‰©ä½“ // åªæœ‰å½“ i ç­‰äºç›®æ ‡ç´¢å¼•æ—¶ï¼ŒshouldActive ä¸º true bool shouldActive = (i == targetIndex); // æ£€æŸ¥å½“å‰çŠ¶æ€ï¼Œé¿å…é‡å¤è°ƒç”¨ SetActive è§¦å‘ä¸å¿…è¦çš„ OnEnable/Disable if (child.gameObject.activeSelf != shouldActive) { child.gameObject.SetActive(shouldActive); } } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ Transform çš„æ•°ç»„ç‰¹æ€§ï¼š\nå¿…è€ƒé¢˜ï¼šTransform å®ç°äº†Â IEnumerableï¼Œæ‰€ä»¥å¯ä»¥è¢«Â foreachã€‚ä½†å®ƒåŒæ—¶ä¹Ÿæä¾›äº†Â childCountÂ å’ŒÂ GetChild(index)ã€‚\nä¼˜åŒ–å‡†åˆ™ï¼šåœ¨æ€§èƒ½æ•æ„Ÿçš„ä»£ç ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨Â forÂ å¾ªç¯ +Â GetChildï¼Œè€Œä¸æ˜¯Â foreachã€‚\nDirty State Check (è„çŠ¶æ€æ£€æŸ¥)ï¼š\nåœ¨è°ƒç”¨Â SetActiveÂ æˆ–ä¿®æ”¹Â textÂ ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ä¸€ä¸‹å€¼å˜æ²¡å˜ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œèƒ½å‡å°‘ Unity å†…éƒ¨çš„å¼€é”€ï¼ˆLayout Rebuild, Draw Call å˜åŠ¨ç­‰ï¼‰ã€‚ éšæœºæ€§æ§åˆ¶ï¼š\nç†è§£Â Random.RangeÂ å¯¹æ•´æ•°æ˜¯â€œåŒ…å¤´ä¸åŒ…å°¾â€çš„ã€‚ äºŒåäºŒã€å…¨å±€äº‹ä»¶æ€»çº¿ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå…è®¸ä»»ä½•ç³»ç»Ÿå‘é€æ¶ˆæ¯ï¼Œä»»ä½•ç³»ç»Ÿæ¥æ”¶æ¶ˆæ¯ï¼Œä¸¤è€…æ— éœ€äº’ç›¸å¼•ç”¨ã€‚\næŠ€æœ¯äº®ç‚¹ï¼šä½¿ç”¨Â æ³›å‹ ()Â å’ŒÂ Type å­—å…¸Â æ¥åŒºåˆ†ä¸åŒçš„äº‹ä»¶ç±»å‹ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nå…¨å±€äº‹ä»¶ï¼šæ¸¸æˆèƒœåˆ©ã€æ¸¸æˆæš‚åœã€ç©å®¶æ­»äº¡ã€‚\nè·¨æ¨¡å—é€šè®¯ï¼šç©å®¶åƒé‡‘å¸ï¼ˆPlayerè„šæœ¬å‘å¸ƒï¼‰ï¼ŒUI å¢åŠ åˆ†æ•°ï¼ˆUIè„šæœ¬è®¢é˜…ï¼‰ï¼Œæ’­æ”¾éŸ³æ•ˆï¼ˆAudioè„šæœ¬è®¢é˜…ï¼‰ã€‚\nè‡´å‘½ç¼ºé™·ï¼šåŸå§‹ä»£ç ä½¿ç”¨äº† Lambda è¡¨è¾¾å¼åŒ…è£…å™¨ï¼Œå¯¼è‡´æ— æ³•å–æ¶ˆè®¢é˜…ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 using System; using System.Collections.Generic; using UnityEngine; public static class EventBus { // å­—å…¸ï¼šKeyæ˜¯äº‹ä»¶ç±»å‹ï¼ŒValueæ˜¯ C# åŸç”Ÿçš„ Delegate private static readonly Dictionary\u0026lt;Type, Delegate\u0026gt; _events = new Dictionary\u0026lt;Type, Delegate\u0026gt;(); /// \u0026lt;summary\u0026gt; /// è®¢é˜…äº‹ä»¶ /// \u0026lt;/summary\u0026gt; public static void Subscribe\u0026lt;T\u0026gt;(Action\u0026lt;T\u0026gt; listener) { Type type = typeof(T); if (!_events.ContainsKey(type)) { _events[type] = null; } // å¼ºè½¬ä¸º Action\u0026lt;T\u0026gt; è¿›è¡Œåˆå¹¶ _events[type] = (Action\u0026lt;T\u0026gt;)_events[type] + listener; } /// \u0026lt;summary\u0026gt; /// å–æ¶ˆè®¢é˜… (ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼) /// \u0026lt;/summary\u0026gt; public static void Unsubscribe\u0026lt;T\u0026gt;(Action\u0026lt;T\u0026gt; listener) { Type type = typeof(T); if (_events.ContainsKey(type)) { // å¼ºè½¬å¹¶ç§»é™¤ _events[type] = (Action\u0026lt;T\u0026gt;)_events[type] - listener; // å¦‚æœå§”æ‰˜é“¾ç©ºäº†ï¼Œå¯ä»¥è€ƒè™‘ç§»é™¤ Key ä»¥èŠ‚çœå†…å­˜ if (_events[type] == null) { _events.Remove(type); } } } /// \u0026lt;summary\u0026gt; /// å‘å¸ƒäº‹ä»¶ /// \u0026lt;/summary\u0026gt; public static void Publish\u0026lt;T\u0026gt;(T eventArgs) { Type type = typeof(T); if (_events.TryGetValue(type, out var currentDelegate)) { // å¼ºè½¬å›å…·ä½“ç±»å‹å¹¶è°ƒç”¨ // ä½¿ç”¨ Invoke å¯ä»¥æ¯” DynamicInvoke å¿«å¾—å¤š if (currentDelegate is Action\u0026lt;T\u0026gt; callback) { callback.Invoke(eventArgs); } } } /// \u0026lt;summary\u0026gt; /// åˆ‡æ¢åœºæ™¯æ—¶æ¸…ç†æ‰€æœ‰äº‹ä»¶ï¼ˆé˜²æ­¢é™æ€å˜é‡æŒæœ‰å·²é”€æ¯å¯¹è±¡çš„å¼•ç”¨ï¼‰ /// \u0026lt;/summary\u0026gt; public static void ClearAll() { _events.Clear(); } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœ¨ 2D æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤„ç†Â â€œæ‹¾å–é‡‘å¸â€Â è¿™ä¸ªé€»è¾‘ã€‚\nStep 1: å®šä¹‰äº‹ä»¶ç»“æ„ä½“ (struct æ¯” class æ›´çœ GC)\n1 2 3 4 5 public struct EventCoinCollected { public int amount; // é‡‘å¸æ•°é‡ public bool isSpecial; // æ˜¯å¦æ˜¯ç‰¹æ®Šé‡‘å¸ } Step 2: ç©å®¶è„šæœ¬ (å‘å¸ƒè€…)\n1 2 3 4 5 6 7 8 9 10 11 12 public class Player : MonoBehaviour { void OnTriggerEnter2D(Collider2D other) { if (other.CompareTag(\u0026#34;Coin\u0026#34;)) { // å¹¿æ’­ï¼šæˆ‘æ¡åˆ°é’±äº†ï¼è‡³äºè°å…³å¿ƒè¿™ä¸ªï¼Œæˆ‘ä¸careã€‚ EventBus.Publish(new EventCoinCollected { amount = 10, isSpecial = false }); Destroy(other.gameObject); } } } Step 3: UI è„šæœ¬ (è®¢é˜…è€…)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class UIManager : MonoBehaviour { void OnEnable() { // æ³¨å†Œç›‘å¬ EventBus.Subscribe\u0026lt;EventCoinCollected\u0026gt;(OnCoinCollected); } void OnDisable() { // âš ï¸ é‡è¦ï¼šé”€æ¯æ—¶å¿…é¡»å–æ¶ˆè®¢é˜…ï¼Œå¦åˆ™æŠ¥é”™ EventBus.Unsubscribe\u0026lt;EventCoinCollected\u0026gt;(OnCoinCollected); } // å›è°ƒå‡½æ•° void OnCoinCollected(EventCoinCollected e) { Debug.Log($\u0026#34;UIæ›´æ–°ï¼šå¢åŠ äº† {e.amount} é‡‘å¸\u0026#34;); // UpdateUIText(e.amount); } } Step 4: éŸ³æ•ˆè„šæœ¬ (å¦ä¸€ä¸ªè®¢é˜…è€…)\n1 2 3 4 5 6 7 8 9 10 11 12 public class AudioManager : MonoBehaviour { void OnEnable() =\u0026gt; EventBus.Subscribe\u0026lt;EventCoinCollected\u0026gt;(PlaySound); void OnDisable() =\u0026gt; EventBus.Unsubscribe\u0026lt;EventCoinCollected\u0026gt;(PlaySound); void PlaySound(EventCoinCollected e) { if (e.isSpecial) Play(\u0026#34;BigCoinSound\u0026#34;); else Play(\u0026#34;NormalCoinSound\u0026#34;); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ è§£è€¦ (Decoupling)ï¼š\nä½ çœ‹ä¸Šé¢çš„ä¾‹å­ï¼šPlayerÂ æ ¹æœ¬ä¸çŸ¥é“Â UIManagerÂ å’ŒÂ AudioManagerÂ çš„å­˜åœ¨ã€‚ä½ åˆ æ‰ UI è„šæœ¬ï¼Œç©å®¶ç…§æ ·èƒ½æ¡é’±ï¼Œä¸ä¼šæŠ¥é”™ã€‚è¿™å°±æ˜¯æ¶æ„çš„é­…åŠ›ã€‚ Struct vs Class äº‹ä»¶ï¼š\nStructï¼šä½œä¸ºäº‹ä»¶å‚æ•°ï¼ˆTï¼‰æ—¶ï¼Œåˆ†é…åœ¨æ ˆä¸Šï¼ˆå¦‚æœä¸ç”¨è£…ç®±ï¼‰ï¼Œé€šå¸¸æ¯” Class æ›´è½»é‡ï¼Œé€‚åˆé«˜é¢‘äº‹ä»¶ã€‚ é™æ€ç±»çš„ç”Ÿå‘½å‘¨æœŸï¼š\nstatic EventBusÂ åœ¨åˆ‡æ¢åœºæ™¯æ—¶ä¸ä¼šè‡ªåŠ¨æ¸…ç©ºã€‚\nå¿…è€ƒé¢˜ï¼šå¦‚æœåœ¨ Scene A é‡Œï¼Œä¸€ä¸ªç‰©ä½“è®¢é˜…äº†äº‹ä»¶ï¼Œç„¶ååˆ‡æ¢åˆ° Scene Bï¼Œç‰©ä½“è¢«é”€æ¯äº†ã€‚å¦‚æœ Event Bus ä¸æ¸…ç†ï¼Œå®ƒè¿˜æŒæœ‰é‚£ä¸ªç‰©ä½“çš„å¼•ç”¨ã€‚\nè§£å†³æ–¹æ¡ˆï¼šåœ¨Â GameManagerÂ åˆ‡æ¢åœºæ™¯æ—¶è°ƒç”¨Â EventBus.ClearAll()ï¼Œæˆ–è€…ç¡®ä¿æ¯ä¸ªç‰©ä½“éƒ½ä¸¥æ ¼å†™äº†Â OnDisableÂ -\u0026gt;Â Unsubscribeã€‚\nDelegate çš„æœ¬è´¨ï¼š\nç†è§£Â DelegateÂ æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚+=Â æ˜¯åœ¨é“¾è¡¨æœ«å°¾åŠ èŠ‚ç‚¹ï¼Œ-=Â æ˜¯ç§»é™¤èŠ‚ç‚¹ã€‚ä¿®å¤ç‰ˆåˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œé¿å…äº† Lambda åŒ…è£…å™¨çš„å‘ã€‚ äºŒåä¸‰ã€æœ‰é™çŠ¶æ€æœº ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå°†å¤æ‚çš„é€»è¾‘æ‹†åˆ†æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„â€œçŠ¶æ€â€ï¼ˆå¦‚å¾…æœºã€è·‘æ­¥ã€æ”»å‡»ï¼‰ï¼Œå¹¶ç”±ä¸€ä¸ªâ€œæœºå™¨â€æ¥ç®¡ç†çŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ã€‚\nè®¾è®¡æ¨¡å¼ï¼šçŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰ã€‚\næ³›å‹è®¾è®¡ï¼šÂ çš„ä½¿ç”¨éå¸¸é«˜æ˜ï¼Œæ„å‘³ç€è¿™å°±ä¸€å¥—ä»£ç å¯ä»¥ç»™ä¸»è§’ï¼ˆStateMachineï¼‰ç”¨ï¼Œä¹Ÿå¯ä»¥ç»™Bossï¼ˆStateMachineï¼‰ç”¨ï¼Œå¤ç”¨æ€§æé«˜ã€‚\næ ¸å¿ƒä»·å€¼ï¼šè§£è€¦ã€‚æ”»å‡»çŠ¶æ€çš„ä»£ç åªç®¡æ”»å‡»ï¼Œä¸çŸ¥é“ç§»åŠ¨çŠ¶æ€çš„å­˜åœ¨ï¼›çŠ¶æ€æœºåªç®¡åˆ‡æ¢ï¼Œä¸çŸ¥é“å…·ä½“é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 public class StateMachine\u0026lt;T\u0026gt; { public BaseState\u0026lt;T\u0026gt; CurrentState { get; private set; } public BaseState\u0026lt;T\u0026gt; PreviousState { get; private set; } // æ–°å¢ï¼šè®°å½•å‰ä¸€ä¸ªçŠ¶æ€ private T _owner; private bool _isTransitioningState = false; // é˜²æ­¢é€’å½’åˆ‡æ¢ public StateMachine(T owner) { _owner = owner; } public void ChangeState(BaseState\u0026lt;T\u0026gt; newState) { if (_isTransitioningState) return; if (CurrentState == newState) return; // é˜²æ­¢é‡å¤è¿›å…¥åŒä¸€çŠ¶æ€ _isTransitioningState = true; if (CurrentState != null) { CurrentState.Exit(); PreviousState = CurrentState; // è®°å½•å‰ä»» } CurrentState = newState; if (CurrentState != null) { CurrentState.Enter(); } _isTransitioningState = false; } /// \u0026lt;summary\u0026gt; /// è¿”å›åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€ (å¸¸ç”¨äº æ”»å‡»/ç¡¬ç›´ ç»“æŸåæ¢å¤ å¾…æœº/ç§»åŠ¨) /// \u0026lt;/summary\u0026gt; public void RevertToPreviousState() { if (PreviousState != null) { ChangeState(PreviousState); } } public void Update() { CurrentState?.Update(); } // ç‰©ç†æ›´æ–°ï¼Œå¯¹äº 2D ç§»åŠ¨é€»è¾‘å¾ˆé‡è¦ public void FixedUpdate() { // å‡è®¾ BaseState é‡Œä¹ŸåŠ äº† FixedUpdate æ–¹æ³• // CurrentState?.FixedUpdate(); } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ï¼šç¼–å†™ä¸€ä¸ª 2D å·¡é€»æ€ª å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå²è±å§†ï¼ˆSlimeï¼‰ï¼Œå®ƒæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šå·¡é€»ï¼ˆPatrolï¼‰Â å’ŒÂ è¿½é€ï¼ˆChaseï¼‰ã€‚\næ­¥éª¤ 1ï¼šå®šä¹‰å®¿ä¸»ï¼ˆOwnerï¼‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public class SlimeEnemy : MonoBehaviour { // çŠ¶æ€æœºå®ä¾‹ public StateMachine\u0026lt;SlimeEnemy\u0026gt; fsm; // ç¼“å­˜çŠ¶æ€å®ä¾‹ï¼ˆä¼˜åŒ–ç‚¹ï¼šé¿å… new äº§ç”Ÿçš„ GCï¼‰ public PatrolState patrolState; public ChaseState chaseState; public float moveSpeed = 2f; public Transform player; void Start() { fsm = new StateMachine\u0026lt;SlimeEnemy\u0026gt;(this); // åˆå§‹åŒ–å…·ä½“çŠ¶æ€ patrolState = new PatrolState(this); chaseState = new ChaseState(this); // å¯åŠ¨ï¼ fsm.ChangeState(patrolState); } void Update() { // é©±åŠ¨çŠ¶æ€æœºè¿è½¬ fsm.Update(); } } æ­¥éª¤ 2ï¼šç¼–å†™å…·ä½“çŠ¶æ€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 // å·¡é€»çŠ¶æ€ public class PatrolState : BaseState\u0026lt;SlimeEnemy\u0026gt; { public PatrolState(SlimeEnemy owner) : base(owner) { } public override void Enter() { Debug.Log(\u0026#34;å¼€å§‹å·¡é€»...\u0026#34;); // _owner.animator.Play(\u0026#34;Walk\u0026#34;); } public override void Update() { // ç®€å•çš„å‘å·¦ç§»åŠ¨ _owner.transform.Translate(Vector2.left * _owner.moveSpeed * Time.deltaTime); // æ£€æµ‹ï¼šå¦‚æœå‘ç°ç©å®¶ï¼Œåˆ‡æ¢åˆ°è¿½é€çŠ¶æ€ if (Vector2.Distance(_owner.transform.position, _owner.player.position) \u0026lt; 5f) { _owner.fsm.ChangeState(_owner.chaseState); } } } // è¿½é€çŠ¶æ€ public class ChaseState : BaseState\u0026lt;SlimeEnemy\u0026gt; { public ChaseState(SlimeEnemy owner) : base(owner) { } public override void Enter() { Debug.Log(\u0026#34;å‘ç°ç©å®¶ï¼å¼€å§‹è¿½é€ï¼\u0026#34;); // _owner.animator.Play(\u0026#34;Run\u0026#34;); } public override void Update() { // å‘ç©å®¶ç§»åŠ¨ _owner.transform.position = Vector2.MoveTowards( _owner.transform.position, _owner.player.position, _owner.moveSpeed * 2 * Time.deltaTime ); // å¦‚æœç©å®¶è·‘è¿œäº†ï¼Œåˆ‡å›å·¡é€» if (Vector2.Distance(_owner.transform.position, _owner.player.position) \u0026gt; 8f) { _owner.fsm.ChangeState(_owner.patrolState); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ å¤šæ€ (Polymorphism)ï¼š\nStateMachineÂ æŒæœ‰çš„æ˜¯çˆ¶ç±»Â BaseStateÂ çš„å¼•ç”¨ï¼Œä½†å®é™…è¿è¡Œçš„æ˜¯å­ç±»Â PatrolStateÂ çš„é€»è¾‘ã€‚è¿™æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ç²¾é«“ã€‚ é¿å… GC (Garbage Collection)ï¼š\næ–°æ‰‹é™·é˜±ï¼šfsm.ChangeState(new AttackState(this))ã€‚åƒä¸‡åˆ«è¿™ä¹ˆå†™ï¼è¿™æ ·æ¯æ¬¡åˆ‡æ¢éƒ½åœ¨åˆ†é…å†…å­˜ï¼Œä¼šå¯¼è‡´å¡é¡¿ã€‚\næ­£ç¡®åšæ³•ï¼šåƒä¸Šé¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œåœ¨Â StartÂ é‡ŒæŠŠæ‰€æœ‰çŠ¶æ€éƒ½Â newÂ å¥½å­˜èµ·æ¥ï¼Œåˆ‡æ¢æ—¶åªä¼ å¼•ç”¨ã€‚\nOwner æ¨¡å¼ï¼š\nçŠ¶æ€ç±»ä¸å­˜å‚¨æ•°æ®ï¼ˆå¦‚è¡€é‡ã€é€Ÿåº¦ï¼‰ï¼Œåªå­˜å‚¨è¡Œä¸ºé€»è¾‘ã€‚æ•°æ®å…¨éƒ¨å­˜åœ¨Â Ownerï¼ˆå®¿ä¸»ï¼‰èº«ä¸Šã€‚è¿™æ ·ä¿è¯äº†çŠ¶æ€ç±»æ˜¯è½»é‡çº§çš„ã€‚ FixedUpdate çš„å¿…è¦æ€§ï¼š\nåœ¨ 2D æ¸¸æˆä¸­ï¼Œç§»åŠ¨é€»è¾‘é€šå¸¸æ¶‰åŠÂ Rigidbody2Dï¼Œå»ºè®®åœ¨Â BaseStateÂ å’ŒÂ StateMachineÂ ä¸­å¢åŠ Â FixedUpdateÂ è™šæ–¹æ³•ï¼Œä¸“é—¨å¤„ç†ç‰©ç†é€»è¾‘ã€‚ äºŒåå››ã€æ•°å€¼ä¿®é¥°å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šç®¡ç†ä¸€ä¸ªæ•°å€¼ï¼ˆå¦‚æ”»å‡»åŠ›ï¼‰ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—æ¥è‡ªä¸åŒæ¥æºï¼ˆè£…å¤‡ã€è¯æ°´ã€å¤©èµ‹ï¼‰çš„åŠ æˆã€‚\næ ¸å¿ƒæ¨¡å¼ï¼šè„æ ‡è®°æ¨¡å¼ï¼ˆDirty Flag Patternï¼‰ã€‚\nç—›ç‚¹ï¼šå¦‚æœæ¯å¸§ï¼ˆUpdateï¼‰éƒ½å»éå†å‡ åä¸ª Buff æ¥è®¡ç®—æ”»å‡»åŠ›ï¼ŒCPU ä¼šçˆ†ç‚¸ã€‚\nè§£æ³•ï¼šåªæœ‰å½“ Buff å‘ç”Ÿå¢å‡æ—¶ï¼Œæ‰æ ‡è®°ä¸ºâ€œè„ï¼ˆDirtyï¼‰â€ã€‚ä¸‹æ¬¡æœ‰äººé—®â€œå¤šå°‘æ”»ï¼Ÿâ€æ—¶ï¼Œå‘ç°æ˜¯è„çš„æ‰é‡æ–°ç®—ï¼›å¦‚æœä¸æ˜¯è„çš„ï¼Œç›´æ¥è¿”å›ä¸Šæ¬¡ç®—å¥½çš„ç¼“å­˜ã€‚\næ•°å­¦æ¨¡å‹ï¼šæ ‡å‡† RPG å…¬å¼ï¼š\n1 Final=(Base+Flat)Ã—(1+âˆ‘%Add)Ã—(âˆ%Mult) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 using System; using System.Collections.Generic; using UnityEngine; [Serializable] public class Stat { [SerializeField] private float _baseValue; // ä¼˜åŒ– 1: ä¿æŒåˆ—è¡¨æœ‰åºï¼Œè®¡ç®—é€Ÿåº¦æ›´å¿« private readonly List\u0026lt;StatModifier\u0026gt; _modifiers = new List\u0026lt;StatModifier\u0026gt;(); private bool _isDirty = true; private float _cachedValue; public float BaseValue { get =\u0026gt; _baseValue; set { _baseValue = value; _isDirty = true; } } public float Value { get { if (_isDirty) { _cachedValue = CalculateFinalValue(); _isDirty = false; } return _cachedValue; } } public Stat(float baseValue = 0) { _baseValue = baseValue; } public void AddModifier(StatModifier mod) { _modifiers.Add(mod); _isDirty = true; // ä¼˜åŒ– 2: æ¯æ¬¡æ·»åŠ åæ’åºï¼Œç¡®ä¿ Flat åœ¨å‰ï¼ŒMult åœ¨å _modifiers.Sort(CompareModifierOrder); } // ä¼˜åŒ– 3: æ ¹æ®æ¥æºæ‰¹é‡ç§»é™¤ (å¸è½½è£…å¤‡ç¥å™¨) public bool RemoveAllModifiersFromSource(object source) { bool didRemove = false; // å€’åºéå†åˆ é™¤æ˜¯å®‰å…¨çš„ for (int i = _modifiers.Count - 1; i \u0026gt;= 0; i--) { if (_modifiers[i].Source == source) { _modifiers.RemoveAt(i); didRemove = true; } } if (didRemove) _isDirty = true; return didRemove; } private int CompareModifierOrder(StatModifier a, StatModifier b) { if (a.Type \u0026lt; b.Type) return -1; if (a.Type \u0026gt; b.Type) return 1; return 0; } private float CalculateFinalValue() { float finalValue = BaseValue; float sumPercentAdd = 0; // å› ä¸ºæ’å¥½åºäº†ï¼ŒFlat ä¸€å®šåœ¨ PercentAdd å‰é¢ï¼Œé€»è¾‘æ›´æ¸…æ™°ï¼Œä½†è¿™é‡Œä¸ºäº†å…¼å®¹æ··åˆè®¡ç®—ï¼Œ // æˆ‘ä»¬è¿˜æ˜¯å¾—éå†ã€‚ä¸è¿‡æœ‰åºåˆ—è¡¨å¯¹äºæŸäº›å¤æ‚çš„ Order éœ€æ±‚å¾ˆæœ‰å¸®åŠ©ã€‚ for (int i = 0; i \u0026lt; _modifiers.Count; i++) { StatModifier mod = _modifiers[i]; if (mod.Type == ModifierType.Flat) { finalValue += mod.Value; } else if (mod.Type == ModifierType.PercentAdd) { sumPercentAdd += mod.Value; // è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ï¼šå¦‚æœåˆ—è¡¨æ˜¯æœ‰åºçš„ï¼Œå½“é‡åˆ°ç¬¬ä¸€ä¸ª PercentAdd æ—¶ï¼Œ // è¯´æ˜æ‰€æœ‰çš„ Flat éƒ½åŠ å®Œäº†ã€‚ } else if (mod.Type == ModifierType.PercentMult) { // åœ¨è¿›å…¥ä¹˜æ³•è®¡ç®—å‰ï¼Œå…ˆç»“ç®—å‰é¢çš„åŠ æˆ // ä½†ä¸ºäº†é€»è¾‘ç®€å•ï¼Œé€šå¸¸å»ºè®®è¿˜æ˜¯åˆ†ä¸¤æ­¥ï¼Œæˆ–è€…åƒåŸä»£ç é‚£æ ·ã€‚ // å·¥ä¸šçº§é€šå¸¸ä¼šæœ‰æ›´å¤æ‚çš„ Order å­—æ®µï¼Œè¿™é‡Œä¿æŒåŸé€»è¾‘ã€‚ } } // é‡æ–°æ•´ç†ä¸€éæœ€é«˜æ•ˆçš„ç®—æ³• (O(N) ä¸€æ¬¡éå†) // å®é™…ä¸Šç”±äº PercentAdd æ˜¯åŠ åœ¨ä¸€èµ·å†ä¹˜çš„ï¼Œå¿…é¡»å…¨éƒ¨ç»Ÿè®¡å®Œ PercentAdd æ‰èƒ½ä¹˜ã€‚ // æ‰€ä»¥åŸä»£ç çš„é€»è¾‘å…¶å®æ˜¯æ­£ç¡®çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥å†™å¾—æ›´ç´§å‡‘ã€‚ // è®©æˆ‘ä»¬ç”¨æœ€ç¨³å¥çš„ O(2N) é€»è¾‘ï¼Œæˆ–è€… O(N) é…åˆå¤šä¸ªå˜é‡ // æ¨èï¼šè¿˜æ˜¯ç”¨ä¸‰ä¸ªç´¯åŠ å™¨ï¼Œéå†ä¸€æ¬¡ return CalculateFast(); } private float CalculateFast() { float finalValue = BaseValue; float sumPercentAdd = 0; float finalMult = 1f; for (int i = 0; i \u0026lt; _modifiers.Count; i++) { var mod = _modifiers[i]; if (mod.Type == ModifierType.Flat) finalValue += mod.Value; else if (mod.Type == ModifierType.PercentAdd) sumPercentAdd += mod.Value; else if (mod.Type == ModifierType.PercentMult) finalMult *= mod.Value; } // å…¬å¼ï¼š(Base + Flat) * (1 + sum%) * (mult1 * mult2...) return (finalValue * (1 + sumPercentAdd)) * finalMult; } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šä¸»è§’è£…å¤‡äº†ä¸€æŠŠå‰‘ï¼Œå¹¶å–äº†ä¸€ç“¶ç‹‚æš´è¯æ°´\nPlayerStats.cs\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public class PlayerStats : MonoBehaviour { // å®šä¹‰æ”»å‡»åŠ›ï¼Œåˆå§‹ 10 ç‚¹ public Stat attack = new Stat(10f); void Start() { Debug.Log(\u0026#34;åˆå§‹æ”»å‡»: \u0026#34; + attack.Value); // è¾“å‡º 10 // 1. ç©¿ä¸Šä¸€æŠŠé“å‰‘ (+5 å›ºå®šæ”»å‡») var swordMod = new StatModifier(5f, ModifierType.Flat, this); attack.AddModifier(swordMod); Debug.Log(\u0026#34;ç©¿å‰‘å: \u0026#34; + attack.Value); // è¾“å‡º 15 // 2. å–ç‹‚æš´è¯æ°´ (+50% æ”»å‡») var potionMod = new StatModifier(0.5f, ModifierType.PercentAdd, this); attack.AddModifier(potionMod); // è®¡ç®—é€»è¾‘: (10 + 5) * (1 + 0.5) = 22.5 Debug.Log(\u0026#34;å–è¯å: \u0026#34; + attack.Value); // è¾“å‡º 22.5 // 3. è¯æ°´è¿‡æœŸ (ç§»é™¤) attack.RemoveModifier(potionMod); Debug.Log(\u0026#34;è¯æ•ˆç»“æŸ: \u0026#34; + attack.Value); // å›åˆ° 15 } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ è„æ ‡è®° (Dirty Flag)ï¼š\né¢è¯•å¿…è€ƒï¼šæ¯å½“æ•°æ®å¯èƒ½å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¸ç«‹å³è®¡ç®—ï¼Œè€Œæ˜¯ç«‹ä¸€ä¸ª Flagã€‚åªæœ‰åœ¨å¤–ç•Œè¯·æ±‚æ•°æ®æ—¶ï¼Œæ‰æ£€æŸ¥ Flag å†³å®šæ˜¯å¦è®¡ç®—ã€‚è¿™æ˜¯å›¾å½¢å­¦ã€ç‰©ç†å¼•æ“å’Œæ•°å€¼ç­–åˆ’ä¸­é€šç”¨çš„ä¼˜åŒ–æ‰‹æ®µã€‚ æ•°å€¼å…¬å¼é¡ºåºï¼š\nB -\u0026gt; F -\u0026gt; A -\u0026gt; M\nBaseÂ (åŸºç¡€)\nFlatÂ (å›ºå®šåŠ å€¼)\nAddÂ (ç™¾åˆ†æ¯”å åŠ )\nMultÂ (ç‹¬ç«‹ä¹˜åŒº - ç¨€æœ‰ä¸”å¼ºå¤§)\nç†è§£è¿™ä¸ªé¡ºåºï¼Œä½ å°±èƒ½è®¾è®¡å‡ºå¹³è¡¡çš„è£…å¤‡ç³»ç»Ÿã€‚\nä¾èµ–æ³¨å…¥ (Source)ï¼š\nåœ¨Â StatModifierÂ é‡Œå­˜Â object Sourceã€‚è¿™æ˜¯ä¸€ç§ç®€å•çš„ä¾èµ–æ³¨å…¥æ€æƒ³ã€‚Modifier çŸ¥é“æ˜¯è°åˆ›é€ äº†å®ƒã€‚è¿™å¯¹äºåç»­çš„é€»è¾‘æ¸…ç†ï¼ˆå¦‚ Buff é©±æ•£ã€è£…å¤‡å¸è½½ï¼‰è‡³å…³é‡è¦ã€‚ äºŒåäº”ã€éŸ³é¢‘ç®¡ç†å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå…¨å±€ç®¡ç† BGM å’Œ SFXï¼ˆéŸ³æ•ˆï¼‰ã€‚\nä¾èµ–åº“ï¼šDOTweenã€‚è¿™æ˜¯ Unity æœ€å¥½ç”¨çš„åŠ¨ç”»æ’ä»¶ï¼Œåœ¨è¿™é‡Œç”¨äºå¤„ç†éŸ³é‡çš„çº¿æ€§æ’å€¼ã€‚\näº®ç‚¹ï¼š\næ·¡å…¥æ·¡å‡º (Cross-fading)ï¼šéŸ³ä¹åˆ‡æ¢æ—¶å…ˆå˜å°å£°ï¼Œåˆ‡æ­Œï¼Œå†å˜å¤§å£°ï¼Œéå¸¸ä¸æ»‘ã€‚\nå•ä¾‹æ¨¡å¼ï¼šä¿è¯å…¨å±€åªæœ‰ä¸€ä¸ªéŸ³é¢‘æ§åˆ¶å™¨ï¼Œä¸”è·¨åœºæ™¯å­˜åœ¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 using UnityEngine; using UnityEngine.Audio; // å¼•å…¥ Mixer å‘½åç©ºé—´ using DG.Tweening; public class AudioManager : Singleton\u0026lt;AudioManager\u0026gt; { [Header(\u0026#34;ç»„ä»¶é…ç½®\u0026#34;)] public AudioSource musicSource; public AudioSource sfxSource; [Header(\u0026#34;æ··éŸ³å™¨ (å¿…å¡«)\u0026#34;)] // è¯·åœ¨ Unity èµ„æºé‡Œåˆ›å»ºä¸€ä¸ª AudioMixerï¼Œå¹¶æ‹–å…¥è¿™é‡Œçš„ Group public AudioMixerGroup musicGroup; public AudioMixerGroup sfxGroup; [Header(\u0026#34;è®¾ç½®\u0026#34;)] public float musicFadeDuration = 1.0f; // ç¼“å­˜ç©å®¶è®¾ç½®çš„éŸ³ä¹éŸ³é‡ (0~1) private float _targetMusicVolume = 1.0f; protected override void Awake() { base.Awake(); // ç¡®ä¿å•ä¾‹åˆå§‹åŒ– // è‡ªåŠ¨è¡¥å…¨ AudioSource if (musicSource == null) musicSource = gameObject.AddComponent\u0026lt;AudioSource\u0026gt;(); if (sfxSource == null) sfxSource = gameObject.AddComponent\u0026lt;AudioSource\u0026gt;(); // é…ç½® AudioSource musicSource.loop = true; musicSource.outputAudioMixerGroup = musicGroup; // ç»‘å®š Mixer sfxSource.outputAudioMixerGroup = sfxGroup; } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾èƒŒæ™¯éŸ³ä¹ (ä¿®å¤äº†éŸ³é‡é‡ç½® Bug) /// \u0026lt;/summary\u0026gt; public void PlayMusic(AudioClip clip) { // å¦‚æœæ˜¯åŒä¸€é¦–ï¼Œå•¥ä¹Ÿä¸åš if (musicSource.clip == clip) return; // 1. æ€æ‰æ—§çš„åŠ¨ç”»ï¼Œé˜²æ­¢å¿«é€Ÿåˆ‡æ¢å¯¼è‡´å›è°ƒæ··ä¹± musicSource.DOKill(); // 2. å¦‚æœå½“å‰æ²¡åœ¨æ’­ï¼Œç›´æ¥å¼€å§‹ if (musicSource.clip == null) { musicSource.clip = clip; musicSource.volume = 0; musicSource.Play(); musicSource.DOFade(_targetMusicVolume, musicFadeDuration); return; } // 3. å¦‚æœåœ¨æ’­ï¼Œæ‰§è¡Œæ ‡å‡† FadeOut -\u0026gt; Switch -\u0026gt; FadeIn æµç¨‹ musicSource.DOFade(0, musicFadeDuration).OnComplete(() =\u0026gt; { musicSource.clip = clip; musicSource.Play(); // è¿™é‡Œ fade å› _targetMusicVolumeï¼Œè€Œä¸æ˜¯ 1 musicSource.DOFade(_targetMusicVolume, musicFadeDuration); }); } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾éŸ³æ•ˆ (å¸¦éšæœºéŸ³è°ƒ) /// \u0026lt;/summary\u0026gt; public void PlaySFX(AudioClip clip, float volumeScale = 1.0f, bool randomPitch = false) { if (clip == null) return; // ç®€å•çš„éšæœºéŸ³è°ƒï¼Œå¢åŠ  2D æ¸¸æˆçš„æ‰“å‡»æ„Ÿ sfxSource.pitch = randomPitch ? Random.Range(0.9f, 1.1f) : 1.0f; sfxSource.PlayOneShot(clip, volumeScale); } /// \u0026lt;summary\u0026gt; /// è°ƒèŠ‚éŸ³ä¹éŸ³é‡ (ç”¨äºè®¾ç½®èœå•) /// \u0026lt;/summary\u0026gt; public void SetMusicVolume(float volume) { _targetMusicVolume = Mathf.Clamp01(volume); // å¦‚æœå½“å‰æ­£åœ¨æ’­æ”¾ï¼Œå®æ—¶è°ƒæ•´ // åªæœ‰å½“éŸ³ä¹ä¸å¤„äº fade è¿‡ç¨‹ä¸­æ‰è°ƒæ•´ï¼Œé¿å…æ‰“æ–­è½¬åœº // ä½†ä¸ºäº†å“åº”åŠæ—¶ï¼Œé€šå¸¸ç›´æ¥ DOKill å¹¶è·³åˆ°ç›®æ ‡å€¼ musicSource.DOKill(); musicSource.volume = _targetMusicVolume; } /// \u0026lt;summary\u0026gt; /// çœŸæ­£çš„é™éŸ³åŠŸèƒ½ (é€šè¿‡ Mixer) /// \u0026lt;/summary\u0026gt; public void SetMasterVolume(float volume) { // AudioMixer çš„éŸ³é‡æ˜¯åˆ†è´ (dB)ï¼ŒèŒƒå›´é€šå¸¸æ˜¯ -80 åˆ° 0 // éœ€è¦æŠŠ 0-1 çš„çº¿æ€§å€¼è½¬æ¢ä¸ºå¯¹æ•° float db = volume \u0026lt;= 0 ? -80f : Mathf.Log10(volume) * 20f; // å‡è®¾ä½ çš„ Mixer é‡Œæš´éœ²äº†ä¸€ä¸ªå« \u0026#34;MasterVolume\u0026#34; çš„å‚æ•° musicGroup.audioMixer.SetFloat(\u0026#34;MasterVolume\u0026#34;, db); } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šä¸»èœå• -\u0026gt; è¿›å…¥æ¸¸æˆ\nMain Menuï¼š\n1 2 // æ’­æ”¾èˆ’ç¼“çš„èœå•éŸ³ä¹ AudioManager.Instance.PlayMusic(menuThemeClip); ç‚¹å‡»å¼€å§‹æ¸¸æˆï¼š\n1 2 3 // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ AudioManager.Instance.PlaySFX(buttonClickClip); // åŠ è½½åœºæ™¯... Level 1 Startï¼š\n1 2 3 // è‡ªåŠ¨å¹³æ»‘åˆ‡æ¢åˆ°æ¿€æ˜‚çš„æˆ˜æ–—éŸ³ä¹ // å³ä½¿ä½ åœ¨ Start é‡Œç›´æ¥è°ƒç”¨ï¼Œå› ä¸ºæœ‰ fadeDurationï¼Œå¬èµ·æ¥ä¹Ÿä¸ä¼šçªå…€ AudioManager.Instance.PlayMusic(battleThemeClip); æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ DOKill (Tween Killing)ï¼š\nåœ¨å¤„ç†å¼‚æ­¥åŠ¨ç”»ï¼ˆFadeï¼‰æ—¶ï¼Œæ°¸è¿œè¦å‡è®¾ç©å®¶çš„æ‰‹é€Ÿæ¯”ä½ ä»£ç å¿«ã€‚å¦‚æœç©å®¶åœ¨ 0.5 ç§’å†…è¿ç»­åˆ‡äº† 3 æ¬¡ BGMï¼Œä¸åŠ Â DOKillÂ ä½ çš„éŸ³é‡ä¼šä¹±è·³ã€‚ PlayOneShot çš„å åŠ æ€§ï¼š\nAudioSourceÂ åœ¨æ’­æ”¾Â PlayOneShotÂ æ—¶ï¼Œæ˜¯ä¸€ä¸ªæ··åˆå™¨ã€‚å®ƒå¯ä»¥åœ¨åŒä¸€ä¸ª Source ä¸Šæ··åˆæ’­æ”¾å¤šä¸ªä¸åŒçš„ Clipã€‚ä½†è¦æ³¨æ„æ€»éŸ³é‡ä¸è¦çˆ†è¡¨ã€‚ AudioMixer (åˆ†è´ vs çº¿æ€§)ï¼š\nAudioSource.volumeÂ æ˜¯ 0~1 (çº¿æ€§)ã€‚\nAudioMixerÂ æ˜¯ -80dB ~ 0dB (å¯¹æ•°)ã€‚\né¢è¯•å¿…é—®ï¼šå¦‚ä½•å°† slider çš„å€¼ç»™ Mixerï¼Ÿå…¬å¼æ˜¯Â Mathf.Log10(sliderValue) * 20ã€‚\nState Retention (çŠ¶æ€ä¿æŒ)ï¼š\nå½“ä½ ç¼–å†™ä»»ä½•æ¶‰åŠâ€œæ¸å˜åŠ¨ç”»â€çš„ç³»ç»Ÿæ—¶ï¼ŒåŠ¡å¿…å¼•å…¥ä¸€ä¸ªå˜é‡ï¼ˆå¦‚Â _targetMusicVolumeï¼‰æ¥è®°å½•â€œåŠ¨ç”»ç»“æŸååº”è¯¥åœç•™çš„å€¼â€ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ç›®æ ‡å€¼ã€‚ [éŸ³é¢‘ç³»ç»Ÿç»“åˆ] 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 using UnityEngine; using UnityEngine.Audio; using System.Collections.Generic; using System.Collections; using DG.Tweening; // å¿…é¡»å¼•ç”¨ public class AudioManager : Singleton\u0026lt;AudioManager\u0026gt; { [Header(\u0026#34;ğŸ”— è¿æ¥è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;Unity çš„ AudioMixer èµ„æº\u0026#34;)] public AudioMixerGroup musicGroup; public AudioMixerGroup sfxGroup; [Header(\u0026#34;ğŸµ BGM è®¾ç½®\u0026#34;)] public AudioSource musicSource; // ä¸“é—¨æ’­ BGM çš„æº public float musicFadeTime = 1.0f; [Header(\u0026#34;ğŸ”Š SFX å¯¹è±¡æ± è®¾ç½®\u0026#34;)] public int poolSize = 20; private Queue\u0026lt;AudioSource\u0026gt; _sfxPool; private GameObject _poolRoot; // è¿è¡Œæ—¶çŠ¶æ€ private float _targetMusicVol = 1f; protected override void Awake() { base.Awake(); // 1. åˆå§‹åŒ– BGM è½¨é“ if (musicSource == null) musicSource = gameObject.AddComponent\u0026lt;AudioSource\u0026gt;(); musicSource.loop = true; musicSource.outputAudioMixerGroup = musicGroup; // 2. åˆå§‹åŒ– SFX å¯¹è±¡æ±  InitSFXPool(); } // ========================================================= // ç¬¬ä¸€éƒ¨åˆ†ï¼šBGM ç®¡ç† (DOTween æ¸å˜) // ========================================================= public void PlayMusic(AudioClip clip) { // å¦‚æœæ˜¯åŒä¸€é¦–ï¼Œä¸é‡æ’­ if (musicSource.clip == clip) return; musicSource.DOKill(); // æ‰“æ–­ä¹‹å‰çš„æ¸å˜ // å¦‚æœå½“å‰æ˜¯é™éŸ³æˆ–ç©ºçš„ï¼Œç›´æ¥æ·¡å…¥ if (musicSource.clip == null || !musicSource.isPlaying) { musicSource.clip = clip; musicSource.volume = 0; musicSource.Play(); musicSource.DOFade(_targetMusicVolume, musicFadeTime); return; } // å¦åˆ™ï¼šæ·¡å‡ºæ—§çš„ -\u0026gt; æ¢ç¢Ÿ -\u0026gt; æ·¡å…¥æ–°çš„ musicSource.DOFade(0, musicFadeTime).OnComplete(() =\u0026gt; { musicSource.clip = clip; musicSource.Play(); musicSource.DOFade(_targetMusicVolume, musicFadeTime); }); } public void SetMusicVolume(float volume) { _targetMusicVolume = volume; musicSource.DOKill(); musicSource.volume = volume; } // ========================================================= // ç¬¬äºŒéƒ¨åˆ†ï¼šSFX ç®¡ç† (å¯¹è±¡æ±  + 2D ç©ºé—´æ„Ÿ) // ========================================================= private void InitSFXPool() { _sfxPool = new Queue\u0026lt;AudioSource\u0026gt;(); _poolRoot = new GameObject(\u0026#34;SFX_Pool_Root\u0026#34;); _poolRoot.transform.SetParent(transform); for (int i = 0; i \u0026lt; poolSize; i++) { CreatePoolItem(); } } private AudioSource CreatePoolItem() { GameObject go = new GameObject(\u0026#34;Pooled_SFX\u0026#34;); go.transform.SetParent(_poolRoot.transform); AudioSource source = go.AddComponent\u0026lt;AudioSource\u0026gt;(); source.outputAudioMixerGroup = sfxGroup; source.playOnAwake = false; // 2D æ¸¸æˆå…³é”®è®¾ç½®ï¼šSpatial Blend = 0 (ä¸å— Z è½´è·ç¦»å½±å“) source.spatialBlend = 0f; go.SetActive(false); _sfxPool.Enqueue(source); return source; } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾ 2D ç©ºé—´éŸ³æ•ˆ (æ”¯æŒç«‹ä½“å£°å®šä½) /// \u0026lt;/summary\u0026gt; public void PlaySound(AudioClip clip, Vector2 worldPos, float volume = 1f, float pitchRandom = 0f) { if (clip == null) return; // 1. ä»æ± å–å¯¹è±¡ AudioSource source; if (_sfxPool.Count \u0026gt; 0) source = _sfxPool.Dequeue(); else source = CreatePoolItem(); // è‡ªåŠ¨æ‰©å®¹ source.gameObject.SetActive(true); source.transform.position = worldPos; // 2. 2D ç«‹ä½“å£°è®¡ç®— (å·¦è¾¹å“å·¦è€³ï¼Œå³è¾¹å“å³è€³) if (Camera.main != null) { Vector3 viewportPos = Camera.main.WorldToViewportPoint(worldPos); float pan = (viewportPos.x - 0.5f) * 2f; source.panStereo = Mathf.Clamp(pan, -0.8f, 0.8f); } // 3. éšæœºéŸ³è°ƒ source.pitch = 1f + Random.Range(-pitchRandom, pitchRandom); source.volume = volume; source.clip = clip; source.Play(); // 4. å›æ”¶ StartCoroutine(ReturnToPool(source, clip.length / source.pitch)); } /// \u0026lt;summary\u0026gt; /// æ’­æ”¾ UI éŸ³æ•ˆ (æ— ç©ºé—´æ„Ÿ) /// \u0026lt;/summary\u0026gt; public void PlayUISound(AudioClip clip, float volume = 1f) { if (clip == null) return; // å¤ç”¨ BGM çš„ AudioSource æ¥æ’­ UI å£°ä¹Ÿå¯ä»¥ï¼Œæˆ–è€…å•ç‹¬å†å¼€ä¸€ä¸ª UI Source // è¿™é‡Œä¸ºäº†ç®€å•ï¼Œä½¿ç”¨ PlayOneShot æŒ‚åœ¨ musicSource ä¸Šï¼ˆå¦‚æœä¸ä»‹æ„æ··éŸ³ç»„çš„è¯ï¼‰ // æˆ–è€…ç›´æ¥è°ƒç”¨ PlaySound å¹¶ä¼ å…¥å±å¹•ä¸­å¿ƒä½ç½® PlaySound(clip, Camera.main.transform.position, volume); } private IEnumerator ReturnToPool(AudioSource source, float delay) { yield return new WaitForSeconds(delay + 0.1f); source.Stop(); source.gameObject.SetActive(false); _sfxPool.Enqueue(source); } } ä½¿ç”¨æŒ‡å—ï¼šå¦‚ä½•è°ƒç”¨ï¼Ÿ ç°åœ¨ï¼Œä½ åªéœ€è¦å’Œè¿™ä¸€ä¸ªÂ AudioManagerÂ æ‰“äº¤é“ï¼Œé€»è¾‘éå¸¸æ¸…æ™°ï¼š\nåœºæ™¯ Aï¼šè¿›å…¥ Boss æˆ˜\n1 2 // è°ƒç”¨ BGM æ¨¡å—ï¼Œè‡ªåŠ¨æ·¡å…¥æ·¡å‡º AudioManager.Instance.PlayMusic(bossBattleBGM); åœºæ™¯ Bï¼šä¸»è§’å¼€æª\n1 2 3 // è°ƒç”¨ SFX æ¨¡å—ï¼Œå¸¦å¯¹è±¡æ± å’ŒéšæœºéŸ³è°ƒ // transform.position å†³å®šäº†å£°éŸ³æ˜¯ä»å·¦è¾¹è¿˜æ˜¯å³è¾¹ä¼ æ¥ AudioManager.Instance.PlaySound(gunShotClip, transform.position, 1.0f, 0.1f); åœºæ™¯ Cï¼šç‚¹å‡» UI æŒ‰é’®\n1 2 // ç®€å•çš„ UI éŸ³æ•ˆ AudioManager.Instance.PlayUISound(clickClip); äºŒåå…­ã€è°ƒè¯•æ§åˆ¶å° ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šæä¾›ä½œå¼ŠæŒ‡ä»¤ï¼ˆå›è¡€ã€ç§’æ€å…¨å±ã€è·å¾—é“å…·ï¼‰ã€‚\nå…³é”®ç‰¹æ€§ï¼š[ContextMenu]ã€‚è¿™æ˜¯ Unity ç¼–è¾‘å™¨æ‰©å±•çš„ä¸€ä¸ªå°æŠ€å·§ï¼Œå…è®¸ä½ ç»™è„šæœ¬çš„å³ä¸Šè§’é½¿è½®èœå•ï¼ˆæˆ–ç»„ä»¶åå³é”®èœå•ï¼‰æ·»åŠ è‡ªå®šä¹‰æŒ‰é’®ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nå¿«é€Ÿæµ‹è¯•ï¼šæµ‹è¯•æ•°å€¼å¹³è¡¡ã€æµ‹è¯•æ­»äº¡é€»è¾‘ã€‚\nBug å¤ç°ï¼šå¿«é€Ÿè°ƒæ•´æ¸¸æˆçŠ¶æ€åˆ°å‡ºé”™çš„é‚£ä¸€åˆ»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 using UnityEngine; // æŒ‚è½½åœ¨åä¸º [DebugSystem] çš„ç‰©ä½“ä¸Šï¼Œå¹¶è®¾ä¸º DontDestroyOnLoad public class DebugCommands : MonoBehaviour { // åªæœ‰åœ¨ Unity ç¼–è¾‘å™¨é‡Œï¼Œæˆ–è€…å¼€å¯äº† \u0026#34;Development Build\u0026#34; é€‰é¡¹çš„åŒ…é‡Œï¼Œè¿™æ®µä»£ç æ‰ç”Ÿæ•ˆ // æ­£å¼å‘å”®çš„ Release åŒ…é‡Œï¼Œè¿™æ®µä»£ç ä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥åˆ æ‰ï¼Œæå…¶å®‰å…¨ï¼ #if UNITY_EDITOR || DEVELOPMENT_BUILD [Header(\u0026#34;è°ƒè¯•å¼€å…³\u0026#34;)] public bool showGUI = true; void Update() { // é”®ç›˜å¿«æ·é”®è§¦å‘ if (Input.GetKeyDown(KeyCode.F1)) HealPlayer(); if (Input.GetKeyDown(KeyCode.F2)) KillAllEnemies(); // åˆ‡æ¢ GUI æ˜¾ç¤º (æŒ‰æ³¢æµªå·é”® `) if (Input.GetKeyDown(KeyCode.BackQuote)) showGUI = !showGUI; } // ç»˜åˆ¶ç®€æ˜“çš„å±å¹•æŒ‰é’® (IMGUI) // è™½ç„¶ IMGUI æ€§èƒ½ä¸€èˆ¬ä¸”ä¸ä»…å¥½çœ‹ï¼Œä½†ä½œä¸ºè°ƒè¯•å·¥å…·å®ƒæ˜¯æœ€å¿«çš„ï¼Œä¸éœ€è¦é… Canvas void OnGUI() { if (!showGUI) return; GUILayout.BeginArea(new Rect(10, 10, 200, 300)); // æ ‡é¢˜ GUILayout.Label(\u0026#34;--- å¼€å‘è€…æ§åˆ¶å° ---\u0026#34;); if (GUILayout.Button(\u0026#34;F1: ç©å®¶å›æ»¡è¡€\u0026#34;)) { HealPlayer(); } if (GUILayout.Button(\u0026#34;F2: ç§’æ€å…¨å±æ•Œäºº\u0026#34;)) { KillAllEnemies(); } if (GUILayout.Button(\u0026#34;F3: åŠ é€Ÿæ¸¸æˆ (x2)\u0026#34;)) { Time.timeScale = (Time.timeScale == 1.0f) ? 2.0f : 1.0f; } GUILayout.EndArea(); } // --- å…·ä½“é€»è¾‘ --- [ContextMenu(\u0026#34;Heal Player\u0026#34;)] public void HealPlayer() { // è¿™é‡Œå‡è®¾ä½ æœ‰å•ä¾‹ï¼Œä¸”ä½¿ç”¨äº† ?. é˜²æ­¢ç©ºå¼•ç”¨æŠ¥é”™ // å¦‚æœ PlayerController ä¸ºç©ºï¼Œè¯´æ˜è¿˜æ²¡åŠ è½½å‡ºä¸»è§’ï¼Œç›´æ¥ return if (PlayerController.Instance == null) return; PlayerController.Instance.Health?.ResetHealth(); // å‡è®¾æœ‰è¿™ä¸ªæ–¹æ³• Debug.Log(\u0026#34;\u0026lt;color=green\u0026gt;[Cheat] ç©å®¶å·²å›æ»¡è¡€\u0026lt;/color\u0026gt;\u0026#34;); } [ContextMenu(\u0026#34;Nuke Enemies\u0026#34;)] public void KillAllEnemies() { // æŸ¥æ‰¾æ‰€æœ‰å®ç°äº†\u0026#34;å—ä¼¤æ¥å£\u0026#34;çš„ç‰©ä½“ï¼Œæ¯”åªæ‰¾ EnemyController æ›´é€šç”¨ // å‡è®¾ä½ æœ‰ä¸€ä¸ª IDamageable æ¥å£ var targets = FindObjectsOfType\u0026lt;EnemyController\u0026gt;(); foreach (var t in targets) { // é€ æˆå·¨é‡ä¼¤å®³ t.TakeDamage(999999); } Debug.Log($\u0026#34;\u0026lt;color=red\u0026gt;[Cheat] å·²æ¸…é™¤ {targets.Length} ä¸ªæ•Œäºº\u0026lt;/color\u0026gt;\u0026#34;); } #endif } ä½¿ç”¨åœºæ™¯ åœºæ™¯è¿è¡Œä¸­ï¼šæ¸¸æˆè·‘èµ·æ¥äº†ï¼Œä¸»è§’å¿«è¢«æ‰“æ­»äº†ã€‚\næ“ä½œï¼š\nåœ¨ Hierarchy é€‰ä¸­æŒ‚è½½äº†Â DebugCommandsÂ çš„ç‰©ä½“ã€‚\nåœ¨ Inspector æ‰¾åˆ°è¯¥ç»„ä»¶ã€‚\nå³é”®ç‚¹å‡»ç»„ä»¶æ ‡é¢˜æ ã€‚\né€‰æ‹©Â Heal Player Fullã€‚\nç»“æœï¼šä¸»è§’ç¬é—´æ»¡è¡€ã€‚\næ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ ç¼–è¾‘å™¨æ‰©å±• (Editor Scripting)ï¼š\n[ContextMenu]Â æ˜¯æœ€å…¥é—¨çš„ç¼–è¾‘å™¨æ‰©å±•ã€‚è¿›é˜¶çš„è¿˜æœ‰Â [MenuItem]ï¼ˆåœ¨é¡¶éƒ¨èœå•æ åŠ æŒ‰é’®ï¼‰å’ŒÂ CustomEditorï¼ˆé‡å†™ Inspector é¢æ¿ï¼‰ã€‚ æ¡ä»¶ç¼–è¯‘ (Conditional Compilation)ï¼š\næŒæ¡Â #if UNITY_EDITORã€#if UNITY_ANDROIDÂ ç­‰å®æŒ‡ä»¤ï¼Œæ˜¯å‘å¸ƒå¤šå¹³å°å’ŒåŒºåˆ† Debug/Release çš„å¿…å¤‡æŠ€èƒ½ã€‚ å¼€å‘è€…ä½“éªŒ (DX)ï¼š\nå¥½çš„ä»£ç ä¸ä»…è¦ç»™ç©å®¶å¥½çš„ä½“éªŒï¼Œä¹Ÿè¦ç»™å’Œä½ ä¸€èµ·å·¥ä½œçš„åŒäº‹ï¼ˆç­–åˆ’ã€æµ‹è¯•ï¼‰å¥½çš„ä½“éªŒã€‚ä¸€ä¸ªå¥½ç”¨çš„ Debug é¢æ¿èƒ½è®©å›¢é˜Ÿæ•ˆç‡ç¿»å€ã€‚ äºŒåä¸ƒã€æ•°æ®æŒä¹…åŒ– ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå°† C# å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²å¹¶å†™å…¥ç¡¬ç›˜ï¼›è¯»å–æ–‡ä»¶å¹¶ååºåˆ—åŒ–ä¸º C# å¯¹è±¡ã€‚\næ ¸å¿ƒæŠ€æœ¯ï¼š\nJsonUtilityï¼šUnity åŸç”Ÿçš„ JSON åº“ï¼Œé€Ÿåº¦æå¿«ï¼ˆæ¯”è‘—åçš„ Newtonsoft.Json å¿«ï¼‰ï¼Œä½†åŠŸèƒ½æœ‰é™ï¼ˆä¸èƒ½ç›´æ¥å­˜ Dictionaryï¼Œä¸èƒ½å­˜é¡¶å±‚æ•°ç»„ï¼‰ã€‚\nApplication.persistentDataPathï¼šé¢è¯•å¿…é—®ã€‚è¿™æ˜¯ Unity æä¾›çš„â€œæ²™ç›’è·¯å¾„â€ã€‚åœ¨ Windows ä¸Šæ˜¯Â AppDataï¼Œåœ¨ iOS/Android ä¸Šæ˜¯åº”ç”¨ç§æœ‰æ–‡æ¡£ç›®å½•ã€‚æ°¸è¿œä¸è¦æŠŠå­˜æ¡£å†™åœ¨Â AssetsÂ æ–‡ä»¶å¤¹é‡Œï¼Œå› ä¸ºæ‰“åŒ…åÂ AssetsÂ æ–‡ä»¶å¤¹æ˜¯åªè¯»çš„ï¼\nä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼šç®€å•ã€è·¨å¹³å°ã€äººç±»å¯è¯»ï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰ã€‚\n*ç¼ºç‚¹ï¼šæ˜æ–‡å­˜å‚¨ï¼ˆç©å®¶å¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€ä¿®æ”¹é‡‘å¸æ•°é‡ï¼Œå®¹æ˜“ä½œå¼Šï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 using UnityEngine; using System.IO; using System.Text; public static class SaveSystem { private const string FILE_EXT = \u0026#34;.sav\u0026#34;; // ä½¿ç”¨è‡ªå®šä¹‰åç¼€ï¼Œæ˜¾å¾—ä¸“ä¸šç‚¹ private const string ENCRYPTION_KEY = \u0026#34;MySuperSecretKey\u0026#34;; // åŠ å¯†å¯†é’¥ /// \u0026lt;summary\u0026gt; /// è·å–å­˜æ¡£è·¯å¾„ (æ”¯æŒå¤šæ§½ä½) /// \u0026lt;/summary\u0026gt; private static string GetPath(int slotIndex) { return Path.Combine(Application.persistentDataPath, $\u0026#34;save_slot_{slotIndex}{FILE_EXT}\u0026#34;); } /// \u0026lt;summary\u0026gt; /// ä¿å­˜æ•°æ® /// \u0026lt;/summary\u0026gt; /// \u0026lt;param name=\u0026#34;data\u0026#34;\u0026gt;æ•°æ®å¯¹è±¡\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;slotIndex\u0026#34;\u0026gt;å­˜æ¡£æ§½ä½ (0, 1, 2...)\u0026lt;/param\u0026gt; /// \u0026lt;param name=\u0026#34;useEncryption\u0026#34;\u0026gt;æ˜¯å¦åŠ å¯†\u0026lt;/param\u0026gt; public static void Save\u0026lt;T\u0026gt;(T data, int slotIndex = 0, bool useEncryption = true) { // 1. åºåˆ—åŒ– string json = JsonUtility.ToJson(data, !useEncryption); // åŠ å¯†å°±ä¸éœ€è¦æ ¼å¼åŒ–äº† // 2. åŠ å¯†å¤„ç† if (useEncryption) { json = EncryptDecrypt(json); } // 3. å†™å…¥æ–‡ä»¶ try { File.WriteAllText(GetPath(slotIndex), json); Debug.Log($\u0026#34;[SaveSystem] Saved to Slot {slotIndex}\u0026#34;); } catch (System.Exception e) { Debug.LogError($\u0026#34;[SaveSystem] Save Failed: {e.Message}\u0026#34;); } } /// \u0026lt;summary\u0026gt; /// è¯»å–æ•°æ® /// \u0026lt;/summary\u0026gt; public static T Load\u0026lt;T\u0026gt;(int slotIndex = 0, bool useEncryption = true) where T : new() { string path = GetPath(slotIndex); if (!File.Exists(path)) { Debug.Log($\u0026#34;[SaveSystem] Slot {slotIndex} not found, creating new.\u0026#34;); return new T(); } try { // 1. è¯»å–æ–‡ä»¶ string content = File.ReadAllText(path); // 2. è§£å¯† if (useEncryption) { content = EncryptDecrypt(content); } // 3. ååºåˆ—åŒ– return JsonUtility.FromJson\u0026lt;T\u0026gt;(content); } catch (System.Exception e) { Debug.LogError($\u0026#34;[SaveSystem] Load Failed: {e.Message}, returning new data.\u0026#34;); return new T(); // å‡ºé”™æ—¶è¿”å›é»˜è®¤å€¼ï¼Œé˜²æ­¢å¡æ­» } } /// \u0026lt;summary\u0026gt; /// åˆ é™¤å­˜æ¡£ /// \u0026lt;/summary\u0026gt; public static void DeleteSave(int slotIndex) { string path = GetPath(slotIndex); if (File.Exists(path)) File.Delete(path); } /// \u0026lt;summary\u0026gt; /// æ£€æŸ¥å­˜æ¡£æ˜¯å¦å­˜åœ¨ /// \u0026lt;/summary\u0026gt; public static bool HasSave(int slotIndex) { return File.Exists(GetPath(slotIndex)); } // --- ç®€æ˜“å¼‚æˆ–åŠ å¯† (XOR) --- // åŸç†ï¼šå¯¹å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦å’Œå¯†é’¥è¿›è¡Œå¼‚æˆ–è¿ç®—ã€‚ä¸¤æ¬¡å¼‚æˆ–å°±èƒ½è¿˜åŸã€‚ private static string EncryptDecrypt(string data) { StringBuilder modifiedData = new StringBuilder(); for (int i = 0; i \u0026lt; data.Length; i++) { modifiedData.Append((char)(data[i] ^ ENCRYPTION_KEY[i % ENCRYPTION_KEY.Length])); } return modifiedData.ToString(); } } // --- å®ç”¨å·¥å…·ï¼šList åŒ…è£…å™¨ --- // è§£å†³ JsonUtility æ— æ³•ç›´æ¥åºåˆ—åŒ– List\u0026lt;T\u0026gt; çš„é—®é¢˜ [System.Serializable] public class SerializationWrapper\u0026lt;T\u0026gt; { public List\u0026lt;T\u0026gt; list; public SerializationWrapper(List\u0026lt;T\u0026gt; list) =\u0026gt; this.list = list; } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ•°æ®ç±»æ¥æ‰¿è½½å­˜æ¡£å†…å®¹ã€‚\nStep 1: å®šä¹‰å­˜æ¡£æ•°æ®ç»“æ„ (GameData.cs)\n1 2 3 4 5 6 7 8 9 10 11 [System.Serializable] // å¿…é¡»åŠ ä¸Šè¿™ä¸ªæ ‡ç­¾ï¼Œå¦åˆ™ JsonUtility æ— æ³•è¯†åˆ«ï¼ public class GameData { public int coins = 0; public int currentLevel = 1; public float playerHealth = 100f; public Vector3 playerPosition; // JsonUtility æ”¯æŒ Vector3 // æ³¨æ„ï¼šJsonUtility æ— æ³•ç›´æ¥åºåˆ—åŒ– List\u0026lt;T\u0026gt; æˆ– Dictionary // å¦‚æœéœ€è¦å­˜ç‰©å“åˆ—è¡¨ï¼Œå»ºè®®ç”¨æ•°ç»„æˆ–å°è£…ä¸€å±‚ public List\u0026lt;string\u0026gt; inventoryItemIds = new List\u0026lt;string\u0026gt;(); } Step 2: åœ¨ GameManager ä¸­è°ƒç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 public class GameManager : MonoBehaviour { public GameData currentData; void Start() { // æ¸¸æˆå¯åŠ¨æ—¶è¯»æ¡£ currentData = SaveSystem.LoadData\u0026lt;GameData\u0026gt;(); ApplyDataToGame(); } public void SaveGame() { // æ”¶é›†å½“å‰çŠ¶æ€ currentData.coins = PlayerWallet.Instance.Coins; currentData.playerPosition = PlayerController.Instance.transform.position; // å†™å…¥ç¡¬ç›˜ SaveSystem.SaveData(currentData); } private void ApplyDataToGame() { // æŠŠè¯»å‡ºæ¥çš„æ•°æ®åº”ç”¨åˆ°æ¸¸æˆé‡Œ PlayerController.Instance.transform.position = currentData.playerPosition; // ... } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ PersistentDataPathï¼š\næ°¸è¿œä¸è¦æŠŠå­˜æ¡£ä¿å­˜åœ¨Â Application.dataPathï¼ˆå³ Assets ç›®å½•ï¼‰ï¼Œè¿™åœ¨ç¼–è¾‘å™¨é‡Œèƒ½ç”¨ï¼Œä½†æ‰“åŒ…åé‚£ä¸ªæ–‡ä»¶å¤¹æ˜¯åªè¯»çš„ï¼Œä¼šå¯¼è‡´æ¸¸æˆæ— æ³•å­˜æ¡£ã€‚\nPC è·¯å¾„é€šå¸¸åœ¨ï¼šC:\\Users\\ç”¨æˆ·å\\AppData\\LocalLow\\å…¬å¸å\\æ¸¸æˆåã€‚\nåºåˆ—åŒ–é™·é˜± (Serialization Pitfalls)ï¼š\nJsonUtilityï¼šæ— æ³•åºåˆ—åŒ–Â Dictionaryã€‚å¦‚æœä½ æƒ³å­˜èƒŒåŒ…ï¼ˆItemID -\u0026gt; æ•°é‡ï¼‰ï¼Œå¿…é¡»æŠŠå®ƒè½¬æ¢æˆä¸¤ä¸ª Listï¼Œæˆ–è€…å®šä¹‰ä¸€ä¸ªÂ class ItemEntry { id, count }Â çš„ Listã€‚\nå­—æ®µå¯è§æ€§ï¼šJsonUtilityÂ åªä¿å­˜ public å­—æ®µï¼Œæˆ–è€…åŠ äº†Â [SerializeField]Â çš„ private å­—æ®µã€‚\nVector3/Colorï¼šUnity çš„åŸç”Ÿç±»å‹ JsonUtility å¯ä»¥ç›´æ¥å­˜ï¼Œä½†ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Newtonsoftï¼‰é€šå¸¸éœ€è¦å†™è½¬æ¢å™¨ã€‚\nåŠ å¯†æ„è¯†ï¼š\nå•æœºæ¸¸æˆé˜²ä¸ä½çœŸæ­£çš„é»‘å®¢ï¼Œä½†åŠ ä¸Šç®€å•çš„ XOR æˆ– Base64 ç¼–ç ï¼Œèƒ½é˜²ä½ 90% çš„â€œæ‰‹è´±â€ç©å®¶ä¿®æ”¹å­˜æ¡£å¯¼è‡´æ¸¸æˆå´©æºƒã€‚ äºŒåå…«ã€é¡¿å¸§/æ—¶é—´å†»ç»“ç®¡ç†å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šé€šè¿‡ä¿®æ”¹ Unity å…¨å±€æ—¶é—´å€ç‡Â Time.timeScaleÂ æ¥æ§åˆ¶æ¸¸æˆèŠ‚å¥ã€‚\né€‚ç”¨åœºæ™¯ï¼š\né¡¿å¸§ (Hit Stop)ï¼šæ”»å‡»å‘½ä¸­ç¬é—´ï¼Œç”»é¢å®šæ ¼ 0.05~0.15ç§’ï¼Œå¼ºåŒ–å†²å‡»æ„Ÿã€‚\næ…¢åŠ¨ä½œ (Slow Motion)ï¼šä¸»è§’æ­»äº¡ç¬é—´ã€ç²¾å‡†é—ªé¿æˆåŠŸï¼ˆé­”å¥³æ—¶é—´ï¼‰ã€Boss é‡Šæ”¾å¤§æ‹›å‰æ‘‡ã€‚\nå…³é”®æŠ€æœ¯ï¼šWaitForSecondsRealtimeã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 using UnityEngine; using System.Collections; public class TimeManager : Singleton\u0026lt;TimeManager\u0026gt; { private float _defaultFixedDeltaTime; // çŠ¶æ€æ ˆæ ‡è®°ï¼šæ˜¯å¦æœ‰æ…¢åŠ¨ä½œæ­£åœ¨è¿›è¡Œ private bool _isSlowMotionActive = false; private float _currentSlowMotionScale = 1f; protected override void Awake() { base.Awake(); // è®°å½•æ¸¸æˆåˆå§‹çš„ç‰©ç†æ›´æ–°é¢‘ç‡ (é€šå¸¸æ˜¯ 0.02) _defaultFixedDeltaTime = Time.fixedDeltaTime; } /// \u0026lt;summary\u0026gt; /// è§¦å‘é¡¿å¸§ï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œä¼šæš‚æ—¶è¦†ç›–æ…¢åŠ¨ä½œï¼‰ /// \u0026lt;/summary\u0026gt; public void DoHitStop(float duration) { // å¦‚æœå·²ç»åœ¨é¡¿å¸§ä¸­ï¼Œä¸å†é‡å¤è§¦å‘ï¼Œæˆ–è€…å¯ä»¥é€‰æ‹©è¦†ç›– if (Time.timeScale == 0f) return; StartCoroutine(HitStopRoutine(duration)); } /// \u0026lt;summary\u0026gt; /// è§¦å‘æ…¢åŠ¨ä½œ /// \u0026lt;/summary\u0026gt; public void DoSlowMotion(float scale, float duration) { // å¦‚æœå·²ç»åœ¨æ…¢åŠ¨ä½œä¸­ï¼Œå¯ä»¥é€‰æ‹©åˆ·æ–°æ—¶é—´æˆ–å¿½ç•¥ if (_isSlowMotionActive) return; StartCoroutine(SlowMotionRoutine(scale, duration)); } // --- æ ¸å¿ƒåç¨‹ --- private IEnumerator HitStopRoutine(float duration) { // 1. è®°å½•é¡¿å¸§å‰çš„çŠ¶æ€ (å¯èƒ½æ˜¯ 1.0ï¼Œä¹Ÿå¯èƒ½æ˜¯ 0.5 çš„æ…¢åŠ¨ä½œ) float prevTimeScale = Time.timeScale; // 2. ç¬é—´å†»ç»“ SetTimeScale(0f); // 3. ç­‰å¾…çœŸå®æ—¶é—´ yield return new WaitForSecondsRealtime(duration); // 4. æ¢å¤åˆ°é¡¿å¸§å‰çš„çŠ¶æ€ (å…³é”®ä¿®å¤ï¼šä¸æ˜¯æ— è„‘æ¢å¤ 1.0) SetTimeScale(prevTimeScale); } private IEnumerator SlowMotionRoutine(float targetScale, float duration) { _isSlowMotionActive = true; _currentSlowMotionScale = targetScale; // 1. è¿›å…¥æ…¢åŠ¨ä½œ SetTimeScale(targetScale); // 2. ç­‰å¾…çœŸå®æ—¶é—´ yield return new WaitForSecondsRealtime(duration); // 3. æ¢å¤æ­£å¸¸ SetTimeScale(1f); _isSlowMotionActive = false; } // --- è¾…åŠ©æ–¹æ³• --- /// \u0026lt;summary\u0026gt; /// ç»Ÿä¸€ä¿®æ”¹æ—¶é—´ç¼©æ”¾çš„å…¥å£ï¼Œè‡ªåŠ¨å¤„ç†ç‰©ç†å’ŒéŸ³é¢‘ /// \u0026lt;/summary\u0026gt; private void SetTimeScale(float scale) { Time.timeScale = scale; // ã€å…³é”®ä¿®å¤ã€‘åŒæ­¥è°ƒæ•´ç‰©ç†æ›´æ–°é¢‘ç‡ï¼Œä¿è¯æ…¢åŠ¨ä½œä¸èˆ¬é¡ºæ»‘ // é™åˆ¶æœ€å°å€¼ä¸º 0ï¼Œé˜²æ­¢é™¤ä»¥é›¶æˆ–è´Ÿæ•°é”™è¯¯ Time.fixedDeltaTime = _defaultFixedDeltaTime * Mathf.Max(scale, 0.001f); // 0.001fé˜²æ­¢ä¸º0æ—¶ç‰©ç†å®Œå…¨åœæ­¢è®¡ç®— // ã€éŸ³é¢‘ä¿®å¤ã€‘(å¯é€‰) // è®¸å¤šæ¸¸æˆå¸Œæœ›æ…¢åŠ¨ä½œæ—¶éŸ³æ•ˆä¸å˜è°ƒï¼Œæˆ–è€…å˜è°ƒã€‚ // å¦‚æœä½ ä¸å¸Œæœ›å£°éŸ³å˜ä½æ²‰ï¼Œå¯ä»¥åå‘è®¾ç½® pitch // AudioListener.volume = 1f; // æˆ–è€…åœ¨è¿™é‡Œåšé™éŸ³å¤„ç† } } ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼šè¿å‡»ä¸å¤„å†³ åœºæ™¯ï¼šä¸»è§’è¿å‡»\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // åœ¨ Enemy.cs çš„ TakeDamage ä¸­ public void TakeDamage(int damage) { hp -= damage; // æ’­æ”¾å—å‡»ç‰¹æ•ˆ... // è§¦å‘è½»å¾®é¡¿å¸§ï¼Œå¢åŠ è‚‰æ„Ÿ (0.05ç§’) TimeManager.Instance.DoHitStop(0.05f); if (hp \u0026lt;= 0) { // æ•Œäººæ­»äº¡ç¬é—´ï¼Œè§¦å‘æ…¢åŠ¨ä½œ (0.2å€é€Ÿï¼ŒæŒç»­1ç§’)ï¼Œè¥é€ å²è¯—æ„Ÿ TimeManager.Instance.DoSlowMotion(0.2f, 1.0f); Die(); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ ç‰©ç†æ›´æ–°é¢‘ç‡ (fixedDeltaTime)ï¼š\nè¿™æ˜¯ä¸­çº§å¼€å‘è€…å¿…é¡»æŒæ¡çš„çŸ¥è¯†ç‚¹ã€‚åªè¦åŠ¨Â timeScaleï¼Œå¿…é¡»åŠ¨Â fixedDeltaTimeã€‚å¦åˆ™ä½ çš„ç‰©ç†æ¨¡æ‹Ÿï¼ˆè·³è·ƒã€å¼¹é“ï¼‰åœ¨æ…¢åŠ¨ä½œä¸‹ä¼šå®Œå…¨ä¹±å¥—ã€‚ åç¨‹ä¸çœŸå®æ—¶é—´ï¼š\næ˜ç¡®åŒºåˆ†Â WaitForSecondsÂ (å— timeScale å½±å“) å’ŒÂ WaitForSecondsRealtimeÂ (ä¸å—å½±å“)ã€‚åš UI åŠ¨ç”»ã€æš‚åœèœå•ã€é¡¿å¸§é€»è¾‘æ—¶ï¼Œé€šå¸¸ç”¨åè€…ã€‚ çŠ¶æ€æ¢å¤é€»è¾‘ï¼š\nåœ¨ä¿®æ”¹å…¨å±€çŠ¶æ€ï¼ˆå¦‚æ—¶é—´ï¼‰å‰ï¼Œå…ˆè®°å½•Â prevValueï¼Œç»“æŸåæ¢å¤Â prevValueï¼Œè€Œä¸æ˜¯æ¢å¤Â defaultã€‚è¿™æ˜¯é˜²æ­¢å¤šä¸ªç³»ç»Ÿï¼ˆé¡¿å¸§ç³»ç»Ÿã€æŠ€èƒ½ç³»ç»Ÿï¼‰æ‰“æ¶çš„å…³é”®ã€‚ äºŒåä¹ã€åŠ æƒéšæœºç®—æ³• ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šä»ä¸€å †ç‰©å“ä¸­ï¼Œæ ¹æ®å„è‡ªçš„æƒé‡ï¼ŒéšæœºæŠ½å–ä¸€ä¸ªã€‚\næ•°å­¦åŸç†ï¼š\nè®¡ç®—æ‰€æœ‰ç‰©å“çš„æƒé‡æ€»å’Œï¼ˆTotalWeightï¼‰ã€‚\nåœ¨Â 0Â åˆ°Â TotalWeightÂ ä¹‹é—´éšæœºå–ä¸€ä¸ªæ•°Â rollã€‚\néå†åˆ—è¡¨ï¼Œç´¯åŠ æƒé‡ã€‚ä¸€æ—¦ç´¯åŠ å€¼è¶…è¿‡Â rollï¼Œå½“å‰ç‰©å“å°±æ˜¯ä¸­å¥–è€…ã€‚\né€‚ç”¨åœºæ™¯ï¼š\næ€ªç‰©æ‰è½ï¼šå¤§é‡‘å¸ï¼ˆæƒé‡10ï¼‰ï¼Œå°é‡‘å¸ï¼ˆæƒé‡50ï¼‰ï¼Œå›è¡€è‰ï¼ˆæƒé‡20ï¼‰ã€‚\néšæœºåˆ·æ€ªï¼šç”Ÿæˆæ™®é€šåƒµå°¸ï¼ˆæƒé‡80ï¼‰ï¼Œç²¾è‹±åƒµå°¸ï¼ˆæƒé‡5ï¼‰ã€‚\néŸ³æ•ˆéšæœºï¼šæ”»å‡»æ—¶éšæœºæ’­æ”¾ 3 ç§æŒ¥åˆ€éŸ³æ•ˆï¼Œé˜²æ­¢å¬è§‰ç–²åŠ³ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 using System.Collections.Generic; using UnityEngine; // 1. å®šä¹‰æ‰è½é¡¹ [System.Serializable] public class LootEntry { public GameObject prefab; // æ‰è½ç‰© [Tooltip(\u0026#34;æƒé‡ï¼šæ•°å€¼è¶Šå¤§ï¼Œæ‰ç‡è¶Šé«˜\u0026#34;)] public int weight = 10; [HideInInspector] public float displayChance; // ç”¨äºåœ¨ç¼–è¾‘å™¨æ˜¾ç¤ºç™¾åˆ†æ¯” } // 2. åˆ›å»º ScriptableObjectï¼Œè®©æ‰è½è¡¨å˜æˆä¸€ä¸ªå¯å¤ç”¨çš„èµ„æºæ–‡ä»¶ [CreateAssetMenu(menuName = \u0026#34;Game/Loot Table\u0026#34;)] public class LootTableSO : ScriptableObject { [Header(\u0026#34;å…¨å±€æ‰è½ç‡ (0-1)\u0026#34;)] [Tooltip(\u0026#34;å¦‚æœæ˜¯ 0.3ï¼Œè¯´æ˜æœ‰ 70% çš„å‡ ç‡ä»€ä¹ˆéƒ½ä¸æ‰\u0026#34;)] public float globalDropChance = 1.0f; [Header(\u0026#34;æ‰è½æ± \u0026#34;)] public List\u0026lt;LootEntry\u0026gt; items; // ç¼“å­˜æ€»æƒé‡ï¼Œé¿å…æ¯æ¬¡è®¡ç®— private int _totalWeight = -1; /// \u0026lt;summary\u0026gt; /// è·å–æ‰è½ç‰©ï¼ˆå¯èƒ½è¿”å› nullï¼‰ /// \u0026lt;/summary\u0026gt; public GameObject GetLoot() { // 1. ç¬¬ä¸€å±‚åˆ¤å®šï¼šè¿™æ¬¡åˆ°åº•æ‰ä¸æ‰ï¼Ÿ if (Random.value \u0026gt; globalDropChance) return null; // 2. åˆå§‹åŒ–æ€»æƒé‡ï¼ˆæ‡’åŠ è½½ï¼‰ if (_totalWeight == -1) CalculateTotalWeight(); // 3. è½®ç›˜èµŒç®—æ³• if (items == null || items.Count == 0) return null; int roll = Random.Range(0, _totalWeight); int currentSum = 0; foreach (var entry in items) { currentSum += entry.weight; if (roll \u0026lt; currentSum) { return entry.prefab; } } return items[0].prefab; // å…œåº• } private void CalculateTotalWeight() { _totalWeight = 0; foreach (var item in items) { // é˜²æ­¢ç­–åˆ’æ‰‹æ»‘å¡«äº†è´Ÿæ•° if (item.weight \u0026lt; 0) item.weight = 0; _totalWeight += item.weight; } } // --- ç¼–è¾‘å™¨è¾…åŠ©åŠŸèƒ½ --- // è¿™ä¸ªå‡½æ•°ä¼šåœ¨ Inspector æ•°å€¼å˜åŒ–æ—¶è‡ªåŠ¨è°ƒç”¨ // è®©æˆ‘ä»¬åœ¨ç¼–è¾‘å™¨é‡Œå®æ—¶çœ‹åˆ°ç®—å¥½çš„ç™¾åˆ†æ¯”ï¼ private void OnValidate() { if (items == null || items.Count == 0) return; float total = 0; foreach (var item in items) total += item.weight; if (total \u0026gt; 0) { foreach (var item in items) { item.displayChance = (item.weight / total) * 100f; } } } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ å‡è®¾ä½ è¦åšä¸€ä¸ªÂ æ€ªç‰©æ‰è½ç³»ç»Ÿã€‚\nStep 1: å‡†å¤‡æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public class EnemyLoot : MonoBehaviour { // å®šä¹‰ä½ è¦æ‰ä»€ä¹ˆï¼Œè¿™é‡Œä»¥ GameObject ä¸ºä¾‹ [System.Serializable] public class DropTable : LootTable\u0026lt;GameObject\u0026gt; { // éœ€è¦æ˜¾å¼æ„é€ å‡½æ•°æ¥é€‚é…çˆ¶ç±» public DropTable(List\u0026lt;LootItem\u0026lt;GameObject\u0026gt;\u0026gt; items) : base(items) { } } // åœ¨ Inspector é‡Œé…ç½® public List\u0026lt;LootItem\u0026lt;GameObject\u0026gt;\u0026gt; dropConfig; private LootTable\u0026lt;GameObject\u0026gt; _lootTable; void Start() { // åˆå§‹åŒ–ç®—æ³•ç±» _lootTable = new LootTable\u0026lt;GameObject\u0026gt;(dropConfig); } public void OnDeath() { // éšæœºè·å–ä¸€ä¸ªç‰©å“ GameObject reward = _lootTable.GetRandom(); if (reward != null) { Instantiate(reward, transform.position, Quaternion.identity); } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ åŠ æƒéšæœº (Weighted Random)ï¼š\né¢è¯•å¿…é—®ã€‚è¯·ç†Ÿç»ƒæŒæ¡Â ç´¯åŠ æƒé‡ -\u0026gt; éšæœºRollç‚¹ -\u0026gt; éå†åˆ¤æ–­Â è¿™ä¸€å¥—é€»è¾‘ã€‚ ScriptableObject çš„å¨åŠ›ï¼š\nå¯¹äºæ•°æ®é…ç½®ï¼ˆæ‰è½è¡¨ã€æ€ªç‰©å±æ€§ã€æ­¦å™¨å‚æ•°ï¼‰ï¼ŒScriptableObject æ°¸è¿œä¼˜äº MonoBehaviourã€‚å› ä¸ºå®ƒå‡å°‘äº†å†…å­˜å¼€é”€ï¼ˆæ•°æ®å…±äº«ï¼‰ï¼Œä¸”æ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†ã€‚ OnValidateï¼š\nè¿™æ˜¯ Unity ç¼–è¾‘å™¨ç¼–ç¨‹çš„å…¥é—¨æŠ€å·§ã€‚åˆ©ç”¨å®ƒå¯ä»¥åœ¨ç¼–è¾‘é˜¶æ®µè‡ªåŠ¨è®¡ç®—ã€æ ¡éªŒæ•°æ®ï¼Œä¸ç”¨ç­‰åˆ°è¿è¡Œæ¸¸æˆæ‰å‘ç°å¡«é”™äº†ã€‚ ä¸‰åã€é€šç”¨æ‚¬åœæç¤ºå™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šé¼ æ ‡ç§»å…¥æ˜¾ç¤ºä¿¡æ¯ï¼Œç§»å‡ºéšè—ä¿¡æ¯ã€‚\nè®¾è®¡æ¨¡å¼ï¼š\nè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆé€šè¿‡ Unity æ¥å£å®ç°ï¼‰ã€‚\nå•ä¾‹æ¨¡å¼ï¼ˆSystem å…¨å±€å”¯ä¸€ï¼‰ã€‚\nå…³é”®æ¥å£ï¼šIPointerEnterHandlerÂ å’ŒÂ IPointerExitHandlerã€‚è¿™æ˜¯ Unity UI äº‹ä»¶ç³»ç»Ÿçš„æ ‡å‡†æ¥å£ï¼Œæ¯”Â OnMouseEnterï¼ˆç‰©ç†å°„çº¿ï¼‰æ›´é€‚åˆ UI å…ƒç´ ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 using UnityEngine; using TMPro; using UnityEngine.UI; // æŒ‚è½½åœ¨ Tooltip çš„ Panel ä¸Š [ExecuteInEditMode] // å…è®¸åœ¨ç¼–è¾‘å™¨é‡Œå®æ—¶é¢„è§ˆå¤§å°å˜åŒ– public class TooltipUI : MonoBehaviour { [Header(\u0026#34;UI ç»„ä»¶\u0026#34;)] public TextMeshProUGUI headerText; public TextMeshProUGUI contentText; public LayoutElement layoutElement; [Header(\u0026#34;è®¾ç½®\u0026#34;)] public int characterWrapLimit = 80; // è¶…è¿‡å¤šå°‘ä¸ªå­—å°±æ¢è¡Œ private RectTransform _rectTransform; private void Awake() { _rectTransform = GetComponent\u0026lt;RectTransform\u0026gt;(); } public void SetText(string content, string header = \u0026#34;\u0026#34;) { // 1. è®¾ç½®å†…å®¹ if (string.IsNullOrEmpty(header)) { headerText.gameObject.SetActive(false); } else { headerText.gameObject.SetActive(true); headerText.text = header; } contentText.text = content; // 2. åŠ¨æ€è°ƒæ•´å®½åº¦çš„é€»è¾‘ (Layout Element) // è·å– header å’Œ content ä¸­è¾ƒé•¿çš„é‚£ä¸ªé•¿åº¦ int headerLength = headerText.text.Length; int contentLength = contentText.text.Length; // å¦‚æœå­—æ•°å¤ªé•¿ï¼Œå°±å¼€å¯ layoutElement çš„ enabled è®©å®ƒé™åˆ¶æœ€å¤§å®½åº¦å¹¶æ¢è¡Œ // å¦åˆ™å°±ç¦ç”¨ï¼Œè®© Content Size Fitter è‡ªåŠ¨é€‚åº”æ–‡å­—çš„çŸ­å®½åº¦ layoutElement.enabled = (headerLength \u0026gt; characterWrapLimit || contentLength \u0026gt; characterWrapLimit); } private void Update() { // 3. å®æ—¶è·Ÿéšé¼ æ ‡ (åœ¨ Update é‡Œè°ƒç”¨ï¼) if (Application.isPlaying) { FollowMouse(); } } private void FollowMouse() { Vector2 mousePos = Input.mousePosition; // --- æ ¸å¿ƒç®—æ³•ï¼šé˜²å‡ºå±æ¢è½´ç¿»è½¬ (Pivot Flipping) --- float pivotX = mousePos.x / Screen.width; float pivotY = mousePos.y / Screen.height; // å¦‚æœé¼ æ ‡åœ¨å±å¹•å·¦åŠè¾¹ï¼ŒpivotX è®¾ä¸º 0 (UIåœ¨é¼ æ ‡å³ä¾§æ˜¾ç¤º) // å¦‚æœé¼ æ ‡åœ¨å±å¹•å³åŠè¾¹ï¼ŒpivotX è®¾ä¸º 1 (UIåœ¨é¼ æ ‡å·¦ä¾§æ˜¾ç¤º) // è¿™æ · Tooltip æ°¸è¿œä¸ä¼šé£å‡ºå±å¹•å·¦å³è¾¹ç•Œ _rectTransform.pivot = new Vector2(pivotX, pivotY); transform.position = mousePos; } } å¦‚ä½•åœ¨ Unity ä¸­ç»„è£…ï¼ˆSetupï¼‰ è¿™å¥—ç³»ç»Ÿéå¸¸ä¾èµ–Â Unity UI çš„å¸ƒå±€ç»„ä»¶ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nåˆ¶ä½œ Tooltip é¢æ¿ï¼š\nCanvas ä¸‹åˆ›å»ºä¸€ä¸ª Imageï¼Œå‘½åä¸ºÂ Tooltipã€‚\næ·»åŠ ç»„ä»¶Â Vertical Layout GroupÂ (å‹¾é€‰ Control Child Size: Width \u0026amp; Height)ã€‚\næ·»åŠ ç»„ä»¶Â Content Size FitterÂ (Horizontal: Preferred, Vertical: Preferred)ã€‚è¿™æ˜¯è‡ªé€‚åº”å¤§å°çš„å…³é”®ã€‚\næŒ‚è½½ä¸Šé¢çš„Â TooltipUIÂ è„šæœ¬ã€‚\næ·»åŠ ç»„ä»¶Â Canvas GroupÂ (ç”¨äºå°†æ¥åšæ·¡å…¥æ·¡å‡ºï¼Œä¸”å‹¾é€‰ Block Raycasts = falseï¼Œé˜²æ­¢ Tooltip æŒ¡ä½é¼ æ ‡å°„çº¿)ã€‚\nåˆ¶ä½œæ–‡æœ¬å­ç‰©ä½“ï¼š\nåœ¨Â TooltipÂ ä¸‹åˆ›å»ºä¸¤ä¸ª TextMeshPro (Header å’Œ Content)ã€‚\næŠŠå®ƒä»¬æ‹–ç»™è„šæœ¬é‡Œçš„å˜é‡ã€‚\nå¸ƒå±€é™åˆ¶ï¼š\nç»™Â TooltipÂ ç‰©ä½“å†åŠ ä¸€ä¸ªÂ Layout ElementÂ ç»„ä»¶ã€‚\nå‹¾é€‰Â Preferred WidthÂ å¹¶å¡«å…¥æ¯”å¦‚ 300ã€‚\næŠŠè¿™ä¸ª Layout Element ç»„ä»¶æ‹–ç»™è„šæœ¬é‡Œçš„Â layoutElementÂ å˜é‡ã€‚\nè¿æ¥ç³»ç»Ÿï¼š\nåœºæ™¯é‡Œåˆ›å»ºä¸€ä¸ªÂ GameManagerï¼ŒæŒ‚è½½Â TooltipSystemã€‚\næŠŠåˆšæ‰åšå¥½çš„Â TooltipÂ æ‹–ç»™Â TooltipSystemÂ çš„Â tooltipUIÂ å˜é‡ã€‚\nä¸€å¼€å§‹æŠŠÂ TooltipÂ ç‰©ä½“éšè—ï¼ˆSetActive falseï¼‰ã€‚\næ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ UI è‡ªé€‚åº”å¸ƒå±€ (Auto Layout)ï¼š\nç†Ÿç»ƒæŒæ¡Â Content Size FitterÂ +Â Vertical Layout GroupÂ +Â Layout ElementÂ çš„ç»„åˆæ‹³ã€‚è¿™æ˜¯åˆ¶ä½œå¯¹è¯æ¡†ã€æ°”æ³¡ã€Tooltip çš„æ ‡å‡†æµç¨‹ã€‚ Pivot (æ¢è½´) çš„å¦™ç”¨ï¼š\nRectTransform.pivotÂ ä¸ä»…ä»…æ˜¯æ—‹è½¬ä¸­å¿ƒã€‚åœ¨ä»£ç ä¸­åŠ¨æ€ä¿®æ”¹ Pivotï¼ˆå¦‚Â FollowMouseÂ ä¸­çš„ç®—æ³•ï¼‰ï¼Œæ˜¯å®ç°â€œæ™ºèƒ½è´´è¾¹ UIâ€æœ€ä¼˜é›…çš„æ•°å­¦æ–¹æ³•ï¼Œå®Œå…¨ä¸éœ€è¦å¤æ‚çš„åæ ‡åˆ¤æ–­Â if (x \u0026gt; width - 100)ã€‚ ExecuteInEditModeï¼š\nè¿™ä¸ªæ ‡ç­¾è®©è„šæœ¬åœ¨ç¼–è¾‘å™¨éè¿è¡ŒçŠ¶æ€ä¸‹ä¹Ÿèƒ½æ‰§è¡Œã€‚å¯¹äº UI å¸ƒå±€è„šæœ¬æ¥è¯´ï¼Œèƒ½è®©ä½ åœ¨ç¼–è¾‘æ—¶ç›´æ¥çœ‹åˆ°å­—å¤šäº†æ¡†å˜å¤§çš„æ•ˆæœï¼Œéå¸¸å®ç”¨ã€‚ ä¸‰åä¸€ã€å†·å´æ—¶é—´è¿½è¸ªå™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šå°è£…äº†åŸºäºæ—¶é—´æˆ³çš„è®¡æ—¶é€»è¾‘ã€‚\nè®¾è®¡äº®ç‚¹ï¼š\næ—  Updateï¼šå®ƒä¸ä¾èµ–Â UpdateÂ æ¯å¸§æ‰£æ—¶é—´ï¼Œè€Œæ˜¯è®°å½•â€œä¸‹æ¬¡å¯ç”¨çš„æ—¶é—´ç‚¹â€ï¼ˆTime Stampï¼‰ã€‚è¿™ä½¿å¾—å®ƒæ€§èƒ½æé«˜ï¼Œä¸”ä¸ç”¨æ‹…å¿ƒå¤šçº¿ç¨‹é—®é¢˜ã€‚\nåºåˆ—åŒ–ï¼š[Serializable]Â è®©å®ƒèƒ½ç›´æ¥åœ¨ Inspector é¢æ¿é‡Œæ˜¾ç¤ºå’Œé…ç½®ã€‚\nç±»å‹ï¼šå€¼ç±»å‹ (Value Type)ã€‚è¯·è®°ä½è¿™å››ä¸ªå­—ï¼Œåé¢ä¼šè€ƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 using UnityEngine; [System.Serializable] public struct Cooldown { [Tooltip(\u0026#34;å†·å´æ€»æ—¶é•¿(ç§’)\u0026#34;)] public float duration; // ä½¿ç”¨ [SerializeField] è®©ç§æœ‰å˜é‡ä¹Ÿèƒ½åœ¨ Inspector çš„ Debug æ¨¡å¼ä¸‹çœ‹åˆ° // ä½†ä¿æŒ private é˜²æ­¢å¤–éƒ¨éšæ„ä¿®æ”¹ [SerializeField] private float _nextReadyTime; // æ„é€ å‡½æ•° public Cooldown(float duration) { this.duration = duration; this._nextReadyTime = 0; } /// \u0026lt;summary\u0026gt; /// æŠ€èƒ½æ˜¯å¦å¯ç”¨ï¼Ÿ /// \u0026lt;/summary\u0026gt; public bool IsReady =\u0026gt; Time.time \u0026gt;= _nextReadyTime; /// \u0026lt;summary\u0026gt; /// è§¦å‘å†·å´ /// \u0026lt;/summary\u0026gt; public void Start() { // åŠ ä¸Š Time.time å¾—åˆ°æœªæ¥çš„æ—¶é—´æˆ³ _nextReadyTime = Time.time + duration; } /// \u0026lt;summary\u0026gt; /// å¼ºåˆ¶é‡ç½®å†·å´ï¼ˆç«‹å³å¯ç”¨ï¼‰ /// \u0026lt;/summary\u0026gt; public void Reset() { _nextReadyTime = 0; } /// \u0026lt;summary\u0026gt; /// å‰©ä½™ç§’æ•° /// \u0026lt;/summary\u0026gt; public float TimeRemaining =\u0026gt; Mathf.Max(0, _nextReadyTime - Time.time); /// \u0026lt;summary\u0026gt; /// è¿›åº¦ (1 -\u0026gt; 0) /// \u0026lt;para\u0026gt;å†·å´åˆšå¼€å§‹æ˜¯ 1ï¼Œå†·å´å®Œæ¯•æ˜¯ 0\u0026lt;/para\u0026gt; /// \u0026lt;/summary\u0026gt; public float ProgressRemaining =\u0026gt; (duration \u0026lt;= 0) ? 0 : (TimeRemaining / duration); /// \u0026lt;summary\u0026gt; /// è¿›åº¦ (0 -\u0026gt; 1) /// \u0026lt;para\u0026gt;å†·å´åˆšå¼€å§‹æ˜¯ 0ï¼Œå†·å´å®Œæ¯•æ˜¯ 1 (é€‚åˆå¡«å……å¼ UI)\u0026lt;/para\u0026gt; /// \u0026lt;/summary\u0026gt; public float ProgressComplete =\u0026gt; 1f - ProgressRemaining; } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šå®ç°ä¸€ä¸ªå¸¦æœ‰å†·å´çš„â€œé—ªé¿ï¼ˆDashï¼‰â€æŠ€èƒ½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 public class PlayerController : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] // åœ¨ Inspector é‡Œç›´æ¥å¡« duration = 2 public Cooldown dashCd = new Cooldown(2f); void Update() { if (Input.GetKeyDown(KeyCode.Space)) { TryDash(); } } void TryDash() { // 1. æ£€æŸ¥å†·å´ if (dashCd.IsReady) { // 2. æ‰§è¡Œé€»è¾‘ Debug.Log(\u0026#34;å‘åŠ¨é—ªé¿ï¼\u0026#34;); // 3. å¼€å§‹å†·å´ (å…³é”®ï¼) dashCd.Start(); } else { Debug.Log($\u0026#34;æŠ€èƒ½å†·å´ä¸­... å‰©ä½™: {dashCd.TimeRemaining:F1}ç§’\u0026#34;); } } // UI æ˜¾ç¤º (å‡è®¾åœ¨ OnGUI æˆ–è€… UI è„šæœ¬ä¸­) void OnGUI() { // æ˜¾ç¤º 0.0 ~ 1.0 çš„è¿›åº¦ GUI.Label(new Rect(10, 10, 200, 20), $\u0026#34;CD Progress: {dashCd.Progress}\u0026#34;); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ Struct vs Class (å€¼ç±»å‹ vs å¼•ç”¨ç±»å‹)ï¼š\næ ¸å¿ƒè€ƒç‚¹ï¼šæ˜ç™½ä¸ºä»€ä¹ˆÂ structÂ ä¸èƒ½éšä¾¿èµ‹å€¼ç»™å±€éƒ¨å˜é‡å†ä¿®æ”¹ã€‚å¦‚æœä½ çš„å†·å´é€»è¾‘éå¸¸å¤æ‚ï¼Œæˆ–è€…éœ€è¦è¢«å¤šä¸ªè„šæœ¬å…±äº«å¼•ç”¨ï¼Œè¯·æ”¹ç”¨Â classã€‚ä½†å¯¹äºç®€å•çš„ CDï¼ŒstructÂ æ˜¯æ€§èƒ½æœ€å¥½çš„ã€‚ æ—¶é—´æˆ³é€»è¾‘ (Timestamp)ï¼š\nä¼˜åŒ–æ€ç»´ï¼šé¿å…åœ¨Â UpdateÂ é‡Œå†™Â timer -= Time.deltaTimeã€‚ä½¿ç”¨æ—¶é—´æˆ³ï¼ˆTime.time + durationï¼‰å¯ä»¥çœå»å¤§é‡çš„ CPU è®¡ç®—ï¼Œä¸”çŠ¶æ€æ›´ç¨³å®šï¼ˆä¸ä¼šå› ä¸ºæ‰å¸§å¯¼è‡´è®¡æ—¶ä¸å‡†ï¼‰ã€‚ åºåˆ—åŒ– (Serialization)ï¼š\nè‡ªå®šä¹‰ç»“æ„ä½“è¦æƒ³åœ¨ Unity Inspector é‡Œæ˜¾ç¤ºï¼Œå¿…é¡»åŠ Â [System.Serializable]ã€‚ ä¸‰åäºŒã€è§†å·®æ»šåŠ¨èƒŒæ™¯ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šè®©èƒŒæ™¯å±‚è·Ÿéšæ‘„åƒæœºç§»åŠ¨ï¼Œä½†é€Ÿåº¦ä¸åŒï¼Œä»è€Œäº§ç”Ÿ 3D çš„å±‚æ¬¡æ„Ÿã€‚\né€‚ç”¨åœºæ™¯ï¼š\næ¨ªç‰ˆå·è½´ï¼ˆPlatformerï¼‰ï¼šè¿œæ™¯çš„å±±è„‰ã€äº‘æœµã€æ ‘æ—ã€‚\nçºµå‘å°„å‡»ï¼ˆSTGï¼‰ï¼šé£èˆ¹ä¸‹æ–¹çš„æ˜Ÿç©ºã€åœ°é¢å»ºç­‘ã€‚\nå…³é”®æ•°å­¦ï¼šä½ç½® = åˆå§‹ä½ç½® + (ç›¸æœºç§»åŠ¨è·ç¦» * è§†å·®ç³»æ•°)ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 using UnityEngine; [RequireComponent(typeof(SpriteRenderer))] public class Parallax : MonoBehaviour { private float _length, _startPos; public Camera mainCam; [Header(\u0026#34;è§†å·®è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;è§†å·®ç³»æ•° (0 ~ 1)\\n1 = è¿œæ™¯ (å‡ ä¹ä¸åŠ¨ï¼Œè·Ÿç€ç›¸æœº)\\n0 = è¿‘æ™¯ (æ­£å¸¸ç§»åŠ¨)\u0026#34;)] public float parallaxFactor; [Tooltip(\u0026#34;æ˜¯å¦å¼€å¯æ— é™å¾ªç¯\u0026#34;)] public bool infiniteLoop = true; void Start() { if (mainCam == null) mainCam = Camera.main; // 1. è®°å½•åˆå§‹ X åæ ‡ _startPos = transform.position.x; // 2. è·å–å›¾ç‰‡çš„å®½åº¦ (ç”¨äºå¾ªç¯) // bounds.size.x æ˜¯å›¾ç‰‡åœ¨ä¸–ç•Œåæ ‡ä¸‹çš„å®é™…å®½åº¦ _length = GetComponent\u0026lt;SpriteRenderer\u0026gt;().bounds.size.x; } // ä½¿ç”¨ LateUpdate ç¡®ä¿åœ¨ç›¸æœºç§»åŠ¨ä¹‹åå†ç§»åŠ¨èƒŒæ™¯ï¼Œæ¶ˆé™¤æŠ–åŠ¨ void LateUpdate() { // temp: èƒŒæ™¯ç›¸å¯¹äºç›¸æœºå®é™…ç§»åŠ¨äº†å¤šå°‘ (ç”¨äºåˆ¤æ–­æ˜¯å¦è¯¥é‡ç½®ä½ç½®) float temp = (mainCam.transform.position.x * (1 - parallaxFactor)); // dist: èƒŒæ™¯åº”è¯¥åœ¨çš„ä½ç½®åç§»é‡ float dist = (mainCam.transform.position.x * parallaxFactor); // 3. æ›´æ–°ä½ç½® transform.position = new Vector3(_startPos + dist, transform.position.y, transform.position.z); // 4. æ— é™å¾ªç¯é€»è¾‘ (Checkbounds) if (infiniteLoop) { // å¦‚æœç›¸æœºå¾€å³èµ°ï¼Œè¶…è¿‡äº†å›¾ç‰‡å®½åº¦çš„ä¸€åŠï¼ŒæŠŠèƒŒæ™¯çš„åŸºå‡†ç‚¹å¾€å³æŒªä¸€ä¸ªèº«ä½ if (temp \u0026gt; _startPos + _length) _startPos += _length; // å¦‚æœç›¸æœºå¾€å·¦èµ°ï¼Œè¶…è¿‡äº†å›¾ç‰‡å®½åº¦çš„ä¸€åŠï¼ŒæŠŠèƒŒæ™¯çš„åŸºå‡†ç‚¹å¾€å·¦æŒªä¸€ä¸ªèº«ä½ else if (temp \u0026lt; _startPos - _length) _startPos -= _length; } } } å¦‚ä½•åœ¨ Unity ä¸­æ­å»ºæ— é™èƒŒæ™¯ å‡†å¤‡ç´ æï¼šæ‰¾ä¸€å¼ ä¸¤è¾¹å¯ä»¥å®Œç¾æ‹¼æ¥çš„èƒŒæ™¯å›¾ï¼ˆSeamless Textureï¼‰ã€‚\nåœºæ™¯æ­å»ºï¼š\nåœ¨åœºæ™¯é‡Œæ”¾Â 3 å¼ Â åŒæ ·çš„èƒŒæ™¯å›¾ï¼Œæ¨ªå‘æ’å¼€ï¼ˆå·¦ã€ä¸­ã€å³ï¼‰ï¼Œå¡«æ»¡ç›¸æœºè§†é‡ã€‚\nç»™è¿™ 3 å¼ å›¾éƒ½æŒ‚ä¸Šä¸Šé¢çš„Â ParallaxÂ è„šæœ¬ã€‚\nå…³é”®ï¼šå®ƒä»¬çš„Â parallaxFactorÂ å¿…é¡»è®¾ä¸ºå®Œå…¨ä¸€æ ·ï¼ˆæ¯”å¦‚éƒ½æ˜¯ 0.8ï¼‰ã€‚\nè¿è¡Œï¼š\nå½“ä½ æ§åˆ¶è§’è‰²å‘å³è·‘æ—¶ï¼Œæœ€å·¦è¾¹é‚£å¼ å›¾ä¸€æ—¦è·‘å‡ºå±å¹•èŒƒå›´ï¼Œå°±ä¼šç¬é—´ç¬ç§»åˆ°æœ€å³è¾¹å»æ¥åŠ›ã€‚ç©å®¶æ°¸è¿œè·‘ä¸åˆ°å°½å¤´ã€‚ æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ Update vs LateUpdateï¼š\né¢è¯•è€ƒç‚¹ï¼šä»»ä½•è·Ÿéšç›¸æœºï¼ˆCamera Followï¼‰æˆ–è·Ÿéšä¸»è§’ç§»åŠ¨çš„ UI/èƒŒæ™¯ï¼Œå¿…é¡»æ”¾åœ¨Â LateUpdateÂ é‡Œã€‚\nåŸå› ï¼šç›¸æœºé€šå¸¸åœ¨Â UpdateÂ ç§»åŠ¨ã€‚å¦‚æœåœ¨Â UpdateÂ é‡Œç§»åŠ¨èƒŒæ™¯ï¼Œå¯èƒ½å‡ºç°â€œç›¸æœºåŠ¨äº† -\u0026gt; æ¸²æŸ“ç”»é¢ -\u0026gt; èƒŒæ™¯åŠ¨äº†â€çš„é¡ºåºé”™ä½ï¼Œå¯¼è‡´ç”»é¢æ’•è£‚æˆ–æŠ–åŠ¨ã€‚LateUpdateÂ ä¿è¯åœ¨ç›¸æœºåŠ¨å®Œåå†è·Ÿè¿›ã€‚\nç›¸å¯¹è¿åŠ¨åŸç†ï¼š\nç†è§£Â 1 - parallaxFactorÂ æ˜¯è®¡ç®—â€œç”±äºè§†å·®å¯¼è‡´çš„æ»åè·ç¦»â€ï¼Œè¿™æ˜¯åˆ¤å®šä½•æ—¶ç¬ç§»çš„å…³é”®ã€‚ Sprite Boundsï¼š\nä¸è¦æ‰‹åŠ¨å¡«Â lengthã€‚ä½¿ç”¨Â GetComponent().bounds.size.xÂ åŠ¨æ€è·å–ï¼Œè¿™æ ·æ— è®ºä½ æ€ä¹ˆç¼©æ”¾å›¾ç‰‡ï¼Œé€»è¾‘éƒ½æ˜¯å¯¹çš„ã€‚ ä¸‰åä¸‰ã€å±å¹•è¾¹ç•Œé™åˆ¶å™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šé™åˆ¶ç‰©ä½“ï¼ˆé€šå¸¸æ˜¯ç©å®¶ï¼‰åªèƒ½åœ¨æ‘„åƒæœºå¯è§èŒƒå›´å†…ç§»åŠ¨ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nSTG å°„å‡»æ¸¸æˆï¼ˆé›·ç”µã€ä¸œæ–¹Projectï¼‰ã€‚\nå°é—­å¼ç«æŠ€åœºï¼ˆä»¥æ’’çš„ç»“åˆï¼‰ã€‚\nUI æ‹–æ‹½é™åˆ¶ã€‚\næ ¸å¿ƒç®—æ³•ï¼š\nScreenToWorldPointï¼šå°†å±å¹•çš„åƒç´ åæ ‡è½¬ä¸ºä¸–ç•Œåæ ‡ã€‚\nMathf.Clampï¼šå°†åæ ‡æ•°å€¼â€œé’³åˆ¶â€åœ¨æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 using UnityEngine; [RequireComponent(typeof(SpriteRenderer))] public class ScreenBounds : MonoBehaviour { [Header(\u0026#34;è®¾ç½®\u0026#34;)] [Tooltip(\u0026#34;è¾¹ç¼˜ç•™ç™½è·ç¦»\u0026#34;)] public float padding = 0.5f; [Tooltip(\u0026#34;æ˜¯å¦æ¯å¸§æ›´æ–°è¾¹ç•Œï¼ˆå¦‚æœæ‘„åƒæœºç§»åŠ¨ï¼Œå¿…é¡»å‹¾é€‰ï¼‰\u0026#34;)] public bool updateEveryFrame = true; private SpriteRenderer _renderer; private Vector2 _halfSize; private Camera _mainCam; private Vector2 _screenBounds; void Start() { _mainCam = Camera.main; _renderer = GetComponent\u0026lt;SpriteRenderer\u0026gt;(); // è®¡ç®—ç‰©ä½“çš„ä¸€åŠå°ºå¯¸ (Extents) _halfSize = _renderer.bounds.extents; // åˆå§‹åŒ–è®¡ç®—ä¸€æ¬¡ CalculateBounds(); } void LateUpdate() { // å¦‚æœæ‘„åƒæœºæ˜¯åŠ¨çš„ï¼Œå¿…é¡»æ¯å¸§é‡æ–°è®¡ç®—è¾¹ç•Œ if (updateEveryFrame) { CalculateBounds(); } Vector3 viewPos = transform.position; // --- æ ¸å¿ƒé™åˆ¶é€»è¾‘ --- // 1. é™åˆ¶ X è½´ // å·¦è¾¹ç•Œ = è´Ÿå±å¹•å®½ + ç‰©ä½“åŠå®½ + padding // å³è¾¹ç•Œ = æ­£å±å¹•å®½ - ç‰©ä½“åŠå®½ - padding float xMin = -_screenBounds.x + _halfSize.x + padding; float xMax = _screenBounds.x - _halfSize.x - padding; // åŠ ä¸Šæ‘„åƒæœºå½“å‰çš„ä½ç½®ï¼ˆé€‚é…ç§»åŠ¨æ‘„åƒæœºï¼‰ viewPos.x = Mathf.Clamp(viewPos.x, _mainCam.transform.position.x + xMin, _mainCam.transform.position.x + xMax); // 2. é™åˆ¶ Y è½´ float yMin = -_screenBounds.y + _halfSize.y + padding; float yMax = _screenBounds.y - _halfSize.y - padding; viewPos.y = Mathf.Clamp(viewPos.y, _mainCam.transform.position.y + yMin, _mainCam.transform.position.y + yMax); transform.position = viewPos; } // è®¡ç®—å±å¹•åœ¨ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ä¸€åŠå®½åº¦å’Œé«˜åº¦ private void CalculateBounds() { // è¿™ç§ç®—æ³•æ›´é€‚åˆ 2D æ­£äº¤ç›¸æœºï¼Œæ¯” ScreenToWorldPoint æ›´çº¯ç²¹ float vertExtent = _mainCam.orthographicSize; // å±å¹•é«˜åº¦çš„ä¸€åŠ float horzExtent = vertExtent * Screen.width / Screen.height; // å±å¹•å®½åº¦çš„ä¸€åŠ _screenBounds = new Vector2(horzExtent, vertExtent); } // --- è°ƒè¯•è¾…åŠ©çº¿ --- // è®©ä½ åœ¨ç¼–è¾‘å™¨é‡Œç›´æ¥çœ‹åˆ°é™åˆ¶æ¡†åœ¨å“ªé‡Œï¼Œéå¸¸å®ç”¨ï¼ private void OnDrawGizmosSelected() { if (_mainCam == null) _mainCam = Camera.main; if (_mainCam == null) return; // æ¨¡æ‹Ÿè®¡ç®—æ¡†çš„å¤§å° float vertExtent = _mainCam.orthographicSize; float horzExtent = vertExtent * Screen.width / Screen.height; // ç»¿è‰²çº¿æ¡†ä»£è¡¨æ´»åŠ¨èŒƒå›´ Gizmos.color = Color.green; float width = (horzExtent * 2) - (padding * 2); // åªæ˜¯å¤§æ¦‚ç¤ºæ„ï¼Œæ²¡å‡å»ç‰©ä½“å®½åº¦ float height = (vertExtent * 2) - (padding * 2); Gizmos.DrawWireCube(_mainCam.transform.position, new Vector3(width, height, 0)); } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ Mathf.Clampï¼š\nå¿…èƒŒ APIã€‚åšè¡€é‡é™åˆ¶ï¼ˆ0~Maxï¼‰ã€ä½ç½®é™åˆ¶ï¼ˆè¾¹ç•Œï¼‰ã€æ•°å€¼é™åˆ¶æ—¶æ— å¤„ä¸åœ¨ã€‚ åæ ‡ç³»è½¬æ¢ï¼š\nç†è§£Â Screen SpaceÂ (åƒç´ ) å’ŒÂ World SpaceÂ (ç±³/å•ä½) çš„åŒºåˆ«ã€‚\nå±å¹•å·¦ä¸‹è§’æ˜¯ (0,0) åƒç´ ï¼Œä½†åœ¨ 2D ä¸–ç•Œåæ ‡é‡Œï¼Œç›¸æœºä¸­å¿ƒæ˜¯ (0,0)ï¼Œå·¦ä¸‹è§’å¯èƒ½æ˜¯ (-8, -4.5)ã€‚\nBounds.extentsï¼š\nå¦‚æœä½ åš 2D ç¢°æ’æˆ–é™åˆ¶ï¼Œä¸€å®šè¦åˆ†æ¸…Â sizeÂ (å…¨é•¿) å’ŒÂ extentsÂ (åŠé•¿)ã€‚ç»å¤§å¤šæ•°åŸºäºä¸­å¿ƒç‚¹çš„ç®—æ³•éƒ½éœ€è¦ç”¨Â extentsã€‚ ä¸‰åå››ã€åç¨‹é” ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šç®¡ç†åç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿â€œæ–°æ¥çš„é¡¶æ›¿æ—§çš„â€ã€‚\nè®¾è®¡æ¨¡å¼ï¼šå•é€šé“æ§åˆ¶ï¼ˆSingle Channel Controlï¼‰ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nRTS æ¸¸æˆçš„è§’è‰²ç§»åŠ¨ï¼šç©å®¶ç‹‚ç‚¹é¼ æ ‡å³é”®ï¼Œè§’è‰²åº”è¯¥ç«‹åˆ»æ”¾å¼ƒæ—§ç›®æ ‡ï¼Œå‰å¾€æ–°ç›®æ ‡ï¼Œè€Œä¸æ˜¯ç­‰æ—§è·¯èµ°å®Œæ‰èµ°æ–°è·¯ã€‚\nUI å¼¹çª—åŠ¨ç”»ï¼šå¼¹çª—æ­£åœ¨â€œæ·¡å…¥â€æ—¶ï¼Œç©å®¶ç‚¹äº†å…³é—­ã€‚ä»£ç åº”è¯¥ç«‹åˆ»æ‰“æ–­â€œæ·¡å…¥â€ï¼Œç›´æ¥å¼€å§‹â€œæ·¡å‡ºâ€ï¼Œè€Œä¸æ˜¯ç­‰æ·¡å…¥å®Œäº†å†æ·¡å‡ºã€‚\nè“„åŠ›æŠ€èƒ½ï¼šæ­£åœ¨è“„åŠ›æ—¶è¢«æ‰“æ–­ï¼Œç«‹åˆ»åœæ­¢è“„åŠ›é€»è¾‘\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 using UnityEngine; using System.Collections; public class CoroutineRunner : MonoBehaviour { private Coroutine _currentCoroutine; /// \u0026lt;summary\u0026gt; /// å½“å‰æ˜¯å¦æœ‰ä»»åŠ¡åœ¨è¿è¡Œï¼Ÿ /// \u0026lt;/summary\u0026gt; public bool IsRunning =\u0026gt; _currentCoroutine != null; /// \u0026lt;summary\u0026gt; /// å¯åŠ¨æ–°åç¨‹ /// \u0026lt;/summary\u0026gt; public void Run(IEnumerator routine) { // 1. åœæ­¢æ—§çš„ Stop(); // 2. å¼€å¯æ–°çš„ï¼ˆåŒ…è£¹ä¸€å±‚ï¼Œç”¨äºç›‘å¬ç»“æŸï¼‰ _currentCoroutine = StartCoroutine(WrapperRoutine(routine)); } /// \u0026lt;summary\u0026gt; /// åœæ­¢å½“å‰åç¨‹ /// \u0026lt;/summary\u0026gt; public void Stop() { if (_currentCoroutine != null) { StopCoroutine(_currentCoroutine); _currentCoroutine = null; } } // --- å†…éƒ¨æ ¸å¿ƒ --- // è¿™æ˜¯ä¸€ä¸ª\u0026#34;ä¸­é—´å•†\u0026#34;åç¨‹ private IEnumerator WrapperRoutine(IEnumerator routine) { // 1. æ‰§è¡Œç”¨æˆ·çš„é€»è¾‘ï¼Œç›´åˆ°å®ƒè·‘å®Œ yield return routine; // 2. è·‘å®Œåï¼ŒæŠŠè‡ªå·±ç½®ç©º // è¿™æ · IsRunning å±æ€§å°±èƒ½æ­£ç¡®è¿”å› False äº†ï¼ _currentCoroutine = null; } } ä½¿ç”¨åœºæ™¯ä¸ç¤ºä¾‹ åœºæ™¯ï¼šRTS æ¸¸æˆç‚¹å‡»åœ°æ¿ç§»åŠ¨\nå‡è®¾ä½ æœ‰ä¸€ä¸ªÂ UnitMovementÂ è„šæœ¬ã€‚\nä¸ä½¿ç”¨ CoroutineRunner (ç—›è‹¦å†™æ³•)ï¼š\n1 2 3 4 5 6 7 8 bool isMoving = false; // éœ€è¦ç»´æŠ¤æ ‡å¿—ä½ void Move(Vector3 target) { if(isMoving) { StopCoroutine(\u0026#34;MoveRoutine\u0026#34;); // åªèƒ½ç”¨å­—ç¬¦ä¸²åœï¼Ÿæˆ–è€…ä¿å­˜å¼•ç”¨å¾ˆéº»çƒ¦ } StartCoroutine(MoveRoutine(target)); } ä½¿ç”¨ CoroutineRunner (ä¼˜é›…å†™æ³•)ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public class UnitMovement : MonoBehaviour { // 1. å¼•ç”¨ Runner private CoroutineRunner _moveRunner; void Awake() { // æŒ‚è½½ Runner ç»„ä»¶ _moveRunner = gameObject.AddComponent\u0026lt;CoroutineRunner\u0026gt;(); } public void MoveTo(Vector3 target) { // 2. ç›´æ¥ä¸¢ç»™ Runnerï¼Œä¸ç”¨ç®¡ä¹‹å‰åœ¨å¹²å˜›ï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç†æ‰“æ–­ _moveRunner.Run(MoveRoutine(target)); } private IEnumerator MoveRoutine(Vector3 target) { while (Vector3.Distance(transform.position, target) \u0026gt; 0.1f) { transform.position = Vector3.MoveTowards(transform.position, target, Time.deltaTime * 5f); yield return null; } } } æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ åç¨‹ç®¡ç† (Handle Management)ï¼š\nStartCoroutineÂ ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥ä½å®ƒï¼Œä½ æ‰èƒ½æ§åˆ¶å®ƒçš„ç”Ÿæ­»ã€‚ äº’æ–¥é€»è¾‘ (Mutex)ï¼š\né¢è¯•åŠ åˆ†é¡¹ï¼šåœ¨å¤„ç†å¼‚æ­¥é€»è¾‘ï¼ˆç§»åŠ¨ã€åŠ¨ç”»ã€å€’è®¡æ—¶ï¼‰æ—¶ï¼Œæ°¸è¿œè¦è€ƒè™‘â€œå¦‚æœä¸Šä¸€ä¸ªè¿˜æ²¡åšå®Œï¼Œåˆæ¥äº†æ–°çš„æ€ä¹ˆåŠï¼Ÿâ€ã€‚è¿™ä¸ªè„šæœ¬å°±æ˜¯æ ‡å‡†çš„â€œåæµªæ¨å‰æµªâ€ç­–ç•¥ã€‚ åŒ…è£…å™¨ (Wrapper)ï¼š\né€šè¿‡åµŒå¥—Â yield returnÂ æ¥ç›‘å¬å¦ä¸€ä¸ªåç¨‹çš„ç»“æŸï¼Œæ˜¯ Unity å¼€å‘ä¸­çš„é«˜çº§æŠ€å·§ã€‚ ä¸‰åäº”ã€ç‰ˆæœ¬å·æ˜¾ç¤ºå™¨ ä»£ç å…¨æ™¯åˆ†æ æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨è¯»å– Unity é¡¹ç›®è®¾ç½®ä¸­çš„ç‰ˆæœ¬å·ï¼Œå¹¶æ˜¾ç¤ºåœ¨ UI ä¸Šã€‚\né€‚ç”¨åœºæ™¯ï¼š\nç™»å½•ç•Œé¢/ä¸»èœå•ï¼šé€šå¸¸æ”¾åœ¨å³ä¸‹è§’æˆ–å·¦ä¸‹è§’ã€‚\nè®¾ç½®é¢æ¿ï¼šè®©ç©å®¶ç¡®è®¤è‡ªå·±æ˜¯å¦éœ€è¦æ›´æ–°ã€‚\nDebug ç•Œé¢ï¼šæ˜¾ç¤ºæ›´è¯¦ç»†çš„æ„å»ºä¿¡æ¯ã€‚\næ ¸å¿ƒ APIï¼šApplication.versionã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 using UnityEngine; using TMPro; [RequireComponent(typeof(TextMeshProUGUI))] public class VersionDisplay : MonoBehaviour { [Header(\u0026#34;æ ¼å¼è®¾ç½®\u0026#34;)] public string prefix = \u0026#34;Ver: \u0026#34;; // å‰ç¼€ [Tooltip(\u0026#34;æ˜¯å¦åœ¨å¼€å‘åŒ…ä¸­æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯\u0026#34;)] public bool showDebugInfo = true; void Start() { var textComp = GetComponent\u0026lt;TextMeshProUGUI\u0026gt;(); string finalVersion = $\u0026#34;{prefix}{Application.version}\u0026#34;; // --- å·¥ä¸šçº§ç¯å¢ƒæ„ŸçŸ¥ --- // 1. æ£€æµ‹æ˜¯å¦æ˜¯å¼€å‘æ„å»º (Development Build) // è¿™ä¸ªå±æ€§åœ¨ Build Settings é‡Œå‹¾é€‰ \u0026#34;Development Build\u0026#34; æ—¶ä¸º true if (showDebugInfo \u0026amp;\u0026amp; Debug.isDebugBuild) { finalVersion += \u0026#34; \u0026lt;color=yellow\u0026gt;[DEV]\u0026lt;/color\u0026gt;\u0026#34;; // åŠ ä¸ªé»„è‰²çš„ DEV æ ‡è®° } // 2. æ£€æµ‹æ˜¯å¦æ˜¯ç¼–è¾‘å™¨æ¨¡å¼ #if UNITY_EDITOR finalVersion += \u0026#34; (Editor)\u0026#34;; #endif // 3. (å¯é€‰) æ˜¾ç¤ºå…·ä½“çš„å¹³å°ï¼Œæ–¹ä¾¿æˆªå›¾åé¦ˆ // finalVersion += $\u0026#34; [{Application.platform}]\u0026#34;; textComp.text = finalVersion; } } ä½¿ç”¨åœºæ™¯ä¸é…ç½® åœºæ™¯æ­å»ºï¼š\nåœ¨ä¸»èœå• Canvas çš„è§’è½åˆ›å»ºä¸€ä¸ªÂ Text (TMP)ã€‚\nå­—ä½“è®¾å°ä¸€ç‚¹ï¼ˆæ¯”å¦‚ 20ï¼‰ï¼Œé¢œè‰²è®¾ä¸ºåŠé€æ˜ç°è‰²ï¼ˆä¸è¦æŠ¢çœ¼ï¼‰ã€‚\næŒ‚è½½Â VersionDisplayÂ è„šæœ¬ã€‚\nè®¾ç½®ç‰ˆæœ¬ï¼š\næ‰“å¼€ Project Settings \u0026gt; Playerã€‚\nåœ¨ Version ä¸€æ å¡«å…¥Â 0.1.0 Alphaã€‚\nè¿è¡Œï¼š\nå±å¹•ä¸Šä¼šè‡ªåŠ¨æ˜¾ç¤ºÂ v0.1.0 Alphaã€‚ æ ¸å¿ƒæŠ€èƒ½ç‚¹æ€»ç»“ Application ç±»ï¼š\nApplicationÂ æ˜¯ Unity çš„å…¨å±€ä¿¡æ¯ä¸­å¿ƒã€‚\nå¸¸ç”¨ APIï¼š\nApplication.versionï¼šç‰ˆæœ¬å·ã€‚\nApplication.platformï¼šå½“å‰è¿è¡Œå¹³å°ï¼ˆWindows, Android, iOS\u0026hellip;ï¼‰ã€‚\nApplication.identifierï¼šåŒ…åï¼ˆcom.company.gameï¼‰ã€‚\nç‰ˆæœ¬ç®¡ç†æ„è¯†ï¼š\nè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ (SemVer)ï¼šå»ºè®®å…»æˆÂ ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢å·ï¼ˆå¦‚ 1.2.5ï¼‰çš„å‘½åä¹ æƒ¯ã€‚\nä¸»ç‰ˆæœ¬ï¼šé‡å¤§æ¶æ„å˜æ›´ã€‚\næ¬¡ç‰ˆæœ¬ï¼šæ–°åŠŸèƒ½ã€‚\nä¿®è®¢å·ï¼šä¿® Bugã€‚\n","date":"2025-12-05T19:21:47+08:00","permalink":"https://SelYioZn.github.io/p/unity%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BB%A3%E7%A0%81%E8%AE%BE%E8%AE%A1/","title":"Unityæ¨¡å—åŒ–ä»£ç è®¾è®¡"}]